(function(e){function t(t){for(var r,i,o=t[0],l=t[1],c=t[2],p=0,_=[];p<o.length;p++)i=o[p],Object.prototype.hasOwnProperty.call(s,i)&&s[i]&&_.push(s[i][0]),s[i]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);u&&u(t);while(_.length)_.shift()();return n.push.apply(n,c||[]),a()}function a(){for(var e,t=0;t<n.length;t++){for(var a=n[t],r=!0,o=1;o<a.length;o++){var l=a[o];0!==s[l]&&(r=!1)}r&&(n.splice(t--,1),e=i(i.s=a[0]))}return e}var r={},s={exp:0},n=[];function i(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=r,i.d=function(e,t,a){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(i.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(a,r,function(t){return e[t]}.bind(null,r));return a},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],l=o.push.bind(o);o.push=t,o=o.slice();for(var c=0;c<o.length;c++)t(o[c]);var u=l;n.push([1,"chunk-vendors","chunk-common"]),a()})({"088c":function(e,t,a){"use strict";var r=a("3580"),s=a.n(r);s.a},"08ee":function(e,t,a){e.exports=a.p+"img/2.b9d3f712.png"},"095b":function(e,t,a){},"0ac6":function(e,t,a){},"0cb7":function(e,t,a){},"0d5a":function(e,t){var a={30201:{location_name:"北京"},31601:{location_name:"天津"},30301:{location_name:"上海"},31801:{location_name:"重庆"}},r={319:{location_name:"黑龙江"},321:{location_name:"吉林"},311:{location_name:"辽宁"},312:{location_name:"河北"},323:{location_name:"山西"},326:{location_name:"内蒙古"},306:{location_name:"山东"},305:{location_name:"江苏"},304:{location_name:"浙江"},320:{location_name:"江西"},317:{location_name:"安徽"},307:{location_name:"福建"},309:{location_name:"湖北"},313:{location_name:"湖南"},310:{location_name:"河南"},301:{location_name:"广东"},315:{location_name:"广西"},328:{location_name:"海南"},308:{location_name:"四川"},324:{location_name:"贵州"},322:{location_name:"云南"},334:{location_name:"西藏"},314:{location_name:"陕西"},330:{location_name:"甘肃"},331:{location_name:"宁夏"},329:{location_name:"新疆"},333:{location_name:"青海"},32501:{location_name:"香港"},32701:{location_name:"台湾"},33201:{location_name:"澳门"},33501:{location_name:"美国"},33601:{location_name:"加拿大"},33701:{location_name:"澳大利亚"},33801:{location_name:"英国"},33901:{location_name:"马来西亚"},34001:{location_name:"日本"},34101:{location_name:"新加坡"},34201:{location_name:"海外其他"}};t.locationObj=r,t.hotCity=a},1:function(e,t,a){e.exports=a("5f8d")},"156f":function(e,t,a){},"1a7e":function(e,t,a){},"29a2":function(e,t,a){},"34dd":function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-table",{attrs:{data:e.dataList,height:"1000",id:e.strategySetTabId}},[a("el-table-column",{attrs:{width:"60",prop:"origin_strategy_set.strategy_set_id",label:"编号"}}),a("el-table-column",{attrs:{label:"策略名",width:"260"},scopedSlots:e._u([{key:"default",fn:function(t){return["audit"==e.from?a("router-link",{attrs:{to:{path:"/strategy/audit_detail",query:{strategy_set_id:t.row.origin_strategy_set.strategy_set_id}}}},[e._v(e._s(t.row.origin_strategy_set.strategy_set_name))]):a("router-link",{attrs:{to:{path:"/strategy/detail",query:{strategy_set_id:t.row.origin_strategy_set.strategy_set_id}}}},[e._v(e._s(t.row.origin_strategy_set.strategy_set_name))])]}}])}),a("el-table-column",{attrs:{label:"状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:t.row.status_cls}},[e._v(e._s(t.row.strategy_set_status_text))])]}}])}),a("el-table-column",{attrs:{prop:"strategy_set_type_name",label:"作用域",width:"140"}}),a("el-table-column",{attrs:{label:"描述",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-popover",{attrs:{placement:"top-start",width:"400",trigger:"hover",content:t.row.origin_strategy_set.strategy_set_comment}},[t.row.origin_strategy_set.strategy_set_comment.length<=20?a("a",{attrs:{slot:"reference",href:"javascript:;"},slot:"reference"},[a("span",[e._v(e._s(t.row.origin_strategy_set.strategy_set_comment))])]):a("a",{attrs:{slot:"reference",href:"javascript:;"},slot:"reference"},[a("span",[e._v(e._s(t.row.origin_strategy_set.strategy_set_comment.substr(0,20)+"..."))])])])]}}])}),a("el-table-column",{attrs:{label:"产品线",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.product_chinese_name)+" | "+e._s(t.row.exp_zone_chinese_name))]}}])}),a("el-table-column",{attrs:{prop:"origin_strategy_set.creator",label:"创建者",width:"120"}}),a("el-table-column",{attrs:{label:"实验状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.online_exp_layer_id>0?a("span",{staticClass:"text-center"},[a("span",{staticStyle:{color:"green"},on:{click:function(a){return e.onlineExpButton(t.row.online_exp_layer_id)}}},[e._v("实验中")])]):0==t.row.origin_strategy_set.strategy_set_status||0!=t.row.origin_strategy_set.to_audit_status?a("span",{staticClass:"text-center"},[a("a",{attrs:{href:"javascript:;"}},[a("label",{staticClass:"label-sm",staticStyle:{padding:".2em .6em .3em"}},[e._v("--")])])]):a("span",{staticClass:"text-center"},["0"==t.row.origin_strategy_set.strategy_set_status?a("a",{attrs:{href:"javascript:;"}},[e._v("无")]):0==t.row.origin_strategy_set.strategy_set_type?a("a",{attrs:{href:"javascript:;"},on:{click:function(a){return e.toCreateExp(t.row.origin_strategy_set.strategy_set_id)}}},[a("span",[e._v("创建实验")])]):1==t.row.origin_strategy_set.strategy_set_type?a("a",{attrs:{href:"javascript:;"},on:{click:function(a){return e.toCreateCustomerExp(t.row.origin_strategy_set.strategy_set_id)}}},[a("span",[e._v("创建实验")])]):2==t.row.origin_strategy_set.strategy_set_type?a("a",{staticClass:"dropdown",attrs:{href:"javascript:;"}},[a("span",{staticClass:"dropdown-toggle",attrs:{id:"dropdownMenu"+t.row.origin_strategy_set.strategy_set_id,"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"}},[a("span",[e._v("创建实验")])]),a("ul",{staticClass:"dropdown-menu",attrs:{"aria-labelledby":"dropdownMenu"+t.row.origin_strategy_set.strategy_set_id}},[a("li",[a("a",{attrs:{href:"javascript:;"},on:{click:function(a){return e.toCreateExp(t.row.origin_strategy_set.strategy_set_id)}}},[e._v("流量侧实验")])]),a("li",[a("a",{attrs:{href:"javascript:;"},on:{click:function(a){return e.toCreateCustomerExp(t.row.origin_strategy_set.strategy_set_id)}}},[e._v("商业侧实验")])])])]):e._e()])]}}])})],1)],1)},s=[],n={props:["strategySetList","strategySetTabId","from"],data:function(){return{dataList:[]}},watch:{strategySetList:function(e,t){this.dataList=e}},methods:{toCreateCustomerExp:function(e){this.$router.push({path:"/lab/create_exp_step",query:{strategy_set_id:e,exp_layer_type:1}})},toCreateExp:function(e){this.$router.push({path:"/lab/create_exp_step",query:{strategy_set_id:e,exp_layer_type:0}})},onlineExpButton:function(e){this.$router.push({path:"/lab/detail",query:{exp_layer_id:e}})}}},i=n,o=a("2877"),l=Object(o["a"])(i,r,s,!1,null,null,null);t["a"]=l.exports},3580:function(e,t,a){},"35bf":function(e,t,a){"use strict";var r=a("d081"),s=a.n(r);s.a},"376b":function(e,t,a){function r(e){for(var t=[],a=e.querySelectorAll("tr"),r=[],s=0;s<a.length;++s){for(var n=[],i=a[s],o=i.querySelectorAll("td"),l=0;l<o.length;++l){var c=o[l],u=c.getAttribute("colspan"),p=c.getAttribute("rowspan"),_=c.innerText;if(""!==_&&_==+_&&(_=+_),r.forEach((function(e){if(s>=e.s.r&&s<=e.e.r&&n.length>=e.s.c&&n.length<=e.e.c)for(var t=0;t<=e.e.c-e.s.c;++t)n.push(null)})),(p||u)&&(p=p||1,u=u||1,r.push({s:{r:s,c:n.length},e:{r:s+parseInt(p)-1,c:n.length+parseInt(u)-1}})),n.push(""!==_?_:null),u)for(var d=0;d<u-1;++d)n.push(null)}t.push(n)}return[t,r]}function s(e,t){t&&(e+=1462);var a=Date.parse(e);return(a-new Date(Date.UTC(1899,11,30)))/864e5}function n(e,t){for(var a={},r={s:{c:1e7,r:1e7},e:{c:0,r:0}},n=0;n!=e.length;++n)for(var i=0;i!=e[n].length;++i){r.s.r>n&&(r.s.r=n),r.s.c>i&&(r.s.c=i),r.e.r<n&&(r.e.r=n),r.e.c<i&&(r.e.c=i);var o={v:e[n][i]};if(null!=o.v){var l=XLSX.utils.encode_cell({c:i,r:n});"number"===typeof o.v?o.t="n":"boolean"===typeof o.v?o.t="b":o.v instanceof Date?(o.t="n",o.z=XLSX.SSF._table[14],o.v=s(o.v)):o.t="s",a[l]=o}}return r.s.c<1e7&&(a["!ref"]=XLSX.utils.encode_range(r)),a}function i(){if(!(this instanceof i))return new i;this.SheetNames=[],this.Sheets={}}function o(e){for(var t=new ArrayBuffer(e.length),a=new Uint8Array(t),r=0;r!=e.length;++r)a[r]=255&e.charCodeAt(r);return t}a("4160"),a("a15b"),a("fb6a"),a("c19f"),a("ace4"),a("b0c0"),a("d3b7"),a("e25e"),a("ac1f"),a("25f0"),a("466d"),a("1276"),a("5cc6"),a("9a8c"),a("a975"),a("735e"),a("c1ac"),a("d139"),a("3a7b"),a("d5d6"),a("82f8"),a("e91f"),a("60bd"),a("5f96"),a("3280"),a("3fcc"),a("ca91"),a("25a1"),a("cd26"),a("3c5d"),a("2954"),a("649e"),a("219c"),a("170b"),a("b39a"),a("72f7"),a("0fd4"),a("1447"),
/*! @source http://purl.eligrey.com/github/Blob.js/blob/master/Blob.js */
function(e){"use strict";if(e.URL=e.URL||e.webkitURL,e.Blob&&e.URL)try{return void new Blob}catch(a){}var t=e.BlobBuilder||e.WebKitBlobBuilder||e.MozBlobBuilder||function(e){var t=function(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]},a=function(){this.data=[]},r=function(e,t,a){this.data=e,this.size=e.length,this.type=t,this.encoding=a},s=a.prototype,n=r.prototype,i=e.FileReaderSync,o=function(e){this.code=this[this.name=e]},l="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),c=l.length,u=e.URL||e.webkitURL||e,p=u.createObjectURL,_=u.revokeObjectURL,d=u,f=e.btoa,h=e.atob,m=e.ArrayBuffer,y=e.Uint8Array;r.fake=n.fake=!0;while(c--)o.prototype[l[c]]=c+1;return u.createObjectURL||(d=e.URL={}),d.createObjectURL=function(e){var t,a=e.type;return null===a&&(a="application/octet-stream"),e instanceof r?(t="data:"+a,"base64"===e.encoding?t+";base64,"+e.data:"URI"===e.encoding?t+","+decodeURIComponent(e.data):f?t+";base64,"+f(e.data):t+","+encodeURIComponent(e.data)):p?p.call(u,e):void 0},d.revokeObjectURL=function(e){"data:"!==e.substring(0,5)&&_&&_.call(u,e)},s.append=function(e){var a=this.data;if(y&&(e instanceof m||e instanceof y)){for(var s="",n=new y(e),l=0,c=n.length;l<c;l++)s+=String.fromCharCode(n[l]);a.push(s)}else if("Blob"===t(e)||"File"===t(e)){if(!i)throw new o("NOT_READABLE_ERR");var u=new i;a.push(u.readAsBinaryString(e))}else e instanceof r?"base64"===e.encoding&&h?a.push(h(e.data)):"URI"===e.encoding?a.push(decodeURIComponent(e.data)):"raw"===e.encoding&&a.push(e.data):("string"!==typeof e&&(e+=""),a.push(unescape(encodeURIComponent(e))))},s.getBlob=function(e){return arguments.length||(e=null),new r(this.data.join(""),e,"raw")},s.toString=function(){return"[object BlobBuilder]"},n.slice=function(e,t,a){var s=arguments.length;return s<3&&(a=null),new r(this.data.slice(e,s>1?t:this.data.length),a,this.encoding)},n.toString=function(){return"[object Blob]"},n.close=function(){this.size=this.data.length=0},a}(e);e.Blob=function(e,a){var r=a&&a.type||"",s=new t;if(e)for(var n=0,i=e.length;n<i;n++)s.append(e[n]);return s.getBlob(r)}}("undefined"!==typeof self&&self||"undefined"!==typeof window&&window||this.content||this);var l=function(e,t){var a=document.getElementById(e),s=r(a),l=s[1],c=s[0],u="SheetJS",p=new i,_=n(c);_["!merges"]=l,p.SheetNames.push(u),p.Sheets[u]=_;var d=XLSX.write(p,{bookType:"xlsx",bookSST:!1,type:"binary"});saveAs(new Blob([o(d)],{type:"application/octet-stream"}),t+".xlsx")};t.export_table_to_excel=l},"38ac":function(e,t,a){},3991:function(e,t,a){},"3bc5":function(e,t,a){},"3d2d":function(e,t,a){e.exports=a.p+"img/ele_strategy.a170a657.png"},"3dfa":function(e,t,a){},"3e13":function(e,t,a){},"423a":function(e,t,a){"use strict";var r=a("7e63"),s=a.n(r);s.a},4291:function(e,t,a){"use strict";var r=a("095b"),s=a.n(r);s.a},"4e84":function(e,t,a){"use strict";var r=a("e47c"),s=a.n(r);s.a},"5f8d":function(e,t,a){"use strict";a.r(t);a("b0c0"),a("e260"),a("e6cf"),a("cca6"),a("a79d");var r=a("a026"),s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",{attrs:{id:"app"}},[a("el-container",[a("el-header",{attrs:{height:e.headerHeight}},[a("myheader",{attrs:{userName:e.userName,userType:e.userType,contentType:"exp"},on:{setHeaderHeight:e.setHeaderHeight,showMyAccess:e.showMyAccess}})],1),a("el-container",[a("el-aside",{attrs:{width:e.showSlideMenu?e.open:e.close}},[a("slidemenu",{staticStyle:{"overflow-y":"auto","ovreflow-x":"hidden"},attrs:{currentMenuData:e.currentMenuData},on:{expand:e.expand}})],1),a("el-main",{staticStyle:{"margin-bottom":"200px"}},[e._e(),a("el-row",[a("el-col",{attrs:{span:21}},[a("el-breadcrumb",{attrs:{"separator-class":"el-icon-arrow-right"}},[a("el-breadcrumb-item",{attrs:{to:{path:"/"}}},[a("strong",[e._v("首页")])]),e._l(e.$route.meta.title,(function(t,r){return a("el-breadcrumb-item",{key:r},[a("strong",[e._v(e._s(t))])])})),""!=e.$store.state.user.headbreadcrumb?a("el-breadcrumb-item",[a("strong",[e._v(e._s(e.$store.state.user.headbreadcrumb))])]):e._e()],2)],1)],1),a("el-divider"),a("keep-alive",[e.$route.meta.keepAlive?a("router-view",{on:{"hook:mounted":e.handleChildMounted,"hook:beforeMount":e.handleChildBeforeMount,getSlideMenuStatInfo:e.getSlideMenuStatInfo}}):e._e()],1),e.$route.meta.keepAlive?e._e():a("router-view",{on:{"hook:mounted":e.handleChildMounted,"hook:beforeMount":e.handleChildBeforeMount,getSlideMenuStatInfo:e.getSlideMenuStatInfo,fixedTableHead:e.fixedTableHead}})],1)],1)],1),a("el-dialog",{attrs:{title:"我的权限",visible:e.showAccess},on:{"update:visible":function(t){e.showAccess=t}}},[a("el-table",{attrs:{data:e.myAccess}},[a("el-table-column",{attrs:{property:"product_chinese_name",label:"产品线"}}),a("el-table-column",{attrs:{property:"user_type_name",label:"权限类型"}})],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.showAccess=!1}}},[e._v("确认")]),a("el-button",{on:{click:function(t){e.showAccess=!1}}},[a("router-link",{attrs:{to:{path:"/user/apply_access"}}},[e._v("权限申请")])],1)],1)],1)],1)},n=[],i=(a("4160"),a("c975"),a("159b"),a("96cf"),a("1da1")),o=a("d995"),l=a("ce1a"),c=(a("d1ab"),a("adf6"),[{iconfont:"el-icon-s-opportunity",mainMenuName:"实验",name:"Exp",secondLevelMenu:[{secondLevelMenuName:"新建实验",url:"/lab/create_exp_step",userType:[2,4,10],name:"create_exp_step"},{secondLevelMenuName:"实验列表",url:"/lab/list",userType:[1,2,4,10],name:"lab_list"},{secondLevelMenuName:"实验检验",url:"/monitor/exp_effect",userType:[1,2,4,10],name:"ExpEffectViewNew"}]},{iconfont:"el-icon-set-up",mainMenuName:"策略",userType:[1,2,4,10],name:"Strategy",secondLevelMenu:[{secondLevelMenuName:"新增策略",url:"/strategy/create",userType:[2,4,10],name:"strategy_create"},{secondLevelMenuName:"策略池",url:"/strategy/index",userType:[1,2,4,10],name:"strategy_index"}]},{iconfont:"el-icon-time",mainMenuName:"日志",name:"ExpCheck",secondLevelMenu:[{secondLevelMenuName:"实验快照",url:"/snapshot/list",userType:[1,2,4,10],name:"snapshot_list"},{secondLevelMenuName:"系统事件",url:"/index/all_record",userType:[1,2,4,10],name:"AllRecord"},{secondLevelMenuName:"平台更新日志",url:"/index/all_log",userType:[],name:"AllLog",badge:"new"},{secondLevelMenuName:"实验数据质量",url:"/monitor/stat_data_check",userType:[],name:"stat_realtime_data_check"},{secondLevelMenuName:"实验指标池",url:"/quota/list",userType:[2,4,10],name:"QuotaList"}]},{iconfont:"el-icon-user",mainMenuName:"审核",userType:[4,10],name:"Admin",secondLevelMenu:[{secondLevelMenuName:"实验",url:"/lab/pending",userType:[],name:"lab_pending"},{secondLevelMenuName:"策略",url:"/strategy/audit_list",userType:[],name:"strategy_audit_list"}]},{iconfont:"el-icon-message",mainMenuName:"权限",name:"Access",userType:[0],secondLevelMenu:[{secondLevelMenuName:"申请权限",url:"/user/apply_access",userType:[],name:"apply_access"}]}]),u=c,p=a("c1df"),_=a.n(p),d={name:"Exp",data:function(){return{close:"64px",open:"210px",headerHeight:"60px",showSlideMenu:!0,currentMenuData:[],userType:0,userName:"",PageInitAt:"",showAccess:!1,myAccess:[],user_height:"0px"}},components:{myheader:o["a"],slidemenu:l["a"]},methods:{getUserInfo:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.user.getUserInfoByGo();case 2:return t=e.sent,0==t.errcode&&(this.userType=t.data.user_type,this.userName=t.data.user_name),this.$store.commit("setUsername",this.userName),this.$store.commit("setUserType",this.userType),localStorage.setItem("userType",this.userType),localStorage.setItem("userName",this.userName),this.setSlideMenu(),this.userType<=0&&this.$alert("你暂时没有访问法拉第的权限，若要访问请申请权限",{confirmButtonText:"确定",callback:function(){return a.$router.push({path:"/user/apply_access"})}}),e.abrupt("return");case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),handleChildBeforeMount:function(){this.$store.commit("setHeadBreadCrumb","")},handleChildMounted:function(){this.sendPageView(),this.getSlideMenuStatInfo(),this.checkUpdatePage()},checkUpdatePage:function(){var e=this.PageInitAt;_()(e).isBefore(_()().subtract(3600,"s"))&&window.location.reload()},sendPageView:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=this.$route.path,a=this.$tool.obj2QueryString(this.$route.query),""!=a&&(t+="?"+a),t+="&version=3.0",this.$api.user.sendPvStat(t);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getSlideMenuStatInfo:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a,r,s,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(this.$store.state.user.user_type<4)){e.next=2;break}return e.abrupt("return",!1);case 2:return t=3,e.next=5,this.$api.exp.getExpCount();case 5:a=e.sent,r=a.data.audit_exp_count>0?a.data.audit_exp_count:"",s=a.data.audit_strategy_count>0?a.data.audit_strategy_count:"",n=r+s>0?r+s:"",this.$set(this.currentMenuData[t].secondLevelMenu[0],"badge",r),this.$set(this.currentMenuData[t].secondLevelMenu[1],"badge",s),this.$set(this.currentMenuData[t],"badge",n);case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),setSlideMenu:function(){var e=this,t=[];u.forEach((function(a,r){var s=[];a.secondLevelMenu.forEach((function(t){(void 0==t.userType||0==t.userType.length||t.userType.indexOf(e.userType)>-1)&&s.push(t)})),(void 0==a.userType||0==a.userType.length||a.userType.indexOf(e.userType)>-1)&&(a.secondLevelMenu=s,t.push(a))})),this.currentMenuData=t,this.getSlideMenuStatInfo()},expand:function(e){this.$set(this,"showSlideMenu",e)},setHeaderHeight:function(e){this.headerHeight=e},showMyAccess:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.user.getUserAccess(this.$store.state.user.username);case 2:t=e.sent,this.myAccess=t.data,this.showAccess=!0;case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),setPageInitTime:function(){this.PageInitAt=_()().format("YYYY-MM-DD HH:mm:ss")},fixedTableHead:function(e){$(e).length<1||(this.unFixedTableHead(),$(window).scroll((function(){var t=$(e).offset().top-$(window).scrollTop()-$(".el-header").height(),a=$(e).offset().top+$(e)[0].offsetHeight-$(window).scrollTop()-$(".navbar").height();t<=0&&a>0?(console.log($(e+" thead").length),$(e+" thead").css({transform:"translateY("+-t+"px)"})):$(e+" thead").css({transform:"translateY(0)"})})))},unFixedTableHead:function(){$(window).unbind("scroll")}},mounted:function(){var e=this,t=localStorage;t.getItem("vuetour")||setTimeout((function(){e.$tours["myTour"].start()}),3e3),t.setItem("vuetour",!0),this.setPageInitTime(),this.getUserInfo()}},f=d,h=(a("e15c"),a("2877")),m=Object(h["a"])(f,s,n,!1,null,null,null),y=m.exports,g=(a("a15b"),a("8c4f")),b=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("el-row",{staticStyle:{"margin-top":"20px"}},[r("el-col",{attrs:{align:"center",span:5,offset:2,xs:18}},[r("el-card",{staticClass:"box-card card"},[r("el-row",[r("img",{attrs:{src:a("c0c5")}})]),r("p",{staticClass:"title"},[e._v("实验")]),r("p",{staticClass:"desc"},[e._v("创建实验、实验列表、实验检验")]),r("p",[r("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.clickTo("/monitor/exp_effect")}}},[e._v("实验检验")])],1)],1)],1),r("el-col",{attrs:{align:"center",span:5,xs:18}},[r("el-card",{staticClass:"box-card card"},[r("el-row",[r("img",{attrs:{src:a("3d2d")}})]),r("p",{staticClass:"title"},[e._v("策略")]),r("p",{staticClass:"desc"},[e._v("策略创建、策略修改、策略列表")]),r("p",[r("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.clickTo("/strategy/index")}}},[e._v("查看策略")])],1)],1)],1),r("el-col",{attrs:{align:"center",span:5,xs:18}},[r("el-card",{staticClass:"box-card card"},[r("el-row",[r("img",{attrs:{src:a("d280")}})]),r("p",{staticClass:"title"},[e._v("日志")]),r("p",{staticClass:"desc"},[e._v("操作记录、实验指标、实验日志")]),r("p",[r("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.clickTo("/index/all_record")}}},[e._v("实验日志")])],1)],1)],1),r("el-col",{attrs:{align:"center",span:5,xs:18}},[r("el-card",{staticClass:"box-card card"},[r("el-row",[r("img",{attrs:{src:a("87ad")}})]),r("p",{staticClass:"title"},[e._v("审核")]),r("p",{staticClass:"desc"},[e._v("实验审核、策略审核")]),e.$store.state.user.user_type>2?r("p",[r("el-button",{attrs:{type:"warning",size:"mini"},on:{click:function(t){return e.clickTo("/lab/pending")}}},[e._v("实验审核")])],1):e._e()],1)],1)],1)},x=[],v={methods:{clickTo:function(e){this.$router.push({path:e})}}},w=v,k=(a("35bf"),Object(h["a"])(w,b,x,!1,null,null,null)),S=k.exports,I=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",{staticStyle:{"margin-top":"20px"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"left",size:"small",format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",clearable:!1,"unlink-panels":!0,"time-arrow-control":!0}})],1)},L=[],D={data:function(){return{timeArea:[],pickerOptions:{shortcuts:[{text:"今日",onClick:function(e){e.$emit("pick",[_()().startOf("day").toDate(),_()().toDate()])}},{text:"昨日",onClick:function(e){e.$emit("pick",[_()().subtract("days",1).startOf("day").toDate(),_()().startOf("day").toDate()])}},{text:"最近3日",onClick:function(e){e.$emit("pick",[_()().subtract("days",3).startOf("day").toDate(),_()().startOf("day").toDate()])}},{text:"最近一周",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}}]}}},mounted:function(){this.$set(this,"timeArea",["2019-10-16 10:30",_()().format("YYYY-MM-DD HH:mm")])},methods:{}},C=D,E=Object(h["a"])(C,I,L,!1,null,null,null),T=E.exports,O=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("el-col",{attrs:{span:16,offset:3}},[a("el-form",{ref:"form",attrs:{inline:!0}},[a("el-form-item",{attrs:{label:"时间选择"}},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"left",size:"small",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd"},model:{value:e.time,callback:function(t){e.time=t},expression:"time"}})],1),a("el-form-item",[a("el-checkbox-group",{model:{value:e.valType,callback:function(t){e.valType=t},expression:"valType"}},[a("el-checkbox",{attrs:{label:"kunkka"}},[e._v("Kunkka")]),a("el-checkbox",{attrs:{label:"faraday"}},[e._v("法拉第")])],1)],1),a("el-form-item",{staticStyle:{"padding-left":"80px"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.getAllRecord}},[e._v("查询")])],1)],1),a("el-form",{attrs:{inline:!0}},[a("el-form-item",{attrs:{label:"产品线"}},[a("el-select",{attrs:{placeholder:"产品线"},model:{value:e.exp_zone,callback:function(t){e.exp_zone=t},expression:"exp_zone"}},[a("el-option",{attrs:{label:"全部",value:0}}),e._l(e.expZoneList,(function(t,r){return e.expZones.indexOf(t.exp_zone_code)>-1?a("el-option",{key:r,attrs:{label:t.product_chinese_name+"-"+t.exp_zone_chinese_name,value:t.exp_zone_code}}):e._e()}))],2),e._v(" 只筛选"),a("strong",[e._v("法拉第")]),e._v("事件 ")],1)],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:18,offset:2}},[a("loading",{attrs:{state:e.loadState}}),a("Timeline",{attrs:{data:e.dataFilt},scopedSlots:e._u([{key:"detail",fn:function(t){return["faraday"==t.record.source?a("el-row",{staticStyle:{padding:"20px 0"}},[a("el-col",{attrs:{span:24}},e._l(t.record.faraday_series_event,(function(t){return a("div",{staticClass:"common-card page-wrapper-header-item",staticStyle:{"margin-top":"7px",overflow:"hidden"}},[a("div",{staticClass:"detail",staticStyle:{padding:"0 10px"}},[a("strong",[e._v(e._s(t.action_text))]),a("div",{staticClass:"pull-right"},[a("span",{staticClass:"label label-default p-break"},[e._v(e._s(t.record.user_name))]),a("span",{staticClass:"label label-success p-break"},[e._v(e._s(t.record.create_time.substr(5,11)))])])])])})),0)],1):"kunkka"==t.record.source?a("el-row",{staticStyle:{padding:"20px 0"}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"common-card page-wrapper-header-item"},[a("div",{staticClass:"detail p-break",staticStyle:{padding:"10px"}},[a("b",[e._v("项目名：")]),e._v(" "+e._s(t.record.kunkka_series_event[0].project)+" "),a("br"),a("br"),a("b",[e._v("创建人：")]),e._v(" "+e._s(t.record.kunkka_series_event[0].creator)+" "),a("br"),a("br"),a("b",[e._v("目标主机（分组）：")]),e._v(" "+e._s(t.record.kunkka_series_event[0].groups)+" "),a("br"),a("br"),a("b",[e._v("上线版本：")]),e._v(" "+e._s(t.record.kunkka_series_event[0].release)+" "),a("br"),a("br"),a("b",[e._v("描述：")]),e._v(" "+e._s(t.record.kunkka_series_event[0].describe)+" ")])])])],1):e._e()]}}])})],1)],1)],1)},j=[],R=(a("4de4"),a("4e82"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("ul",{staticClass:"timeline"},e._l(e.listData,(function(t){return a("li",{staticClass:"item"},[a("span",{staticClass:"date"},[e._v(" "+e._s(t.date)+" "),a("br"),e._v(" "+e._s(t.time)+" ")]),a("span",{staticClass:"action",domProps:{innerHTML:e._s(t.event_name)}}),a("span",{staticClass:"operator"},[e._v(e._s(t.user_name))]),e._t("detail",null,{record:t})],2)})),0)])}),q=[],A={props:["data"],data:function(){return{listData:[]}},watch:{data:function(e,t){this.listData=e}},mounted:function(){this.getExpRecord()},methods:{getExpRecord:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.listData=this.data;case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},M=A,B=(a("da17"),Object(h["a"])(M,R,q,!1,null,"7a81e38c",null)),P=B.exports,Q={data:function(){return{time:[],list:[],loadState:"",valType:["kunkka","faraday"],exp_zone:0,expZones:[],expZoneList:[]}},components:{Timeline:P},mounted:function(){this.time=[_()().subtract(2,"days").format("YYYY-MM-DD"),_()().format("YYYY-MM-DD")],this.getExpZones(),this.getAllRecord()},computed:{dataFilt:function(){var e=this;return this.list.filter((function(t){var a=e.valType;return a.length<1&&(a=["faraday","kunkka"]),e.exp_zone<1?a.indexOf(t.source)>-1:a.indexOf("faraday")>-1&&"faraday"==t.source?t.exp_zone_code==e.exp_zone:a.indexOf("kunkka")>-1?"kunkka"==t.source:void 0}))}},methods:{getAllRecord:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.list=[],this.loadState="loading",e.next=4,this.$api.user.getAllRecordByGo(this.time);case 4:if(t=e.sent,t.data){e.next=8;break}return this.loadState="暂无数据",e.abrupt("return");case 8:this.loadState="",a=t.data.sort(this.compare),this.$set(this,"list",a),r=[],this.list.forEach((function(e){r.push(e.exp_zone_code)})),this.expZones=r;case 14:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),compare:function(e,t){var a=_()(e.create_time),r=_()(t.create_time);return a.isBefore(r)?1:a.isAfter(r)?-1:0},getExpZones:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.user.getUserExpZoneList(4);case 2:t=e.sent,this.expZoneList=t.data;case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},U=Q,N=Object(h["a"])(U,O,j,!1,null,null,null),z=N.exports,H=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("el-col",{attrs:{span:18,offset:2}},[a("Timeline",{attrs:{data:e.listData},scopedSlots:e._u([{key:"detail",fn:function(t){return[0!=t.record.list.length?a("el-card",{staticClass:"box-card",staticStyle:{margin:"20px 0 30px 0"}},e._l(t.record.list,(function(t){return a("p",[e._v(e._s(t))])})),0):e._e()]}}])})],1)],1)],1)},F=[],V={data:function(){return{listData:[{date:"2019-10-08",event_name:"<strong>法拉第体系全新改版</strong>",list:["1. 全面使用element-ui","2. 实验创建按步骤进行","3. 实验检验页面一分为二，筛选更便捷"]},{date:"2019-08-02",event_name:"<strong>实验、策略详情页优化展示</strong>",list:["1. 页面更具动感","2. 子实验与基准子实验策略不同的标红展示"]},{date:"2019-08-01",event_name:"<strong>新增申请权限页面</strong>",list:["1. 我的权限转移到导航栏``我``的二级菜单","2. 新增权限申请页面，通知超级管理员添加权限"]},{date:"2019-07-31",event_name:"<strong>新增法拉第控制台更新记录页面</strong>",list:[]},{date:"2019-07-22",event_name:"<strong>策略列表、实验列表重构</strong>",list:["1. 全部策略添加分页","2. 实验列表按实验状态分类展示","3. 策略、实验搜索优化"]},{date:"2019-07-16",event_name:"<strong>权限体系升级</strong>",list:["1. 策略区分效果实验 功能控制","2. 自行添加策略/实验协作者","3. 审核邮件通知"]}]}},components:{Timeline:P},mounted:function(){},computed:{},methods:{}},G=V,W=Object(h["a"])(G,H,F,!1,null,null,null),Z=W.exports,K=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-tabs",{attrs:{type:"border-card"},model:{value:e.tabType,callback:function(t){e.tabType=t},expression:"tabType"}},[a("el-tab-pane",{attrs:{label:"全部策略",name:"all"}},[a("StrategyAllList")],1),a("el-tab-pane",{attrs:{label:"我的策略",name:"mine"}},[a("StrategyMyList")],1)],1)],1)},Y=[],J=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("el-col",{staticStyle:{"margin-bottom":"10px"},attrs:{span:e.colWidth}},[a("el-input",{attrs:{placeholder:"输入策略、描述或创建人，自动检索"},on:{input:e.filterBykey,focus:e.filterGetFocus},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[e.searchShow?e._e():a("el-button",{attrs:{slot:"append",icon:"el-icon-close"},on:{click:e.filterLostFocus},slot:"append"})],1)],1),e.searchShow?a("el-col",{attrs:{span:17,offset:1,size:"small"}},[a("el-form",{attrs:{inline:!0}},[a("el-form-item",{staticStyle:{"margin-bottom":"10px"},attrs:{label:"产品线"}},[a("el-select",{on:{change:e.changeList},model:{value:e.filter.product_code,callback:function(t){e.$set(e.filter,"product_code",t)},expression:"filter.product_code"}},e._l(e.productList,(function(e,t){return a("el-option",{key:t,attrs:{label:e.product_chinese_name,value:e.product_code}})})),1)],1),a("el-form-item",{staticStyle:{"margin-bottom":"10px"},attrs:{label:"状态"}},[a("el-select",{on:{change:e.changeList},model:{value:e.filter.strategy_set_status,callback:function(t){e.$set(e.filter,"strategy_set_status",t)},expression:"filter.strategy_set_status"}},e._l(e.strategySetStatusList,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.val}})})),1)],1),a("el-form-item",{staticStyle:{"margin-bottom":"10px"},attrs:{label:"类型"}},[a("el-select",{on:{change:e.changeList},model:{value:e.filter.strategy_set_type,callback:function(t){e.$set(e.filter,"strategy_set_type",t)},expression:"filter.strategy_set_type"}},e._l(e.strategySetTypeList,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.code}})})),1)],1)],1)],1):e._e(),a("el-col",{staticStyle:{float:"right"},attrs:{span:2}},[a("el-button",{attrs:{id:"export",type:"warning",icon:"el-icon-download"},on:{click:e.doit}},[e._v("导出")])],1)],1),a("StrategyListTable",{attrs:{strategySetList:e.datas,strategySetTabId:"allStrategy",from:"allList"}}),e.pageShow?a("div",{staticStyle:{"text-align":"center","margin-top":"20px"}},[a("el-pagination",{attrs:{"current-page":e.pageIndex,layout:"total, prev, pager, next",total:e.total,"page-size":20,align:"center","hide-on-single-page":!0},on:{"current-change":e.swicthPage,"update:currentPage":function(t){e.pageIndex=t},"update:current-page":function(t){e.pageIndex=t}}})],1):e._e()],1)},X=[],ee=a("34dd"),te=a("2b00"),ae={name:"StrategyAllList",data:function(){return{strategySetTabId:"allList",keyword:"",datas:[],productList:[],filter:{product_code:783,strategy_set_status:"all",strategy_set_type:-1},pageIndex:1,pageShow:!0,searchShow:!0,colWidth:4,total:10,strategySetStatusList:[{val:"all",name:"全部"},{val:"online",name:"生效中"},{val:"audit",name:"待审核"},{val:"offline",name:"未生效"}],strategySetTypeList:[{code:-1,name:"全部"},{code:0,name:"流量测"},{code:1,name:"广告主测"},{code:2,name:"流量测+广告主测"}]}},components:{StrategyListTable:ee["a"],debounce:te["a"]},mounted:function(){this.getList(),this.getProductList()},methods:{changeList:function(){this.pageIndex=1,this.getList()},swicthPage:function(){this.getList()},getList:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.pageShow=!0,t={page:this.pageIndex,strategy_set_type:this.filter.strategy_set_type,product_code:this.filter.product_code,strategy_set_status:this.filter.strategy_set_status},e.next=4,this.$api.strategy.getAllListByGo(t);case 4:if(a=e.sent,0==a.errcode){e.next=8;break}return this.$set(this,"datas",[]),e.abrupt("return");case 8:this.$set(this,"datas",a.data.list),this.total=a.data.total;case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),doit:function(){this.Export2Excel.export_table_to_excel("allStrategy","所有实验策略")},getProductList:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.strategy.getProductList();case 2:t=e.sent,this.productList=this.$lodash.uniqBy(t.data,"product_code");case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),filterBykey:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.pageShow=!1,e.next=3,this.$api.strategy.dataFilter(this.keyword);case 3:t=e.sent,this.$set(this,"datas",t.data);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),filterGetFocus:function(){this.colWidth=12,this.searchShow=!1},filterLostFocus:function(){this.keyword="",this.getList(),this.colWidth=4,this.searchShow=!0}}},re=ae,se=Object(h["a"])(re,J,X,!1,null,null,null),ne=se.exports,ie=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-row",{staticStyle:{"margin-bottom":"10px"}},[a("el-col",{attrs:{span:10}},[a("el-input",{attrs:{placeholder:"输入策略、描述或创建人，自动检索"},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[""!=e.keyword?a("el-button",{attrs:{slot:"append",icon:"el-icon-close"},on:{click:function(t){e.keyword=""}},slot:"append"}):e._e()],1)],1),a("el-col",{attrs:{offset:12,span:2}},[a("el-button",{attrs:{id:"export",type:"warning",icon:"el-icon-download"},on:{click:e.doit}},[e._v("导出")])],1)],1),a("StrategyListTable",{attrs:{strategySetList:e.showDatas,strategySetTabId:"myStrategy"}})],1)},oe=[],le=a("f709"),ce=le["a"],ue=Object(h["a"])(ce,ie,oe,!1,null,"9f5d0cf8",null),pe=ue.exports,_e={data:function(){return{tabType:"all"}},watch:{tabType:function(){localStorage.setItem("strategyType",this.tabType)}},components:{StrategyAllList:ne,StrategyMyList:pe},mounted:function(){var e=localStorage.getItem("strategyType");e&&(this.tabType=e)}},de=_e,fe=Object(h["a"])(de,K,Y,!1,null,null,null),he=fe.exports,me=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-row",{directives:[{name:"show",rawName:"v-show",value:e.strategySetInfo.show_add_user_tip,expression:"strategySetInfo.show_add_user_tip"}]},[a("el-col",{attrs:{span:20,offset:2}},[a("el-alert",{attrs:{type:"warning",closable:!1}},[a("p",{staticStyle:{"font-size":"14px"}},[e._v(" 想拥有该策略的编辑权限，请联系策略创建者 "),a("strong",{staticClass:"red-font"},[e._v(e._s(e.strategySetInfo.strategy_set.creator))]),e._v("为你添加协作者身份 ")])])],1)],1),a("el-row",[a("el-col",{staticStyle:{"margin-top":"20px"},attrs:{span:16,offset:4}},[a("FullVolumeConfirmList",{ref:"FullVolumeConfirmList",attrs:{strategySetId:e.$route.query.strategy_set_id}})],1)],1),a("el-row",[a("el-col",{attrs:{span:20,offset:2}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",{staticStyle:{color:"#d04925","font-size":"23px"}},[e._v(" 策略名称： "),a("strong",[e._v(e._s(e.strategySetInfo.strategy_set.strategy_set_name))]),e._v(" ("+e._s(e.strategySetInfo.strategy_set_type_name)+") ")]),a("span",{staticStyle:{display:"inline-block",float:"right"}},[a("el-button",{attrs:{type:"text"},on:{click:e.showUpdateRecord}},[e._v("变更记录")])],1)]),a("el-timeline",[a("el-timeline-item",{key:"1",attrs:{timestamp:e.strategySetInfo.strategy_set.create_time}},[a("el-tag",{attrs:{size:"medium"}},[e._v(e._s(e.strategySetInfo.strategy_set.creator))]),e._v("创建 ")],1),a("el-timeline-item",{key:"2",attrs:{timestamp:e.strategySetInfo.strategy_set.update_time}},[a("el-tag",{attrs:{size:"medium"}},[e._v(e._s(e.strategySetInfo.last_update_by))]),e._v("更新 ")],1)],1),a("el-divider"),a("el-form",{attrs:{"label-width":"120px"}},[a("el-form-item",{staticStyle:{"margin-bottom":"2px"},attrs:{label:"产品线："}},[e._v(e._s(e.strategySetInfo.product_chinese_name)+" | "+e._s(e.strategySetInfo.exp_zone_chinese_name))]),a("el-form-item",{staticStyle:{"margin-bottom":"2px"},attrs:{label:"审核人："}},[e._v(e._s(""!=e.strategySetInfo.strategy_set.assign_auditor?e.strategySetInfo.strategy_set.assign_auditor.replace(",","、"):"超级管理员"))]),a("el-form-item",{staticStyle:{"margin-bottom":"2px"},attrs:{label:"协作者："}},[e._v(" "+e._s(""!=e.strategySetInfo.strategy_set.access_user?e.strategySetInfo.strategy_set.access_user.replace(",","、"):"暂无")+" "),a("el-button",{attrs:{type:"warning",size:"small"},on:{click:e.toAddUser}},[a("i",{staticClass:"el-icon-plus"}),e._v("添加 ")])],1),a("el-form-item",{staticStyle:{"margin-bottom":"2px"},attrs:{label:"策略类型："}},[a("span",{staticStyle:{"font-size":"20px"}},[e._v(e._s("exp"==e.strategySetInfo.strategy_set.func?"效果实验":"功能控制"))])])],1),a("el-collapse",[a("el-collapse-item",{attrs:{name:"1"}},[a("template",{slot:"title"},[a("strong",{staticStyle:{"font-size":"16px"}},[e._v("描述")]),a("i",{staticClass:"header-icon el-icon-info"})]),a("div",{domProps:{innerHTML:e._s(e.strategySetInfo.strategy_set.strategy_set_comment.replace(/\n/g,"<br>"))}})],2)],1)],1),a("el-card",{staticClass:"box-card",staticStyle:{"margin-top":"10px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("h4",[a("strong",[e._v("策略构成")])])]),a("el-row",{attrs:{gutter:50}},e._l(e.strategySetInfo.strategy_list,(function(t){return a("el-col",{key:t.id,attrs:{span:12}},[a("el-card",{staticClass:"box-card",staticStyle:{"margin-top":"10px",height:"350px",overflow:"scroll"}},["string"==t.verify.type?a("el-alert",{staticStyle:{"margin-bottom":"10px"},attrs:{title:t.strategy_name,type:"info",effect:"dark",closable:!1}}):e._e(),"int"==t.verify.type?a("el-alert",{staticStyle:{"margin-bottom":"10px"},attrs:{title:t.strategy_name,type:"warning",effect:"dark",closable:!1}}):e._e(),"bool"==t.verify.type?a("el-alert",{staticStyle:{"margin-bottom":"10px"},attrs:{title:t.strategy_name,type:"success",effect:"dark",closable:!1}}):e._e(),a("p",{staticClass:"p-break"},[a("b",[e._v("默认值：")]),e._v(" "+e._s(t.strategy_defult_value)+" ")]),a("p",{staticClass:"p-break"},[a("b",[e._v("数据类型：")]),e._v(" "+e._s(t.verify.type)+" ")]),a("p",{directives:[{name:"show",rawName:"v-show",value:"int"==t.verify.type,expression:"item.verify.type == 'int'"}],staticClass:"p-break"},[a("b",[e._v("最小取值：")]),e._v(" "+e._s(t.verify.min)+" ")]),a("p",{directives:[{name:"show",rawName:"v-show",value:"int"==t.verify.type,expression:"item.verify.type == 'int'"}],staticClass:"p-break"},[a("b",[e._v("最大取值：")]),e._v(" "+e._s(t.verify.max)+" ")]),a("p",{directives:[{name:"show",rawName:"v-show",value:"string"==t.verify.type,expression:"item.verify.type == 'string'"}],staticClass:"p-break"},[a("b",[e._v("最大长度：")]),e._v(" "+e._s(t.verify.max_length)+" ")]),a("p",{staticClass:"p-break"},[a("b",[e._v("描述：")]),a("span",{domProps:{innerHTML:e._s(t.strategy_value_comment.replace(/\n/g,"<br>"))}})])],1)],1)})),1)],1),783==e.strategySetInfo.strategy_set.product_code?a("el-card",{staticClass:"box-card",staticStyle:{"margin-top":"10px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("h4",[e._v("域占用情况：")])]),a("SingelDomainLayer",{attrs:{strategySetId:e.strategySetId}})],1):e._e()],1)],1),a("el-row",[a("el-col",{attrs:{span:20,offset:2}},[a("el-card",{staticClass:"box-card",staticStyle:{"margin-top":"10px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("h4",[a("strong",[e._v("实验列表")])])]),a("ExpTable",{attrs:{listData:e.layerList}}),a("el-pagination",{staticStyle:{"margin-top":"20px"},attrs:{"current-page":e.page,layout:"total, prev, pager, next",total:e.total,"page-size":20,"hide-on-single-page":!0,align:"center",background:""},on:{"current-change":e.getExpList,"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t}}})],1)],1)],1),a("el-row",{directives:[{name:"show",rawName:"v-show",value:!e.showAuditBtn,expression:"!showAuditBtn"}],staticClass:"row",staticStyle:{"margin-top":"30px"}},[a("el-col",{attrs:{align:"center"}},[a("el-button",{attrs:{type:"primary",disabled:0==e.strategySetInfo.operation.is_edit},on:{click:e.toEditStrategySet}},[e._v("编辑")]),e.strategySetInfo.operation.is_offline?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.toApplyAction("apply_offline","下线")}}},[e._v("下线")]):e._e()],1)],1),a("el-row",{directives:[{name:"show",rawName:"v-show",value:e.showAuditBtn,expression:"showAuditBtn"}],staticStyle:{"margin-top":"30px"}},[a("el-col",{attrs:{align:"center"}},[e.strategySetInfo.audit_operation.is_refuse?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.toAuditAction("audit_reject","拒绝")}}},[e._v("驳回")]):e._e(),e.strategySetInfo.audit_operation.is_online?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.toAuditAction("audit_pass","上线")}}},[e._v("上线")]):e._e(),e.strategySetInfo.audit_operation.is_offline?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.toAuditAction("audit_pass","下线")}}},[e._v("下线")]):e._e()],1)],1),a("el-drawer",{attrs:{title:"确认"+e.applyActionText+"该策略集？选择审核人",visible:e.drawer,direction:"ttb"},on:{"update:visible":function(t){e.drawer=t}}},[a("span",[a("el-alert",{directives:[{name:"show",rawName:"v-show",value:""!=e.applyActionMsg,expression:"applyActionMsg != ''"}],attrs:{title:"警告提示的文案",type:"warning"}},[e._v(e._s(e.applyActionMsg))]),a("el-form",[a("el-form-item",[a("AddAuditor",{staticStyle:{float:"left"},attrs:{expZoneCode:e.strategySetInfo.strategy_set.exp_zone_code},model:{value:e.assignAuditor,callback:function(t){e.assignAuditor=t},expression:"assignAuditor"}}),a("el-button",{staticStyle:{"margin-left":"50px",float:"left"},attrs:{type:"primary"},on:{click:function(t){return e.doApplyAction()}}},[e._v("确认")])],1)],1)],1)]),a("el-drawer",{attrs:{title:"策略变更记录",visible:e.showRecord,"custom-class":"drawerscroll",size:"80%"},on:{"update:visible":function(t){e.showRecord=t}}},[a("el-row",{staticStyle:{overflow:"scroll"},style:{height:e.drawerHeight}},[a("StrategyUpdateRecord",{attrs:{strategySetId:e.strategySetId}})],1)],1)],1)},ye=[],ge=(a("d81d"),a("498a"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.domainLayer.length>0?a("div",[a("SingleDomainLayerTab",{attrs:{domainLayer:e.domainLayer,expLayerId:e.expLayerId},on:{domainClick:e.domainClick}})],1):a("div",[a("p",{staticStyle:{color:"grey"}},[e._v("该策略上暂无实验")])])])}),be=[],xe=(a("e25e"),a("2ef0")),ve=a.n(xe),we=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e._l(e.domainLayer,(function(t,r){return[a("div",{directives:[{name:"show",rawName:"v-show",value:t.domain.traffic_weight>0,expression:"item.domain.traffic_weight>0"}],key:r,staticClass:"domain-block",class:t.bg_class?t.bg_class:"bg-info",style:{width:t.progress_bar_wd,height:(t.exp_layer.exp_layer_id,e.expLayerId,"60px"),opacity:t.exp_layer.exp_layer_id==e.expLayerId||0==t.domain.domain_type||void 0==e.expLayerId?"1":"0.3"}},[1==t.domain.domain_type?[a("p",{staticClass:"text-center h5",staticStyle:{"padding-top":"15px"},on:{mouseover:function(a){return e.showDomain(t,a)},mouseleave:function(a){return e.hideDomain(t,a)},click:function(a){return e.domainClick(t,a)}}},[e._v(e._s(t.domain.traffic_weight)+"/1000")])]:e._e(),0==t.domain.domain_type?[a("p",{staticClass:"text-center h5",staticStyle:{"padding-top":"15px"},on:{mouseover:function(a){return e.showDomain(t,a)},mouseleave:function(a){return e.hideDomain(t,a)}}},[e._v("剩余("+e._s(t.domain.traffic_weight)+"/1000)")])]:e._e()],2)]}))],2)},ke=[],Se={props:["domainLayer","expLayerId"],methods:{domainClick:function(e,t){$(t.currentTarget).tooltip("hide"),"/lab/create"!=this.$route.path&&e.exp_layer.exp_layer_id!=this.expLayerId&&this.$emit("domainClick",e)},hideDomain:function(e,t){$(t.currentTarget).tooltip("destroy")},showDomain:function(e,t){if(0!=e.domain_type){var a="实验人:"+e.exp_layer.creator+"<br>点击进入查看实验详情";"/monitor/exp_effect"==this.$route.path?a="实验人:"+e.exp_layer.creator+"<br>点击查看该实验检验":"/lab/create"==this.$route.path&&(a="实验人:"+e.exp_layer.creator),$(t.currentTarget).tooltip({placement:"top",html:!0,title:a,container:"body"}).tooltip("toggle")}else $(t.currentTarget).tooltip({placement:"top",html:!0,title:"剩余流量:"+e.domain.traffic_weight,container:"body"}).tooltip("toggle")}}},Ie=Se,Le=Object(h["a"])(Ie,we,ke,!1,null,null,null),$e=Le.exports,De={props:["strategySetId","expLayerId"],data:function(){return{domainLayer:[]}},watch:{strategySetId:function(){this.getDomainLayer()}},mounted:function(){this.getDomainLayer()},components:{SingleDomainLayerTab:$e},methods:{getDomainLayer:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!=parseInt(this.strategySetId)){e.next=2;break}return e.abrupt("return",!1);case 2:return this.domainLayer=[],e.next=5,this.$api.strategy.getStrategyDomainList(this.strategySetId);case 5:t=e.sent,a=0,t.data.forEach((function(e){a+=e.domain.traffic_weight})),r=(1e3-a)/10,t.data.push({domain:{domain_type:0,traffic_weight:1e3-a},exp_layer:{exp_layer_id:0,creator:"system"},bg_class:"bg-info",progress_bar_wd:r+"%",progress:r}),this.domainLayer=t.data;case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),domainClick:function(e){if(e.exp_layer.exp_layer_id==this.expLayerId)return!1;"/monitor/exp_effect"==this.$route.path?this.$emit("domainClick",e):(this.$router.push({path:"/lab/detail",query:{exp_layer_id:e.exp_layer.exp_layer_id}}),this.$emit("domainClick",e))}}},Ce=De,Ee=Object(h["a"])(Ce,ge,be,!1,null,null,null),Te=Ee.exports,Oe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.applyList.length>0?a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.applyList}},[a("el-table-column",{attrs:{prop:"id",label:"ID"}}),a("el-table-column",{attrs:{label:"实验"}},[[void 0==e.expLayerId?a("span",[e._v("实验")]):e._e()]],2),a("el-table-column",{attrs:{prop:"exp_title",label:"子实验"}}),a("el-table-column",{attrs:{prop:"address",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"label",class:t.row.apply_status_cls},[e._v(e._s(t.row.apply_status_text))])]}}],null,!1,2666695519)}),a("el-table-column",{attrs:{prop:"username",label:"申请人"}}),a("el-table-column",{attrs:{prop:"create_time",label:"创建时间"}}),a("el-table-column",{attrs:{prop:"update_time",label:"更新时间"}}),a("el-table-column",{attrs:{prop:"auditor",label:"操作人"}}),a("el-table-column",{attrs:{prop:"audit_reason",label:"备注"}})],1)],1):a("div",[e._v("暂无")])},je=[],Re={props:["strategySetId","expLayerId"],data:function(){return{applyList:[]}},mounted:function(){this.strategySetId?this.getApplyList():this.expLayerId&&this.getApplyListByLayer()},methods:{getApplyList:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.exp.getVolumeFullApplyList(this.strategySetId);case 2:t=e.sent,this.applyList=t.data;case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getApplyListByLayer:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.exp.getVolume20ApplyListByLayer(this.expLayerId);case 2:t=e.sent,this.applyList=t.data;case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},qe=Re,Ae=Object(h["a"])(qe,Oe,je,!1,null,null,null),Me=Ae.exports,Be=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.confirmList.length>0?a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("strong",[e._v("实验全量申请，等待实验创建人确认")])]),e._l(e.confirmList,(function(t,r){return[a("p",{key:r},[e._v(" "+e._s(r+1)+". "),a("label",[e._v(e._s(t.apply.assign_user))]),a("span",[e._v("(实验："),a("router-link",{attrs:{to:{path:"/lab/detail",query:{exp_layer_id:t.layer.exp_layer_id}}}},[e._v(e._s(t.layer.exp_layer_name))]),e._v(")")],1),a("el-tag",[e._v(e._s(t.confirm_text))]),-1==t.apply.as_status?a("el-tag",{staticClass:"label label-danger"},[e._v("理由："+e._s(t.apply.reply_content))]):e._e(),a("span",{directives:[{name:"show",rawName:"v-show",value:t.show_confirm_btn,expression:"item.show_confirm_btn"}],staticStyle:{display:"inline-block",float:"right"}},[a("el-button",{attrs:{size:"mini",type:"info"},on:{click:function(a){return e.reject(t.apply)}}},[e._v("拒绝")]),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.pass(t.apply)}}},[e._v("确认")])],1)],1)]}))],2):e._e()},Pe=[],Qe={props:["strategySetId"],data:function(){return{confirmList:[]}},methods:{reject:function(e){var t=this;this.$prompt("请填写拒绝原因","原因").then((function(a){var r=a.value;if(""==r)return t.$message("请填写拒绝原因"),!1;null!=r&&t.confirmMsg(e.id,"no",r)}))},pass:function(e){var t=this;this.$confirm("确认通过本次放量申请么","确认").then((function(a){a.value;t.confirmMsg(e.id,"yes","")}))},confirmMsg:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,a,r){var s,n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.exp.confirmMsgByGo(t+"",a,r||"");case 2:s=e.sent,this.$message({message:s.errmsg,type:"success",duration:1e3,onClose:function(){n.$tool.reload()}});case 4:case"end":return e.stop()}}),e,this)})));function t(t,a,r){return e.apply(this,arguments)}return t}(),getConfirmList:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.strategy.getFullVolumeConfirms(this.strategySetId);case 2:t=e.sent,0==t.errcode&&null!=t.data&&(this.confirmList=t.data);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},Ue=Qe,Ne=Object(h["a"])(Ue,Be,Pe,!1,null,null,null),ze=Ne.exports,He=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{attrs:{"label-position":"right","label-width":"180px"}},[a("el-form-item",{attrs:{label:"选择审核人："}},[a("el-select",{attrs:{placeholder:"请选择",multiple:"",filterable:"","collapse-tags":""},on:{change:e.setSelectUser},model:{value:e.selectUsers,callback:function(t){e.selectUsers=t},expression:"selectUsers"}},e._l(e.userList,(function(e){return a("el-option",{key:e.user_name,attrs:{label:e.user_name,value:e.user_name}})})),1),a("span",[e._v(e._s(e.selectUsers.join("、")))])],1)],1)],1)},Fe=[],Ve=(a("99af"),{props:["expZoneCode","value"],data:function(){return{userList:[],selectUsers:[]}},mounted:function(){this.getAuditorList(),void 0!=this.value&&(this.selectUsers=this.value)},watch:{expZoneCode:function(){this.getAuditorList()},value:function(e){this.selectUsers=e}},methods:{getAuditorList:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(this.expZoneCode>0)){e.next=9;break}return e.next=3,this.$api.user.queryUserByGo("",4,this.expZoneCode);case 3:return t=e.sent,this.userList=t.data,e.next=7,this.$api.user.queryUserByGo("",10,this.expZoneCode);case 7:a=e.sent,this.userList=this.userList.concat(a.data);case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),setSelectUser:function(){this.$emit("input",this.selectUsers)}}}),Ge=Ve,We=Object(h["a"])(Ge,He,Fe,!1,null,null,null),Ze=We.exports,Ke=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{offset:1,span:22}},[a("Timeline",{attrs:{data:e.data},scopedSlots:e._u([{key:"detail",fn:function(t){return[a("ul",{directives:[{name:"show",rawName:"v-show",value:"create"==t.record.record.action||"edit"==t.record.record.action&&void 0==t.record.edit_log||"volume_all"==t.record.record.action&&void 0==t.record.edit_log,expression:"detailData.record.record.action == 'create' || (detailData.record.record.action == 'edit' && detailData.record.edit_log == undefined) || (detailData.record.record.action == 'volume_all' && detailData.record.edit_log == undefined)"}],staticClass:"detail"},[a("li",[a("span",{staticClass:"key"},[e._v("名 称")]),a("span",{staticClass:"val"},[e._v(e._s(t.record.strategy_set.strategy_set_name))])]),a("li",[a("span",{staticClass:"key"},[e._v("描 述")]),a("span",{staticClass:"val"},[e._v(e._s(t.record.strategy_set.strategy_set_comment))])]),a("li",[a("span",{staticClass:"key"},[e._v("创建人")]),a("span",{staticClass:"val"},[e._v(e._s(t.record.strategy_set.creator))])]),a("li",[a("span",{staticClass:"key"},[e._v("策略配置")]),a("span",{staticClass:"val"})]),a("el-table",{staticStyle:{width:"100%"},attrs:{size:"mini",data:Object.keys(t.record.strategy_list).map((function(e){return t.record.strategy_list[e]}))}},[a("el-table-column",{attrs:{prop:"strategy_name",label:"策略名",width:"180"}}),a("el-table-column",{attrs:{prop:"strategy_defult_value",label:"策略值"}})],1)],1),"edit"!=t.record.record.action&&"volume_all"!=t.record.record.action||void 0==t.record.edit_log?e._e():a("ul",{staticClass:"detail"},[a("el-table",{staticStyle:{width:"100%"},attrs:{size:"mini",data:Object.keys(t.record.edit_log.update).map((function(e){return t.record.edit_log.update[e]}))}},[a("el-table-column",{attrs:{label:"策略名",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.strategy_name)+"(修改)")]}}],null,!0)}),a("el-table-column",{attrs:{label:"编辑前策略值"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("span",{class:{"red-font":t.record.old_strategy_list[e.row.strategy_id].strategy_defult_value!=e.row.strategy_defult_value}},[a("popover",{attrs:{showStr:t.record.old_strategy_list[e.row.strategy_id].strategy_defult_value}})],1)]}}],null,!0)}),a("el-table-column",{attrs:{label:"编辑后策略值"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("span",{class:{"red-font":t.record.old_strategy_list[e.row.strategy_id].strategy_defult_value!=e.row.strategy_defult_value}},[a("popover",{attrs:{showStr:e.row.strategy_defult_value}})],1)]}}],null,!0)})],1),Object.keys(t.record.edit_log.add).length>0?a("el-table",{staticStyle:{width:"100%"},attrs:{size:"mini","show-header":!1,data:Object.keys(t.record.edit_log.add).map((function(e){return t.record.edit_log.add[e]}))}},[a("el-table-column",{attrs:{width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.strategy_name)+" "),a("b",{staticClass:"green-font"},[e._v("(新增)")])]}}],null,!0)}),a("el-table-column"),a("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(e){return[a("span",{staticClass:"red-font"},[a("popover",{attrs:{showStr:e.row.strategy_defult_value,length:20}})],1)]}}],null,!0)})],1):e._e(),Object.keys(t.record.edit_log.delete).length>0?a("el-table",{staticStyle:{width:"100%"},attrs:{size:"mini","show-header":!1,data:Object.keys(t.record.edit_log.delete).map((function(e){return t.record.edit_log.delete[e]}))}},[a("el-table-column",{attrs:{width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("s",[e._v(" "+e._s(t.row.strategy_name)+" "),a("b",{staticClass:"red-font"},[e._v("(删除)")])])]}}],null,!0)}),a("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(e){return[a("s",[a("popover",{attrs:{showStr:e.row.strategy_defult_value,length:20}})],1)]}}],null,!0)}),a("el-table-column")],1):e._e()],1)]}}])})],1)],1)},Ye=[],Je={props:["strategySetId"],data:function(){return{data:[]}},components:{Timeline:P},watch:{strategySetId:function(){this.getStrategyRecord()}},mounted:function(){this.getStrategyRecord()},methods:{getStrategyRecord:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.strategy.getOperateListByGo(this.strategySetId);case 2:if(t=e.sent,null!=t.data){e.next=5;break}return e.abrupt("return");case 5:if(t.data.sort((function(e,t){return e.record.id>t.record.id?-1:1})),0==t.errcode){e.next=8;break}return e.abrupt("return");case 8:this.data=t.data;case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},Xe=Je,et=Object(h["a"])(Xe,Ke,Ye,!1,null,null,null),tt=et.exports,at=a("6c13"),rt={data:function(){return{strategySetInfo:{operation:{is_edit:!1,is_del:!1,is_offline:!1,is_online:!1,is_add_user:!1},audit_operation:{is_refuse:!1,is_del:!1,is_offline:!1,is_online:!1},strategy_set:{strategy_set_comment:"",access_user:"",assign_auditor:""}},showAuditBtn:!1,strategySetId:0,applyActionText:"",applyAction:"",applyActionMsg:"",drawer:!1,assignAuditor:[],showRecord:!1,total:0,page:1,layerList:[],drawerHeight:"600px"}},components:{SingelDomainLayer:Te,VolumeFullApplyList:Me,AddAuditor:Ze,StrategyUpdateRecord:tt,FullVolumeConfirmList:ze,ExpTable:at["a"]},mounted:function(){this.$route.query.strategy_set_id>0?(this.strategySetId=this.$route.query.strategy_set_id,this.getStrategyInfo(),this.getExpList()):this.$router.push({path:"/strategy/index"}),"strategy_audit_detail"==this.$route.name&&(this.showAuditBtn=!0),"open_record"==this.$route.query.action&&this.showUpdateRecord(),this.drawerHeight=document.documentElement.clientHeight-150+"px"},methods:{getStrategyInfo:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.strategy.getStrategyByGo(this.strategySetId);case 2:t=e.sent,this.strategySetInfo=t.data,this.strategySetInfo.strategy_set.access_user=ve.a.trim(this.strategySetInfo.strategy_set.access_user,","),this.strategySetInfo.strategy_list=this.strategySetInfo.strategy_list.map((function(e){return e.verify=JSON.parse(e.verification),e})),setTimeout((function(){a.$refs["FullVolumeConfirmList"].getConfirmList()}),100);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),toEditStrategySet:function(){this.$router.push({path:"/strategy/edit",query:{strategy_set_id:this.$route.query.strategy_set_id}})},toApplyAction:function(e,t){this.drawer=!0,this.applyActionText=t,this.applyAction=e},doApplyAction:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t={},"apply_offline"!=this.applyAction){e.next=5;break}return e.next=4,this.$api.strategy.applyOffline(this.strategySetId,this.assignAuditor.join(","));case 4:t=e.sent;case 5:if(0==t.errcode){e.next=8;break}return this.applyActionMsg=t.errmsg||"操作失败",e.abrupt("return");case 8:this.applyActionMsg="",this.$message({message:"申请".concat(this.applyActionText,"成功，审核通过后生效"),duration:500,onClose:function(){a.$tool.reload()}});case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),toAuditAction:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,a){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(confirm("确认".concat(a,"该策略集？"))){e.next=2;break}return e.abrupt("return");case 2:if(r={},"audit_pass"!=t){e.next=9;break}return e.next=6,this.$api.strategy.auditPass(this.strategySetId);case 6:r=e.sent,e.next=16;break;case 9:if("audit_reject"!=t){e.next=15;break}return e.next=12,this.$api.strategy.auditReject(this.strategySetId);case 12:r=e.sent,e.next=16;break;case 15:return e.abrupt("return");case 16:if(0==r.errcode){e.next=19;break}return this.$message({message:r.errmsg||"操作失败，请刷新页面重试",type:"error"}),e.abrupt("return");case 19:this.$message({message:"".concat(a,"成功"),type:"success"}),this.$router.push({path:"/strategy/audit_list"});case 21:case"end":return e.stop()}}),e,this)})));function t(t,a){return e.apply(this,arguments)}return t}(),toAddUser:function(){var e=this;this.$prompt("请输入用户名","提示",{confirmButtonText:"确定",cancelButtonText:"关闭",inputPattern:/.*/,inputErrorMessage:"用户名不能为空",top:10}).then((function(t){var a=t.value;e.addUser(a)})).catch((function(){}))},addUser:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.strategy.addUser(this.strategySetId,t);case 2:if(a=e.sent,!(a.errcode<0)){e.next=6;break}return this.$message(a.errmsg),e.abrupt("return");case 6:this.$message({message:"添加成功",type:"success",duration:500,onClose:function(){r.$tool.reload()}});case 7:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),showUpdateRecord:function(){this.showRecord=!0},getExpList:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.exp.getLayerListOfStrategy(this.strategySetId,this.page);case 2:t=e.sent,this.$set(this,"layerList",t.data.list),this.total=t.data.total;case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},st=rt,nt=(a("7ed8"),Object(h["a"])(st,me,ye,!1,null,"44b48aef",null)),it=nt.exports,ot=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{offset:2,span:16}},[a("el-form",{attrs:{"label-position":"right","label-width":"180px",model:e.strategySetInfo}},[a("el-form-item",{attrs:{label:"所属产品线(实验区)："}},[a("el-select",{attrs:{placeholder:"请选择策略"},model:{value:e.strategySetInfo.exp_zone_code,callback:function(t){e.$set(e.strategySetInfo,"exp_zone_code",t)},expression:"strategySetInfo.exp_zone_code"}},[e._l(e.useExpZones,(function(e){return[a("el-option",{attrs:{label:e.product_chinese_name+"||"+e.exp_zone_chinese_name,value:e.exp_zone_code}})]}))],2)],1),a("el-form-item",{attrs:{label:"策略："}},[a("el-input",{attrs:{placeholder:"请输入策略名称（全英文小写字母或下划线，共不超过50个字符）"},on:{change:function(t){return e.changeStrategySetName()}},model:{value:e.strategySetInfo.strategy_set_name,callback:function(t){e.$set(e.strategySetInfo,"strategy_set_name",t)},expression:"strategySetInfo.strategy_set_name"}})],1),a("el-form-item",{attrs:{label:"策略类型："}},[a("el-radio",{attrs:{label:0},on:{change:e.changeStrategySetType},model:{value:e.strategySetType,callback:function(t){e.strategySetType=t},expression:"strategySetType"}},[e._v("流量侧")]),a("el-radio",{attrs:{label:1},on:{change:e.changeStrategySetType},model:{value:e.strategySetType,callback:function(t){e.strategySetType=t},expression:"strategySetType"}},[e._v("广告主侧")]),a("el-radio",{attrs:{label:2},on:{change:e.changeStrategySetType},model:{value:e.strategySetType,callback:function(t){e.strategySetType=t},expression:"strategySetType"}},[e._v("流量侧 + 广告主侧")])],1),a("el-form-item",{attrs:{label:"策略功能："}},[a("el-radio",{attrs:{label:"exp"},model:{value:e.strategySetInfo.func,callback:function(t){e.$set(e.strategySetInfo,"func",t)},expression:"strategySetInfo.func"}},[e._v("效果实验")]),a("el-radio",{attrs:{label:"control"},model:{value:e.strategySetInfo.func,callback:function(t){e.$set(e.strategySetInfo,"func",t)},expression:"strategySetInfo.func"}},[e._v("功能控制")])],1),a("el-form-item",{attrs:{label:"策略描述："}},[a("el-input",{attrs:{type:"textarea",rows:"6",placeholder:"请输入策略描述信息"},model:{value:e.strategySetInfo.strategy_set_comment,callback:function(t){e.$set(e.strategySetInfo,"strategy_set_comment",t)},expression:"strategySetInfo.strategy_set_comment"}})],1)],1),a("AddAuditor",{attrs:{expZoneCode:e.strategySetInfo.exp_zone_code},model:{value:e.strategySetInfo.assign_auditor,callback:function(t){e.$set(e.strategySetInfo,"assign_auditor",t)},expression:"strategySetInfo.assign_auditor"}})],1),a("el-col",{staticStyle:{"margin-top":"30px"},attrs:{offset:4,span:16}},[a("SetStrategy",{on:{setStrategyList:e.setStrategyList}})],1),a("el-col",{staticStyle:{"margin-top":"20px"},attrs:{offset:11,span:2}},[a("el-button",{attrs:{type:"primary",disabled:e.isDisableSubmit},on:{click:e.toCreateStrategySet}},[e._v(e._s(e.isDisableSubmit?"正在提交中，请等待...":"提交策略"))])],1)],1)},lt=[],ct=(a("c740"),a("ac1f"),a("466d"),a("5319"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-col",[a("h4",[e._v(" 子策略配置 "),a("el-dropdown",{on:{command:e.handleCommand}},[a("el-button",[e._v(" 添加策略 "),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"string"}},[e._v("String")]),a("el-dropdown-item",{attrs:{command:"int"}},[e._v("Integer")]),a("el-dropdown-item",{attrs:{command:"bool"}},[e._v("Boolean")])],1)],1)],1),a("el-divider")],1),a("el-col",[e._l(e.strategyList,(function(t,r){return[void 0==t.is_del?a("el-card",{staticClass:"box-card",staticStyle:{"margin-top":"20px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("子策略设置【数据类型："+e._s(t.type)+"】")]),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(t){return e.delStrategy(r)}}},[a("i",{staticClass:"el-icon-delete"})])],1),a("el-form",{attrs:{"label-position":"right","label-width":"150px"}},[a("el-form-item",{attrs:{label:"键值/key："}},[a("el-input",{attrs:{placeholder:"请输入子策略key，由英文字符和下划线组成"},model:{value:e.strategyList[r].strategy_name,callback:function(t){e.$set(e.strategyList[r],"strategy_name",t)},expression:"strategyList[index].strategy_name"}})],1),a("el-form-item",{attrs:{label:"策略描述："}},[a("el-input",{attrs:{type:"textarea",rows:"6",placeholder:"请输入策略描述信息"},model:{value:e.strategyList[r].strategy_value_comment,callback:function(t){e.$set(e.strategyList[r],"strategy_value_comment",t)},expression:"strategyList[index].strategy_value_comment"}})],1),"int"==t.type?[a("el-form-item",{attrs:{label:"最小值："}},[a("el-input",{attrs:{placeholder:"子策略最小值",type:"number"},model:{value:e.strategyList[r].min,callback:function(t){e.$set(e.strategyList[r],"min",t)},expression:"strategyList[index].min"}})],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"int"==t.type,expression:"item.type == 'int'"}],attrs:{label:"最大值："}},[a("el-input",{attrs:{placeholder:"子策略最大值",type:"number"},model:{value:e.strategyList[r].max,callback:function(t){e.$set(e.strategyList[r],"max",t)},expression:"strategyList[index].max"}})],1),a("el-form-item",{attrs:{label:"默认值："}},[a("el-input",{attrs:{placeholder:"子策略默认值",type:"number"},model:{value:e.strategyList[r].strategy_defult_value,callback:function(t){e.$set(e.strategyList[r],"strategy_defult_value",t)},expression:"strategyList[index].strategy_defult_value"}})],1)]:e._e(),"string"==t.type?[a("el-form-item",{attrs:{label:"最大长度："}},[a("el-input",{attrs:{placeholder:"字符串最大长度小于等于1024",type:"number"},model:{value:e.strategyList[r].max_length,callback:function(t){e.$set(e.strategyList[r],"max_length",t)},expression:"strategyList[index].max_length"}})],1),a("el-form-item",{attrs:{label:"默认值："}},[a("el-input",{attrs:{placeholder:"子策略默认值",type:"textarea",rows:6},model:{value:e.strategyList[r].strategy_defult_value,callback:function(t){e.$set(e.strategyList[r],"strategy_defult_value",t)},expression:"strategyList[index].strategy_defult_value"}})],1)]:e._e(),"bool"==t.type?[a("el-form-item",{attrs:{label:"默认值："}},[a("el-radio",{attrs:{label:"true"},model:{value:e.strategyList[r].strategy_defult_value,callback:function(t){e.$set(e.strategyList[r],"strategy_defult_value",t)},expression:"strategyList[index].strategy_defult_value"}},[e._v("true")]),a("el-radio",{attrs:{label:"false"},model:{value:e.strategyList[r].strategy_defult_value,callback:function(t){e.$set(e.strategyList[r],"strategy_defult_value",t)},expression:"strategyList[index].strategy_defult_value"}},[e._v("false")])],1)]:e._e()],2)],1):e._e()]}))],2),a("el-dialog",{attrs:{title:"删除提示",visible:e.showDelDialog,width:"30%"},on:{"update:visible":function(t){e.showDelDialog=t}}},[a("span",[e._v("是否确认删除这条策略？？")]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.showDelDialog=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.comfirmDelStrategy()}}},[e._v("确 定")])],1)])],1)}),ut=[],pt={props:["propStrategyList"],data:function(){return{strategyList:[],showDelDialog:!1,delIndex:-1}},watch:{propStrategyList:function(){this.strategyList=this.propStrategyList}},methods:{handleCommand:function(e){switch(e){case"string":this.addString();break;case"int":this.addInt();break;case"bool":this.addBool();break}this.$emit("setStrategyList",this.strategyList)},addString:function(){this.strategyList.push({type:"string",strategy_name:"",strategy_value_comment:"【子策略描述信息】\n\n...\n【子策略规格说明】\n\n...",max_length:"1024",strategy_defult_value:""})},addInt:function(){this.strategyList.push({type:"int",strategy_name:"",strategy_value_comment:"【子策略描述信息】\n\n...\n【子策略规格说明】\n\n...",max:"",min:"",strategy_defult_value:""})},addBool:function(){this.strategyList.push({type:"bool",strategy_name:"",strategy_value_comment:"【子策略描述信息】\n\n...\n【子策略规格说明】\n\n...",strategy_defult_value:"true"})},delStrategy:function(e){this.delIndex=e,this.showDelDialog=!0},comfirmDelStrategy:function(){this.$set(this.strategyList[this.delIndex],"is_del","true"),this.showDelDialog=!1,this.$emit("setStrategyList",this.strategyList)}}},_t=pt,dt=Object(h["a"])(_t,ct,ut,!1,null,null,null),ft=dt.exports,ht={data:function(){return{strategyList:[],expZoneList:[],strategySetInfo:{exp_zone_code:0,strategy_set_comment:"【策略名称】\n(在此输入策略的中文名称)\n\n【策略功效】\n(在此输入此策略的功效)\n\n【策略描述】\n(在此填写策略的描述备注信息)\n\n【策略构成】\n(在此输入各个子策略含义和规格)\n",func:"exp",strategy_set_name:"xxxxx_xxxx_strategy",assign_auditor:[]},strategySetType:0,strategy_set_comment_default_length:91,strategySetName:"xxxxx_xxxx_strategy",strategyRegexpMsg:!1,isDisableSubmit:!1}},components:{AddAuditor:Ze,SetStrategy:ft},mounted:function(){this.getMyAccessList(),this.$store.commit("initAssignUser",[])},computed:{useExpZones:function(){var e=this;return this.expZoneList.filter((function(t){return 0==e.strategySetType||783==t.product_code}))}},methods:{changeStrategySetType:function(){0!=this.strategySetType&&78301!=this.strategySetInfo.exp_zone_code&&(this.strategySetInfo.exp_zone_code=78301),0!=this.strategySetType&&this.$message("广告主侧策略目前只支持超级粉丝通实验区")},changeStrategySetName:function(){var e=this.strategySetInfo.strategy_set_name.match(/^[a-z_]{1,50}$/);return null!==e||(this.$message("请输入全英文小写字母或下划线，共不超过50个字符"),!1)},setStrategyList:function(e){this.strategyList=e},getMyAccessList:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.user.getUserExpZoneList(2);case 2:if(t=e.sent,0==t.errcode){e.next=7;break}return this.$message(t.errmsg),this.$router.push({path:"/strategy/index"}),e.abrupt("return");case 7:this.expZoneList=t.data,a=ve.a.findIndex(this.expZoneList,["exp_zone_code",78301]),a=a>-1?a:0,this.strategySetInfo.exp_zone_code=this.expZoneList[a].exp_zone_code;case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getPostData:function(){var e={strategy_set_name:this.strategySetInfo.strategy_set_name,strategy_set_comment:this.strategySetInfo.strategy_set_comment,exp_zone_code:this.strategySetInfo.exp_zone_code,strategy_set_type:this.strategySetType,func:this.strategySetInfo.func,assign_auditor:this.strategySetInfo.assign_auditor};return e.strategy_list=this.strategyList.filter((function(e){return void 0==e.is_del})),e},getStrategyCount:function(){return this.strategyList.filter((function(e){return void 0==e.is_del})).length},pureCommit:function(e){var t=["【策略名称】","【策略功效】","【策略描述】","【策略构成】","(在此输入策略的中文名称)","(在此输入此策略的功效)","(在此填写策略的描述备注信息)","(在此输入各个子策略含义和规格)"];for(var a in t)e=e.replace(t[a],"");return e.replace(/[\r\n]/g,"")},getDelTpl:function(e){var t=["【策略名称】","【策略功效】","【策略描述】","【策略构成】"],a=[];for(var r in t)e.indexOf(t[r])<0&&a.push(t[r]);return a},toCreateStrategySet:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a,r,s,n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!1!==this.changeStrategySetName()){e.next=2;break}return e.abrupt("return");case 2:if(!(this.strategySetInfo.assign_auditor.length<1)){e.next=5;break}return this.$message("请指定审核人"),e.abrupt("return");case 5:if(t=this.getPostData(),a=this.getDelTpl(t.strategy_set_comment),!(a.length>0)){e.next=10;break}return this.$message("请不要删除“策略描述”的模版："+a.join("、")),e.abrupt("return");case 10:if(r=this.pureCommit(t.strategy_set_comment),!(r.length<10)){e.next=14;break}return this.$message("“策略描述”信息除模板外，不得少于10个字符"),e.abrupt("return");case 14:if(!(this.getStrategyCount()<1)){e.next=17;break}return this.$message("请输入至少一个策略"),e.abrupt("return");case 17:if(!this.isDisableSubmit){e.next=19;break}return e.abrupt("return",!1);case 19:return this.isDisableSubmit=!0,e.next=22,this.$api.strategy.create(t);case 22:if(s=e.sent,0==s.errcode){e.next=27;break}return this.isDisableSubmit=!1,this.$message(s.errmsg||"创建策略集失败"),e.abrupt("return");case 27:this.$message({message:"创建策略集成功,该策略集需要管理员审核上线方能生效",duration:1e3,type:"success",onClose:function(){n.$router.push({path:"/strategy/detail",query:{strategy_set_id:s.data.strategy_set_id}})}});case 28:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},mt=ht,yt=Object(h["a"])(mt,ot,lt,!1,null,null,null),gt=yt.exports,bt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{offset:2,span:16}},[a("el-form",{attrs:{"label-position":"right","label-width":"180px",model:e.strategySetInfo}},[a("el-form-item",{attrs:{label:"所属产品线(实验区)："}},[a("p",[e._v(e._s(e.strategySetInfo.product_chinese_name)+" | "+e._s(e.strategySetInfo.exp_zone_chinese_name))])]),a("el-form-item",{attrs:{label:"策略："}},[a("p",[e._v(e._s(e.strategySetInfo.strategy_set_name))])]),a("el-form-item",{attrs:{label:"策略类型："}},[a("p",[e._v(e._s(e.strategySetInfo.strategy_set_type_name))])]),a("el-form-item",{attrs:{label:"策略功能："}},[a("p",[e._v(e._s("exp"==e.strategySetInfo.func?"效果实验":"功能控制"))])]),a("el-form-item",{attrs:{label:"策略描述："}},[a("el-input",{attrs:{type:"textarea",rows:"6",placeholder:"请输入策略描述信息"},model:{value:e.strategySetInfo.strategy_set_comment,callback:function(t){e.$set(e.strategySetInfo,"strategy_set_comment",t)},expression:"strategySetInfo.strategy_set_comment"}})],1)],1),a("AddAuditor",{attrs:{expZoneCode:e.strategySetInfo.exp_zone_code},model:{value:e.strategySetInfo.assign_auditor,callback:function(t){e.$set(e.strategySetInfo,"assign_auditor",t)},expression:"strategySetInfo.assign_auditor"}})],1),a("el-col",{staticStyle:{"margin-top":"30px"},attrs:{offset:4,span:16}},[a("SetStrategy",{attrs:{propStrategyList:e.strategyList}})],1),a("el-col",{staticStyle:{"margin-top":"30px"},attrs:{offset:11,span:2}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showCompareDialog=!0}}},[e._v("对比策略修改")])],1),a("el-dialog",{attrs:{title:"对比",visible:e.showCompareDialog,width:"70%",top:"4vh"},on:{"update:visible":function(t){e.showCompareDialog=t}}},[a("StrategyCompare",{attrs:{oldStrategySetInfo:e.oldStrategySetInfo,strategySetInfo:e.strategySetInfo,oldStrategyList:e.oldStrategyList,strategyList:e.strategyList}}),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",disabled:e.isDisableSubmit},on:{click:e.toEditStrategySet}},[e._v("确认修改")])],1)],1)],1)},xt=[],vt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:12}},[a("h4",[e._v("修改前")]),e._l(e.oldStrategyList,(function(t,r){return[a("el-card",{staticClass:"box-card",staticStyle:{"margin-top":"10px",height:"300px",overflow:"scroll"}},[a("div",[a("p",[e._v("键值/key："+e._s(t.strategy_name))]),a("p",[e._v("类型："+e._s(t.type))]),"string"==t.type?a("p",[e._v("最大长度："+e._s(t.max_length))]):"int"==t.type?a("div",[a("p",[e._v("最小值："+e._s(t.min))]),a("p",[e._v("最大值："+e._s(t.max))])]):e._e(),a("p",{staticClass:"break-words-defaultValue"},[e._v("默认值："+e._s(t.strategy_defult_value))]),a("p",[e._v("描述："+e._s(t.strategy_value_comment))])])])]}))],2),a("el-col",{attrs:{span:12}},[a("h4",[e._v("修改后")]),e._l(e.oldStrategyList,(function(t,r){return[a("el-card",{staticClass:"box-card new",staticStyle:{"margin-top":"10px",height:"300px",overflow:"scroll"}},[void 0==e.updateData[r].is_del?a("div",[a("p",[e._v(" 键值/key： "),a("span",{class:{update:t.strategy_name!=e.updateData[r]["strategy_name"]}},[e._v(e._s(e.updateData[r]["strategy_name"]))])]),a("p",[e._v("类型："+e._s(e.updateData[r]["type"]))]),"string"===t.type?a("p",[e._v(" 最大长度： "),a("span",{class:{update:t.max_length!=e.updateData[r].max_length}},[e._v(e._s(e.updateData[r]["max_length"]))])]):"int"===t.type?a("div",[a("p",[e._v(" 最小值： "),a("span",{class:{update:t.min!=e.updateData[r].min}},[e._v(e._s(e.updateData[r]["min"]))])]),a("p",[e._v(" 最大值： "),a("span",{class:{update:t.max!=e.updateData[r].max}},[e._v(e._s(e.updateData[r]["max"]))])])]):e._e(),a("p",[e._v(" 默认值： "),a("span",{class:{"break-words-defaultValue":!0,update:t.strategy_defult_value!=e.updateData[r]["strategy_defult_value"]}},[e._v(e._s(e.updateData[r]["strategy_defult_value"]))])]),a("p",[e._v(" 描述： "),a("span",{class:{update:t.strategy_value_comment!=e.updateData[r].strategy_value_comment}},[e._v(e._s(e.updateData[r]["strategy_value_comment"]))])])]):e._e(),e.updateData[r].is_del?a("div",[a("p",[a("span",{staticClass:"update"},[e._v("此策略已删除")])])]):e._e()])]})),e._l(e.addData,(function(t,r){return[a("el-card",{staticClass:"box-card new",staticStyle:{"margin-top":"10px",height:"300px",overflow:"scroll"}},[a("div",{staticClass:"update"},[a("p",{staticStyle:{"font-size":"18px"}},[e._v("新增策略")]),a("p",[e._v("键值/key："+e._s(t.strategy_name))]),a("p",[e._v("类型："+e._s(t.type))]),"string"==t.type?a("p",[e._v("最大长度："+e._s(t.max_length))]):"int"==t.type?a("div",[a("p",[e._v("最小值："+e._s(t.min))]),a("p",[e._v("最大值："+e._s(t.max))])]):e._e(),a("p",{staticClass:"break-words-defaultValue"},[e._v("默认值："+e._s(t.strategy_defult_value))]),a("p",[e._v("描述："+e._s(t.strategy_value_comment))])])])]}))],2)],1)},wt=[],kt={props:["strategyList","oldStrategyList"],computed:{updateData:function(){var e={};return this.strategyList.forEach((function(t){void 0!=t.strategy_id&&t.strategy_id>0&&(e[t.strategy_id]=t)})),e},addData:function(){var e={};return this.strategyList.forEach((function(t){void 0!=t.strategy_id&&0!=t.strategy_id||(e[t.strategy_id]=t)})),e}}},St=kt,It=(a("bee8"),Object(h["a"])(St,vt,wt,!1,null,"b1884aa0",null)),Lt=It.exports,$t={data:function(){return{strategyList:[],strategySetInfo:{strategy_set_type:0,assign_auditor:[]},oldStrategySetInfo:{},oldStrategyList:[],isDisableSubmit:!1,showCompareDialog:!1}},mounted:function(){this.$route.query.strategy_set_id>0?this.getStrategyInfo(this.$route.query.strategy_set_id):this.$router.push({path:"/strategy/index"})},components:{AddAuditor:Ze,StrategyCompare:Lt,SetStrategy:ft},methods:{getStrategyInfo:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a,r,s,n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.strategy.getStrategyByGo(t);case 2:if(a=e.sent,0==a.errcode){e.next=7;break}return this.$message(a.errmsg),this.$router.push({path:"/strategy/detail",query:{strategy_set_id:t}}),e.abrupt("return");case 7:if(0==a.data.is_used_exp){e.next=11;break}return this.$message("该策略集上有运行的在线实验，暂时不能编辑"),this.$router.push({path:"/strategy/detail",query:{strategy_set_id:t}}),e.abrupt("return");case 11:a.data.strategy_set.product_chinese_name=a.data.product_chinese_name,a.data.strategy_set.exp_zone_chinese_name=a.data.exp_zone_chinese_name,a.data.strategy_set.strategy_set_type_name=a.data.strategy_set_type_name,a.data.strategy_set.last_update_by=a.data.last_update_by,a.data.strategy_set.is_used_exp=a.data.is_used_exp,this.strategySetInfo=a.data.strategy_set,this.strategySetInfo.assign_auditor=[],r=[],a.data.strategy_list.forEach((function(e){r.push(n.$lodash.merge(e,JSON.parse(e.verification)))})),this.strategyList=r,s=ve.a.cloneDeep(this.strategyList),this.oldStrategyList=ve.a.keyBy(s,"strategy_id");case 23:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),collectStrategyInfo:function(){var e={strategy_set_comment:this.strategySetInfo.strategy_set_comment,assign_auditor:this.strategySetInfo.assign_auditor};return this.strategyList=ve.a.remove(this.strategyList,(function(e){return void 0==e.is_del||e.strategy_id>0})),e.strategy_list=this.strategyList.map((function(e){return void 0!=e.strategy_id&&(e.strategy_id=e.strategy_id+""),void 0!=e.product_code&&(e.product_code=e.product_code+""),void 0!=e.strategy_set_id&&(e.strategy_set_id=e.strategy_set_id+""),void 0!=e.exp_zone_code&&(e.exp_zone_code=e.exp_zone_code+""),void 0!=e.max_length&&(e.max_length=e.max_length+""),void 0!=e.max&&(e.max=e.max+""),void 0!=e.min&&(e.min=e.min+""),e})),e},getStrategyCount:function(){var e=this.strategyList.length;return this.strategyList.forEach((function(t,a){void 0!=t.is_del&&1==t.is_del&&e--}),e),e},toEditStrategySet:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(this.getStrategyCount()<1)){e.next=3;break}return this.$message("请至少填写一个策略"),e.abrupt("return");case 3:if(t=this.collectStrategyInfo(),t.strategy_set_id=parseInt(this.$route.query.strategy_set_id),!this.isDisableSubmit){e.next=7;break}return e.abrupt("return",!1);case 7:if(!(t.assign_auditor.length<1)){e.next=10;break}return this.$message("请指定审核人"),e.abrupt("return");case 10:return this.isDisableSubmit=!0,e.next=13,this.$api.strategy.updateByGo(t);case 13:a=e.sent,0==a.errcode?(this.$message("修改成功"),this.$router.push({path:"/strategy/detail",query:{strategy_set_id:this.$route.query.strategy_set_id}})):(this.isDisableSubmit=!1,this.$message(a.errmsg));case 15:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},Dt=$t,Ct=Object(h["a"])(Dt,bt,xt,!1,null,null,null),Et=Ct.exports,Tt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("StrategyListTable",{attrs:{strategySetList:e.datas,strategySetTabId:e.strategySetTabId,from:"audit"}})],1)},Ot=[],jt={data:function(){return{datas:[],strategySetTabId:"auditList"}},mounted:function(){this.getAuditList()},components:{StrategyListTable:ee["a"]},methods:{getAuditList:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.strategy.getAuditListByGo();case 2:if(t=e.sent,0==t.errcode){e.next=6;break}return this.$set(this,"datas",[]),e.abrupt("return");case 6:this.$set(this,"datas",t.data);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},Rt=jt,qt=Object(h["a"])(Rt,Tt,Ot,!1,null,null,null),At=qt.exports,Mt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"原始指标",name:"origin"}},[a("div",[a("QuotaListTable",{attrs:{theModalId:"oo",EditId:"oo1",thehubbleId:"oo2",linkId:"oo3",listData:e.listData,hubbleQuotas:e.hubbleQuotas},on:{updateData:e.init}})],1)]),a("el-tab-pane",{attrs:{label:"系统定义指标",name:"system_define"}},[a("div",[a("QuotaListTable",{attrs:{theModalId:"yy",EditId:"yy1",thehubbleId:"yy2",linkId:"yy3",listData:e.listData,hubbleQuotas:e.hubbleQuotas},on:{updateData:e.init}})],1)]),a("el-tab-pane",{attrs:{label:"Hubble指标",name:"hubble"}},[a("div",[a("HubbleQuotaTable",{attrs:{listData:e.hubbleQuotas}})],1)]),a("el-tab-pane",{attrs:{label:"指标字典",name:"quotaBook"}},[a("div",[a("ExpEffectBook")],1)]),a("el-tab-pane",{attrs:{label:"*新增指标*",name:"add_quota"}},[a("AddQuotaCtr",{attrs:{quotaRange:"none"}})],1)],1)],1)},Bt=[],Pt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.newListData,height:"500"}},[a("el-table-column",{attrs:{label:"ID(法拉第)",prop:"quota.quota_id",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{attrs:{href:"javascript:;"},on:{click:function(a){return e.showQuotaDetail(t.row)}}},[e._v(e._s(t.row.quota.quota_id))])]}}])}),a("el-table-column",{attrs:{label:"中文名",prop:"quota.quota_text"}}),a("el-table-column",{attrs:{label:"英文名",prop:"quota.quota_en_text"}}),a("el-table-column",{attrs:{label:"产品线",width:"300"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.support_product_list.join("、")))])]}}])}),a("el-table-column",{attrs:{prop:"quota.third_party_id",label:"HubbleID"}}),a("el-table-column",{attrs:{prop:"quota.quota_weight",label:"权重"}}),a("el-table-column",{attrs:{prop:"address",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("a",{attrs:{href:"javascript:;"},on:{click:function(a){return e.editQuota(t.row)}}},[e._v("修改")]),a("a",{attrs:{href:"javascript:;"},on:{click:function(a){return e.delQuota(t.row)}}},[e._v("删除")]),a("a",{attrs:{href:"javascript:;"},on:{click:function(a){return e.linkHubbleQuota(t.row)}}},[e._v("关联")])]}}])})],1),a("el-drawer",{attrs:{title:"指标详情",visible:e.quotaDetail,direction:"rtl"},on:{"update:visible":function(t){e.quotaDetail=t}}},[a("span",[Object.keys(e.clickQuota).length>0?a("ul",[a("li",{staticClass:"drawer-item"},[a("b",[e._v("指标ID：")]),e._v(" "+e._s(e.clickQuota.quota.quota_id)+" ")]),a("el-divider"),a("li",{staticClass:"drawer-item"},[a("b",[e._v("中文名:")]),e._v(" "+e._s(e.clickQuota.quota.quota_text)+" ")]),a("el-divider"),a("li",{staticClass:"drawer-item"},[a("b",[e._v("英文名：")]),e._v(" "+e._s(e.clickQuota.quota.quota_en_text)+" ")]),a("el-divider"),a("li",{staticClass:"drawer-item"},[a("b",[e._v("key：")]),e._v(" "+e._s(e.clickQuota.quota.quota_name)+" ")]),a("el-divider"),a("li",{staticClass:"drawer-item"},[a("b",[e._v("类型：")]),e._v(" "+e._s(e.clickQuota.quota_type_text)+" ")]),a("el-divider"),a("li",{staticClass:"drawer-item"},[a("b",[e._v("描述：")]),e._v(" "+e._s(e.clickQuota.quota.quota_comment)+" ")]),a("el-divider"),a("li",{staticClass:"drawer-item"},[a("b",[e._v("适用实验范围：")]),e._v(" "+e._s(e.clickQuota.quota_range_text)+" ")]),a("el-divider"),a("li",{staticClass:"drawer-item"},[a("b",[e._v("计算公式：")]),e._v(" "+e._s(e.clickQuota.expression_text)+" ")]),a("el-divider"),a("li",{staticClass:"drawer-item"},[a("b",[e._v("创建时间：")]),e._v(" "+e._s(e.clickQuota.quota.create_time)+" ")]),a("el-divider")],1):e._e()])]),a("el-drawer",{attrs:{title:"修改指标",visible:e.editDrawer,direction:"rtl",size:"40%"},on:{"update:visible":function(t){e.editDrawer=t}}},[a("div",{staticStyle:{padding:"20px"}},[Object.keys(e.clickQuota).length>0?[a("el-form",{ref:"form"},[a("el-form-item",{attrs:{label:"中文名:"}},[a("el-input",{model:{value:e.clickQuota.quota.quota_text,callback:function(t){e.$set(e.clickQuota.quota,"quota_text",t)},expression:"clickQuota.quota.quota_text"}})],1),a("el-form-item",{attrs:{label:"英文名:"}},[a("el-input",{model:{value:e.clickQuota.quota.quota_en_text,callback:function(t){e.$set(e.clickQuota.quota,"quota_en_text",t)},expression:"clickQuota.quota.quota_en_text"}})],1),a("el-form-item",{attrs:{label:"描述:"}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.clickQuota.quota.quota_comment,callback:function(t){e.$set(e.clickQuota.quota,"quota_comment",t)},expression:"clickQuota.quota.quota_comment"}})],1),a("el-form-item",{attrs:{label:"指标排序权重(0-100):"}},[a("el-input",{model:{value:e.clickQuota.quota.quota_weight,callback:function(t){e.$set(e.clickQuota.quota,"quota_weight",t)},expression:"clickQuota.quota.quota_weight"}})],1),a("el-form-item",{attrs:{label:"所属产品线"}},[a("el-select",{staticStyle:{width:"400px"},attrs:{multiple:"",placeholder:"请选择"},model:{value:e.product,callback:function(t){e.product=t},expression:"product"}},[a("el-option",{attrs:{label:"超级粉丝通",value:"783",name:"type"}}),a("el-option",{attrs:{label:"全局",value:"1000",name:"type"}}),a("el-option",{attrs:{label:"粉丝头条投非粉",value:"11",name:"type"}}),a("el-option",{attrs:{label:"粉丝头条",value:"102",name:"type"}})],1)],1)],1),a("el-button",{staticStyle:{width:"140px"},attrs:{type:"danger"},on:{click:e.updateQuota}},[e._v("更新")])]:e._e()],2)]),a("el-drawer",{attrs:{title:"关联hubble指标",visible:e.linkDrawer,direction:"rtl",size:"50%"},on:{"update:visible":function(t){e.linkDrawer=t}}},[a("el-form",{staticStyle:{padding:"0 20px"}},[a("el-form-item",{attrs:{label:"请输入关键字搜索Hubble指标:"}},[a("el-input",{attrs:{placeholder:"可搜索id、中文名、theme、描述"},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}})],1)],1),a("el-row",{staticStyle:{height:"400px",padding:"0 20px",overflow:"scroll"}},[Object.keys(e.clickQuota).length>0?[a("el-form",[a("el-form-item",{staticStyle:{height:"500px",overflow:"scroll",display:"flex","flex-direction":"column"}},[a("el-radio-group",{model:{value:e.hubbleId,callback:function(t){e.hubbleId=t},expression:"hubbleId"}},[a("el-radio",{attrs:{label:"0"}},[e._v("无")]),e._l(e.showHubbleQuotas,(function(t){return[a("el-radio",{attrs:{label:t.id}},[e._v(" "+e._s(t.indicator_name)+" "),e.hubbleId==t.id?a("span",[e._v("【"+e._s(t.indicator_meaning)+"】")]):e._e()])]}))],2)],1)],1)]:e._e()],2),a("el-row",{staticStyle:{padding:"0 20px"}},[a("el-button",{attrs:{type:"danger"},on:{click:e.confirmLinkHubbleQuota}},[e._v("确定关联")])],1)],1)],1)},Qt=[],Ut=a("6c9e"),Nt=Ut["a"],zt=(a("423a"),Object(h["a"])(Nt,Pt,Qt,!1,null,"0d28664a",null)),Ht=zt.exports,Ft=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.listData,height:"500",fit:""}},[a("el-table-column",{attrs:{fixed:"",prop:"id",label:"ID(Hubble)",width:"140"}}),a("el-table-column",{attrs:{prop:"indicator_name",label:"中文名"}}),a("el-table-column",{attrs:{label:"描述",width:"500"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("popover",{attrs:{showStr:e.row.indicator_meaning||"无",length:35}})]}}])}),a("el-table-column",{attrs:{prop:"product",label:"产品线"}})],1)],1)},Vt=[],Gt={props:["listData"]},Wt=Gt,Zt=Object(h["a"])(Wt,Ft,Vt,!1,null,null,null),Kt=Zt.exports,Yt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",{staticStyle:{overflow:"visible",padding:"40px 0"}},[a("el-col",{attrs:{span:18,offset:3}},[a("el-form",{ref:"form",attrs:{"label-width":"120px"}},[a("el-form-item",{attrs:{label:"中文名"}},[a("el-input",{attrs:{name:"exp_name",placeholder:"如：评论率"},model:{value:e.Quota.quota_text,callback:function(t){e.$set(e.Quota,"quota_text",t)},expression:"Quota.quota_text"}})],1),a("el-form-item",{attrs:{label:"英文名"}},[a("el-input",{attrs:{name:"exp_name",placeholder:"如：PV"},model:{value:e.Quota.quota_en_text,callback:function(t){e.$set(e.Quota,"quota_en_text",t)},expression:"Quota.quota_en_text"}})],1),a("el-form-item",{attrs:{label:"key:"}},[a("el-input",{attrs:{name:"exp_name",placeholder:"如：comment_rate"},model:{value:e.Quota.quota_name,callback:function(t){e.$set(e.Quota,"quota_name",t)},expression:"Quota.quota_name"}})],1),a("el-form-item",{attrs:{label:"描述"}},[a("el-input",{attrs:{type:"textarea",name:"exp_desc",rows:"5"},model:{value:e.Quota.quota_comment,callback:function(t){e.$set(e.Quota,"quota_comment",t)},expression:"Quota.quota_comment"}})],1),a("el-form-item",{attrs:{label:"适用实验范围"}},[a("el-radio-group",{model:{value:e.Quota.quota_range,callback:function(t){e.$set(e.Quota,"quota_range",t)},expression:"Quota.quota_range"}},[a("el-radio",{attrs:{value:"0",label:"0"}},[e._v("全局")]),a("el-radio",{directives:[{name:"show",rawName:"v-show",value:"none"==e.defaultQuotaRange||"traffic"==e.defaultQuotaRange,expression:"defaultQuotaRange == 'none' || defaultQuotaRange == 'traffic'"}],attrs:{value:"1",label:"1"}},[e._v("流量测")]),a("el-radio",{directives:[{name:"show",rawName:"v-show",value:"none"==e.defaultQuotaRange||"customer"==e.defaultQuotaRange,expression:"defaultQuotaRange == 'none' || defaultQuotaRange == 'customer'"}],attrs:{value:"2",label:"2"}},[e._v("广告主测")])],1)],1),a("el-form-item",{attrs:{label:"产品线"}},[a("el-select",{staticStyle:{width:"400px"},attrs:{multiple:"",placeholder:"请选择"},model:{value:e.Quota.product,callback:function(t){e.$set(e.Quota,"product",t)},expression:"Quota.product"}},[a("el-option",{attrs:{label:"超级粉丝通",value:"783",name:"type"}}),a("el-option",{attrs:{label:"全局",value:"1000",name:"type"}}),a("el-option",{attrs:{label:"粉丝头条投非粉",value:"11",name:"type"}}),a("el-option",{attrs:{label:"粉丝头条",value:"102",name:"type"}})],1)],1),a("el-form-item",{attrs:{label:"格式化类型"}},[a("el-checkbox-group",{model:{value:e.Quota.formate["percent"],callback:function(t){e.$set(e.Quota.formate,"percent",t)},expression:"Quota.formate['percent']"}},[a("el-checkbox",{attrs:{label:"百分比",value:"percent"}})],1)],1),a("el-form-item",{attrs:{label:"精确到小数点"}},[a("el-select",{attrs:{name:"fmt_precision"},model:{value:e.Quota.fmt_precision,callback:function(t){e.$set(e.Quota,"fmt_precision",t)},expression:"Quota.fmt_precision"}},[a("el-option",{attrs:{label:"保留整数",value:0}}),e._l(6,(function(e){return a("el-option",{key:e,attrs:{label:"保留"+e+"位",value:e}})}))],2)],1),a("el-form-item",{attrs:{label:"计算公式"}},[a("el-row",{attrs:{gutter:10}},[a("el-col",{attrs:{span:20}},[a("el-input",{attrs:{disabled:"",value:e.Quota.expression.join(" ")}})],1),a("el-col",{attrs:{span:3}},[a("el-button",{on:{click:e.delLast}},[e._v("回删")])],1)],1)],1),a("el-card",{staticClass:"box-card exp-effect",staticStyle:{width:"100%"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("原始指标")]),e.showIf?a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(t){e.showIf=!e.showIf}}},[e._v("收起")]):a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(t){e.showIf=!e.showIf}}},[e._v("展开")])],1),a("el-collapse-transition",[a("div",{directives:[{name:"show",rawName:"v-show",value:e.showIf,expression:"showIf"}]},[e._l(e.originQuotaList,(function(t,r){return[a("el-button",{key:r,staticStyle:{margin:"5px"},on:{click:function(a){return e.inputExpression(t.quota.quota_name)}}},[e._v(e._s(t.quota.quota_name)+"("+e._s(t.quota.quota_text)+")")])]}))],2)])],1),a("el-card",{staticClass:"box-card"},[[a("el-form-item",{attrs:{label:"运算符","label-width":"60px"}},[a("el-button",{on:{click:function(t){return e.inputExpression("(")}}},[e._v("(")]),a("el-button",{on:{click:function(t){e.inputExpression(")")}}},[e._v(")")]),a("el-button",{on:{click:function(t){return e.inputExpression("+")}}},[e._v("+")]),a("el-button",{on:{click:function(t){return e.inputExpression("-")}}},[e._v("-")]),a("el-button",{on:{click:function(t){return e.inputExpression("*")}}},[e._v("*")]),a("el-button",{on:{click:function(t){return e.inputExpression("/")}}},[e._v("/")])],1),a("el-form-item",{attrs:{label:"常量","label-width":"60px"}},[a("el-row",[a("el-col",{attrs:{span:18}},[a("el-input",{model:{value:e.constVal,callback:function(t){e.constVal=t},expression:"constVal"}})],1),a("el-col",{staticStyle:{"margin-left":"10px"},attrs:{span:4}},[a("el-button",{on:{click:e.addConstVal}},[e._v("输入")])],1)],1)],1)]],2),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:10==e.userType,expression:"userType == 10"}],attrs:{label:"指标类型"}},[a("el-radio-group",{model:{value:e.Quota.quota_type,callback:function(t){e.$set(e.Quota,"quota_type",t)},expression:"Quota.quota_type"}},[a("el-radio",{attrs:{label:"0"}},[e._v("一级指标")]),a("el-radio",{attrs:{label:"1"}},[e._v("二级指标")])],1)],1),a("div",{staticStyle:{display:"flex","justify-content":"center"}},[a("el-button",{staticStyle:{width:"200px"},attrs:{type:"primary"},on:{click:e.toCreateQuota}},[e._v("添加")])],1)],1)],1)],1)},Jt=[],Xt=a("e184"),ea=Xt["a"],ta=(a("f6aa"),Object(h["a"])(ea,Yt,Jt,!1,null,"6f37da36",null)),aa=ta.exports,ra=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-card",{staticClass:"box-card exp-effect"},[r("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[r("span",[e._v("自定义指标计算公式")]),e.show1?r("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(t){e.show1=!e.show1}}},[e._v("收起")]):r("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(t){e.show1=!e.show1}}},[e._v("展开")])],1),r("el-collapse-transition",{staticStyle:{padding:"0 20px"}},[r("div",{directives:[{name:"show",rawName:"v-show",value:e.show1,expression:"show1"}]},[e._l(e.list,(function(t,a){return[r("p",{staticClass:"item",class:{odd:a%2==1}},[r("strong",[e._v(e._s(a+1)+".")]),e._v(" "+e._s(t.name)+" = "+e._s(t.expression)+" ")])]}))],2)])],1),r("el-card",{staticClass:"box-card  exp-effect"},[r("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[r("span",[e._v("原始指标定义")]),e.show2?r("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(t){e.show2=!e.show2}}},[e._v("收起")]):r("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(t){e.show2=!e.show2}}},[e._v("展开")])],1),r("el-collapse-transition",[r("div",{directives:[{name:"show",rawName:"v-show",value:e.show2,expression:"show2"}]},[e._l(e.originQuota,(function(t,a){return[r("p",{staticClass:"item",class:{odd:a%2==1}},[r("strong",[e._v(e._s(a+1)+". "+e._s(t.quota_text)+" :")]),e._v(" "+e._s(t.quota_comment)+" ")])]}))],2)])],1),r("el-card",{staticClass:"box-card  exp-effect"},[r("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[r("span",[e._v("显著性计算说明")]),e.show3?r("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(t){e.show3=!e.show3}}},[e._v("收起")]):r("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text"},on:{click:function(t){e.show3=!e.show3}}},[e._v("展开")])],1),r("el-collapse-transition",[r("div",{directives:[{name:"show",rawName:"v-show",value:e.show3,expression:"show3"}]},[r("h4",{attrs:{id:"统计显著性-significance"}},[e._v("统计显著性 (Significance)")]),r("p",[e._v("在假设检验中，如果样本数据拒绝原假设，我们说检验的结果是显著的；反之，我们则说结果是不显著的。一项检验在统计上是“显著的”，意思是指这样的样本数据不是偶然得到的，即不是抽样的随机波动造成的，而是由内在的影响因素导致。")]),r("h4",{attrs:{id:"t-检验"}},[e._v("t 检验")]),r("p",[e._v("使用 t 检验方法中的独立双样本检验，对基准实验和子实验这两个总体是否存在差异进行检验，为了简化，对比试验忽略了样本大小在 30 以下的小样本情况（视为结果不显著），按大样本检验公式进行 p-value 的计算。")]),r("p",[e._v("首先通过检验公式计算出检验统计量 Z 的值：")]),r("p",[r("img",{attrs:{src:a("08ee"),alt:"t 检验"}})]),r("ul",[r("li",[r("strong",[e._v("x1")]),e._v("：子实验 均值；x2：基准实验 均值； ")]),r("li",[r("strong",[e._v("S1")]),e._v("：子实验 标准差；S2：基准实验 标准差； ")]),r("li",[r("strong",[e._v("n1")]),e._v("：子实验 样本量；n2：基准实验 样本量； ")])]),r("p",[e._v("然后通过 t 分布（大样本情况下近似正态分布）的公式计算得出和 Z 值对应的 p 值。我们采用的显著性水平为0.05，对应Z值 1.96，即当计算结果的Z值大于1.96时，实验的统计结果是显著的，否则不显著")]),r("h4",{attrs:{id:"置信区间"}},[e._v("置信区间")]),r("p",[r("strong",[e._v("置信区间（Confidence interval）")]),e._v("就是用来对一个概率样本的总体参数的进行区间估计的样本均值范围。置信区间展现了这个均值范围包含总体参数的概率，这个概率称为置信水平。 ")]),r("p",[e._v("置信水平代表了估计的可靠度，一般来说，我们使用 95% 的置信水平来进行区间估计。简单地讲，置信区间就是我们想要找到的这么一个均值区间范围，此区间有 95% 的可能性包含真实的总体均值。")]),r("p",[e._v("根据统计学的中心极限定理，样本均值的抽样分布呈正态分布。因此，通过相关的公式我们可以计算出两个总体均值差的95%置信区间。")]),r("p",[r("img",{attrs:{src:a("7a4b"),alt:"置信区间"}})]),r("p",[e._v("为了更直观，一般我们把这个总体均值差的置信区间转换为相比基准实验均值的变化的百分比置信区间：")]),r("h4",[e._v("样本数据")]),r("p",[e._v("我们采用每个小时的离线统计数据作为样本，并对高度异常的异常值进行剔除（ 与平均值的偏差超过三倍标准差的测定值，称为高度异常的异常值 ）。")]),r("h4",[e._v("最小实验时间")]),r("p",[e._v("平台采用80%的统计功效对最小样本量进行估计，当达到最小样本量（最小实验时间）时，表明显著性和置信区间达到了80%的统计功效，该统计结果具有较高的可信度。最小实验时间过大，表明该指标值统计功效过低，统计结果意义不大")])])])],1)],1)},sa=[],na={data:function(){return{list:[],originQuota:[],show3:!0,show2:!0,show1:!0}},mounted:function(){var e=this;this.$api.quota.getBook().then((function(t){e.list=t.data}))}},ia=na,oa=(a("9f63"),a("f492"),Object(h["a"])(ia,ra,sa,!1,null,"1b95f12e",null)),la=oa.exports,ca={data:function(){return{listData:[],hubbleQuotas:[],tableType:"origin",activeName:"origin"}},components:{QuotaListTable:Ht,HubbleQuotaTable:Kt,AddQuotaCtr:aa,ExpEffectBook:la},mounted:function(){this.tableType=this.$route.query.quota_type||"origin",this.init(),this.getHubbleQuotas()},methods:{handleClick:function(e,t){this.tableType=e.name,"add_quota"!=this.tableType&&this.init()},init:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=[],"hubble"!=this.tableType){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.$api.quota.getListByGo(this.tableType);case 5:t=e.sent,this.listData=t.data;case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getHubbleQuotas:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.quota.getHubbleList();case 2:t=e.sent,this.hubbleQuotas=t.data;case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},ua=ca,pa=Object(h["a"])(ua,Mt,Bt,!1,null,null,null),_a=pa.exports,da=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("AddQuotaCtr",{attrs:{quotaRange:"none"},on:{afterCreateQuota:e.afterCreateQuota}})],1)},fa=[],ha={components:{AddQuotaCtr:aa}},ma=ha,ya=Object(h["a"])(ma,da,fa,!1,null,null,null),ga=(ya.exports,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-steps",{attrs:{active:e.stepIndex,simple:"","finish-status":"success","process-status":"process"}},[a("el-step",{attrs:{title:"选择实验类型",icon:"el-icon-s-check"}}),a("el-step",{attrs:{title:"选择策略",icon:"el-icon-set-up"}}),a("el-step",{attrs:{title:"实验基本信息",icon:"el-icon-edit"}}),a("el-step",{attrs:{title:"实验分桶信息",icon:"el-icon-copy-document"}})],1),e.checkMsgList.length>0?a("el-col",{staticStyle:{padding:"20px 0 30px 0"},attrs:{offset:3,span:18}},[a("p",{staticStyle:{"font-size":"18px"}},[e._v("本页面错误信息如下")]),e._l(e.checkMsgList,(function(t,r){return[a("p",{staticClass:"red-font",domProps:{innerHTML:e._s(r+1+"、"+t)}})]}))],2):e._e(),0==e.stepIndex?a("el-row",{staticStyle:{"margin-top":"20px"}},[a("SelectExpType",{on:{nextStep:e.nextStep}})],1):e._e(),1==e.stepIndex?a("el-row",{staticStyle:{"margin-top":"40px"}},[a("el-col",{attrs:{span:18,offset:3}},[a("SelectStrategySet",{ref:"strategyset"})],1)],1):e._e(),2==e.stepIndex?a("el-row",{staticStyle:{"margin-top":"40px"}},[a("el-col",{attrs:{span:18,offset:3}},[0==e.layerType?a("ExpBaseInfo",{ref:"expbaseinfo"}):e._e(),1==e.layerType&&1==e.sameType?a("CustExpBaseInfo",{ref:"expbaseinfo"}):e._e(),1==e.layerType&&0==e.sameType?a("CustExp2BaseInfo",{ref:"expbaseinfo"}):e._e()],1)],1):e._e(),3==e.stepIndex?a("el-row",{staticStyle:{"margin-top":"40px"}},[a("el-col",{attrs:{span:18,offset:3}},[1==e.sameType?a("SetExp",{ref:"setexp"}):e._e(),0==e.sameType?a("SetExpTwo",{ref:"setexp"}):e._e()],1)],1):e._e(),a("el-row",{staticStyle:{"padding-top":"100px"}},[a("el-col",{attrs:{span:1,offset:3}},[e.showPrevStep?a("el-button",{attrs:{type:"primary"},on:{click:e.prevStep}},[a("i",{staticClass:"el-icon-back"}),e._v("上一步 ")]):e._e()],1),a("el-col",{attrs:{span:2,offset:8}},[e.showPreview?a("el-button",{attrs:{type:"primary"},on:{click:e.showPreviewDrawer}},[e._v("预览")]):e._e()],1),a("el-col",{attrs:{span:1,offset:16}},[e.showNextStep?a("el-button",{attrs:{type:"primary"},on:{click:e.nextStep}},[e._v(" 下一步 "),a("i",{staticClass:"el-icon-right"})]):e._e()],1)],1),a("el-dialog",{attrs:{title:"页面预览",visible:e.previewDrawer,size:"80%","custom-class":"drawerscroll"},on:{"update:visible":function(t){e.previewDrawer=t}}},[a("ExpPreview",{ref:"preview",attrs:{previewData:e.postData}}),a("el-row",{staticStyle:{margin:"30px 20px"}},[a("AddAuditor",{attrs:{expZoneCode:e.expZoneCode},model:{value:e.assignAuditor,callback:function(t){e.assignAuditor=t},expression:"assignAuditor"}})],1),a("el-row",{staticStyle:{margin:"30px 0 50px"}},[a("el-col",{attrs:{span:2,offset:11}},[a("el-button",{attrs:{type:"primary",disabled:e.disableSubmit},on:{click:e.toSubmit}},[e._v("创建")])],1)],1)],1)],1)}),ba=[],xa=(a("a4d3"),a("e439"),a("dbb4"),a("b64b"),a("ade3")),va=a("2f62"),wa=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-card",{staticClass:"box-card select-item"},[a("h1",[e._v("流量侧")]),a("p",[e._v("创建小流量的A/B实验，指定分桶流量规模，分桶方式等")]),a("el-button",{attrs:{type:"success"},on:{click:function(t){return e.selectLayerType(0,1)}}},[e._v("流量侧实验")])],1)],1),a("el-col",{attrs:{span:12}},[a("el-card",{staticClass:"box-card select-item"},[a("h1",[e._v("广告主侧")]),a("p",[e._v("选定广告主作为实验对象")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.selectLayerType(1,1)}}},[e._v("同质实验")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.selectLayerType(1,0)}}},[e._v("非同质实验")])],1)],1)],1)},ka=[],Sa={methods:{selectLayerType:function(e,t){this.$store.commit("setExpLayerType",e),this.$store.commit("setSameType",t),this.$emit("nextStep")}}},Ia=Sa,La=(a("e514"),Object(h["a"])(Ia,wa,ka,!1,null,"16ed9d37",null)),$a=La.exports,Da=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",[a("el-form",{ref:"form",attrs:{"label-position":"top","label-width":"150px"}},[a("el-form-item",{attrs:{label:"产品线"}},[a("el-radio-group",{on:{change:e.changeExpZoneCode},model:{value:e.expZoneCode,callback:function(t){e.expZoneCode=t},expression:"expZoneCode"}},[e._l(e.expZoneList,(function(t,r){return[a("el-radio-button",{attrs:{label:t.exp_zone_code}},[e._v(e._s(t.product_chinese_name+" | "+t.exp_zone_chinese_name))])]}))],2)],1),a("el-form-item",{attrs:{label:"策略/参数"}},[a("el-col",[a("el-select",{staticStyle:{display:"block"},attrs:{placeholder:"请选择策略",filterable:""},on:{change:e.changeStrategySetId},model:{value:e.strategySetId,callback:function(t){e.strategySetId=t},expression:"strategySetId"}},[e._l(e.strategySetList,(function(e){return[a("el-option",{attrs:{label:e.strategy_set_name_new,value:e.strategy_set_id}})]}))],2)],1)],1)],1)],1)],1)},Ca=[],Ea={data:function(){return{expZoneList:[],strategySetList:[],expZoneCode:78301,strategySetId:0}},mounted:function(){this.$store.state.create_exp.exp_layer_type<0?this.$tool.reload():(this.getMyAccessList(this.$store.state.create_exp.exp_zone_code,this.$store.state.create_exp.strategy_set_id),this.$store.commit("initAssignUser",[]))},methods:{getMyAccessList:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,a){var r,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.user.getUserExpZoneList(2);case 2:if(r=e.sent,!(r.data.length<1)){e.next=6;break}return this.$alert("你暂时没有创建实验权限，请您联系tieniu@staff.weibo.com开通权限","无权限提示",{confirmButtonText:"确定",callback:function(e){s.$tool.reload()}}),e.abrupt("return");case 6:return this.expZoneList=r.data,t>0?this.expZoneCode=t:(this.expZoneCode=this.expZoneList[0].exp_zone_code,this.$store.commit("setExpZoneCode",this.expZoneCode)),e.next=10,this.$api.strategy.getCreateExpStrategyList(this.expZoneCode,this.$store.state.create_exp.exp_layer_type);case 10:if(r=e.sent,!(r.data.length<1)){e.next=14;break}return this.$message("您在实验区下暂无可用实验的策略"),e.abrupt("return");case 14:this.strategySetList=this.$tool.fmtStrategySetList(r.data),a>0?this.strategySetId=a:(this.strategySetId=this.strategySetList[0].strategy_set_id,this.changeStrategySetId());case 16:case"end":return e.stop()}}),e,this)})));function t(t,a){return e.apply(this,arguments)}return t}(),changeExpZoneCode:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.$store.commit("setExpZoneCode",this.expZoneCode),e.next=3,this.$api.strategy.getCreateExpStrategyList(this.expZoneCode,this.$store.state.create_exp.exp_layer_type);case 3:if(t=e.sent,!(Object.keys(t.data).length<1)){e.next=10;break}return this.strategySetList=[],this.$message("您在实验区下暂无可用实验的策略"),this.strategySetId=0,this.changeStrategySetId(),e.abrupt("return");case 10:this.strategySetList=this.$tool.fmtStrategySetList(t.data),this.strategySetId=this.strategySetList[0].strategy_set_id,this.changeStrategySetId();case 13:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),changeStrategySetId:function(){this.$store.commit("setStrategySetId",this.strategySetId)},checkInputData:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t={},!(this.strategySetId<1)){e.next=3;break}return e.abrupt("return",["请选择策略"]);case 3:return e.next=5,this.$api.strategy.getStrategyExpStat(this.strategySetId);case 5:if(t=e.sent,!(t.data.strategy_set.strategy_set_id<1)){e.next=8;break}return e.abrupt("return",["策略有误"]);case 8:if(!(t.data.volume_full_apply.id>1)){e.next=10;break}return e.abrupt("return",["有正在申请全量的实验，暂时无法创建实验"]);case 10:if(0!=this.$store.state.create_exp.exp_layer_type||78301!=this.expZoneCode){e.next=15;break}if(!(t.data.use_traffic>=1e3)){e.next=13;break}return e.abrupt("return",["剩余域流量为0，无法继续创建实验"]);case 13:e.next=17;break;case 15:if(!(t.data.exp_layer.exp_layer_id>0)){e.next=17;break}return e.abrupt("return",["实验"+t.data.exp_layer.exp_layer_name+"正在占用该策略，暂时无法创建实验"]);case 17:if(2!=t.data.strategy_set.strategy_set_type){e.next=20;break}if(0==t.data.exp_layer.exp_layer_type){e.next=20;break}return e.abrupt("return",["实验"+t.data.exp_layer.exp_layer_name+"正在占用该策略，暂时无法创建实验"]);case 20:return e.abrupt("return",[]);case 21:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},Ta=Ea,Oa=Object(h["a"])(Ta,Da,Ca,!1,null,null,null),ja=Oa.exports,Ra=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-col",[a("el-form",{attrs:{"label-position":"top","label-width":"150px",model:e.layerInfo}},[e.showDomainInput?a("el-form-item",{attrs:{label:"划分实验域流量占比"}},[a("el-slider",{attrs:{min:0,max:e.restTrafficWeight,step:10},on:{change:e.commitLayerInfo},model:{value:e.layerInfo.traffic_weight,callback:function(t){e.$set(e.layerInfo,"traffic_weight",t)},expression:"layerInfo.traffic_weight"}}),a("p",[e._v("本实验使用流量："),a("el-tag",[e._v(e._s(e.layerInfo.traffic_weight))]),e._v("，其他域已用流量："),a("el-tag",{attrs:{type:"warning"}},[e._v(e._s(1e3-e.restTrafficWeight))]),e._v(" ，剩余："),a("el-tag",{attrs:{type:"success"}},[e._v(e._s(e.restTrafficWeight-e.layerInfo.traffic_weight))])],1)],1):e._e(),a("el-form-item",{attrs:{label:"实验名称："}},[a("el-input",{attrs:{placeholder:"请输入实验名称（不超过20个字）"},on:{change:e.commitLayerInfo},model:{value:e.layerInfo.exp_layer_name,callback:function(t){e.$set(e.layerInfo,"exp_layer_name",t)},expression:"layerInfo.exp_layer_name"}})],1),a("el-form-item",{attrs:{label:"实验描述："}},[a("el-input",{attrs:{type:"textarea",rows:"6",placeholder:"【请填写实验的预期目标，实验的设计方案，实验的放量计划，实验关心的核心指标等】"},on:{change:e.commitLayerInfo},model:{value:e.layerInfo.exp_layer_comment,callback:function(t){e.$set(e.layerInfo,"exp_layer_comment",t)},expression:"layerInfo.exp_layer_comment"}})],1),a("el-form-item",{attrs:{label:"流量A/B分桶类型："}},[a("el-radio",{attrs:{label:2},on:{change:e.commitLayerInfo},model:{value:e.layerInfo.alloc_type_code,callback:function(t){e.$set(e.layerInfo,"alloc_type_code",t)},expression:"layerInfo.alloc_type_code"}},[e._v("用户哈希分桶")]),a("el-radio",{attrs:{label:3},on:{change:e.commitLayerInfo},model:{value:e.layerInfo.alloc_type_code,callback:function(t){e.$set(e.layerInfo,"alloc_type_code",t)},expression:"layerInfo.alloc_type_code"}},[e._v("用户按天哈希分桶")]),a("el-radio",{attrs:{label:1},on:{change:e.commitLayerInfo},model:{value:e.layerInfo.alloc_type_code,callback:function(t){e.$set(e.layerInfo,"alloc_type_code",t)},expression:"layerInfo.alloc_type_code"}},[e._v("流量哈希分桶")])],1),a("el-form-item",{attrs:{label:"流量团圈定："}},[a("el-radio",{attrs:{label:0},on:{change:e.commitLayerInfo},model:{value:e.layerInfo.alloc_condition_enable,callback:function(t){e.$set(e.layerInfo,"alloc_condition_enable",t)},expression:"layerInfo.alloc_condition_enable"}},[e._v("不启用")]),a("el-radio",{attrs:{label:1},on:{change:e.commitLayerInfo},model:{value:e.layerInfo.alloc_condition_enable,callback:function(t){e.$set(e.layerInfo,"alloc_condition_enable",t)},expression:"layerInfo.alloc_condition_enable"}},[e._v("启用")])],1)],1),1==e.layerInfo.alloc_condition_enable?a("el-card",{staticClass:"box-card"},[a("FlowAlloc",{directives:[{name:"show",rawName:"v-show",value:"1"==e.layerInfo.alloc_condition_enable,expression:"layerInfo.alloc_condition_enable == '1'"}]})],1):e._e()],1)},qa=[],Aa=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{attrs:{"label-position":"left","label-width":"80px"},model:{value:e.conf,callback:function(t){e.conf=t},expression:"conf"}},[a("el-form-item",{attrs:{label:"年龄"}},[a("el-slider",{attrs:{range:"","show-stops":"",max:100,min:1},model:{value:e.conf.AGE,callback:function(t){e.$set(e.conf,"AGE",t)},expression:"conf.AGE"}})],1),a("el-form-item",{attrs:{label:"性别"}},[a("el-radio",{attrs:{label:401},model:{value:e.conf.GENDER,callback:function(t){e.$set(e.conf,"GENDER",t)},expression:"conf.GENDER"}},[e._v("男")]),a("el-radio",{attrs:{label:402},model:{value:e.conf.GENDER,callback:function(t){e.$set(e.conf,"GENDER",t)},expression:"conf.GENDER"}},[e._v("女")]),a("el-radio",{attrs:{label:400},model:{value:e.conf.GENDER,callback:function(t){e.$set(e.conf,"GENDER",t)},expression:"conf.GENDER"}},[e._v("保密")]),a("el-radio",{attrs:{label:0},model:{value:e.conf.GENDER,callback:function(t){e.$set(e.conf,"GENDER",t)},expression:"conf.GENDER"}},[e._v("不限")])],1),a("el-form-item",{attrs:{label:"设备"}},[a("el-checkbox-group",{model:{value:e.conf.PLATFORM,callback:function(t){e.$set(e.conf,"PLATFORM",t)},expression:"conf.PLATFORM"}},[a("el-checkbox",{key:90110201,attrs:{label:"90110201"}},[e._v("IOS平台")]),a("el-checkbox",{key:90110202,attrs:{label:"90110202"}},[e._v("Android平台")]),a("el-checkbox",{key:90110100,attrs:{label:"90110100"}},[e._v("PC端")]),a("el-checkbox",{key:90110200,attrs:{label:"90110200"}},[e._v("移动端_其它")]),a("el-checkbox",{key:9e7,attrs:{label:"90000000"}},[e._v("未知")])],1)],1),a("el-form-item",{attrs:{label:"场景流"}},[a("el-select",{staticStyle:{width:"40%"},attrs:{multiple:"","collapse-tags":"",placeholder:"请选择场景"},model:{value:e.conf.SERVICE,callback:function(t){e.$set(e.conf,"SERVICE",t)},expression:"conf.SERVICE"}},e._l(e.msgFlowConfig,(function(e,t){return a("el-option",{key:t,attrs:{label:e,value:t}})})),1)],1),a("el-form-item",{attrs:{label:"地域"}},[a("el-select",{staticStyle:{width:"40%"},attrs:{multiple:"","collapse-tags":"",placeholder:"请选择城市"},model:{value:e.conf.LOCATION,callback:function(t){e.$set(e.conf,"LOCATION",t)},expression:"conf.LOCATION"}},[a("el-option-group",{key:"hotCity",attrs:{label:"热门城市"}},e._l(e.locationsConfig.hotCity,(function(e,t){return a("el-option",{key:t,attrs:{label:e.location_name,value:t}})})),1),a("el-option-group",{key:"city",attrs:{label:"其他城市"}},e._l(e.locationsConfig.locationObj,(function(e,t){return a("el-option",{key:t,attrs:{label:e.location_name,value:t}})})),1)],1)],1),a("el-form-item",{attrs:{label:"App版本"}},[a("el-input",{staticStyle:{width:"20%"},attrs:{placeholder:"格式ABC，比如863"},model:{value:e.conf.VERSION,callback:function(t){e.$set(e.conf,"VERSION",t)},expression:"conf.VERSION"}}),a("span",{staticStyle:{"margin-left":"10px"}},[e._v("(及以上版本)")])],1),a("el-form-item",{attrs:{label:"服务器"}},[a("el-radio",{attrs:{label:""},model:{value:e.severName,callback:function(t){e.severName=t},expression:"severName"}},[e._v("无")]),e._l(e.severNameList,(function(t,r){return a("el-radio",{key:r,attrs:{label:t},model:{value:e.severName,callback:function(t){e.severName=t},expression:"severName"}},[e._v(e._s(t))])}))],2),""!=e.severName?a("el-form-item",[a("el-select",{staticStyle:{width:"40%"},attrs:{multiple:"","collapse-tags":"",placeholder:"请选择IP"},model:{value:e.conf.IP,callback:function(t){e.$set(e.conf,"IP",t)},expression:"conf.IP"}},e._l(e.allIpList[e.severName],(function(t,r){return a("el-option-group",{key:r,attrs:{label:r}},e._l(t,(function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})})),1)})),1),a("el-popover",{attrs:{placement:"top",width:"300"},model:{value:e.showIpText,callback:function(t){e.showIpText=t},expression:"showIpText"}},[a("p",[a("el-input",{attrs:{type:"textarea",rows:"8",placeholder:"请输入IP，一行一个"},model:{value:e.inputIps,callback:function(t){e.inputIps=t},expression:"inputIps"}})],1),a("div",{staticStyle:{"text-align":"right",margin:"0"}},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){e.showIpText=!1}}},[e._v("取消")]),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.confirmInputIp}},[e._v("确定")])],1),a("el-button",{attrs:{slot:"reference",type:"primary"},on:{click:function(t){e.showIpText=!e.showIpText}},slot:"reference"},[e._v("批量输入IP")])],1)],1):e._e()],1)],1)},Ma=[],Ba=(a("d3b7"),a("1276"),a("ddb0"),a("2909")),Pa=a("a4de"),Qa=a.n(Pa),Ua=a("0d5a"),Na=a.n(Ua),za={props:["isSfst","inputConf"],data:function(){var e=this.$store.state.create_exp.flow_alloc_conf,t=this.$store.state.create_exp.server_name;return{msgFlowConfig:Qa.a,locationsConfig:Na.a,conf:e,severName:t,severNameList:[],allIpList:{},showIpText:!1,inputIps:"",inputIpMsg:""}},mounted:function(){this.loadAllIp()},watch:{conf:{handler:function(){this.$store.commit("setFlowAlloConf",this.conf)},deep:!0},severName:function(){""==this.severName?this.conf.IP=[]:this.$store.commit("setServerName",this.severName)}},methods:{loadAllIp:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.exp.getIpList();case 2:t=e.sent,this.allIpList=t.data,this.severNameList=Object.keys(this.allIpList);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),confirmInputIp:function(){var e,t=this.inputIps.trim().split("\n"),a=this.$lodash.values(this.allIpList[this.severName]),r=(e=this.$lodash).union.apply(e,Object(Ba["a"])(a)),s=this.$lodash.difference(t,r),n=this.$lodash.pullAll(t,s);n.length<1?this.$message({message:"请输入ip，或者ip不在所选机器之内",type:"warning"}):(this.conf.IP=n,s.length>0?(this.inputIpMsg="已经选中".concat(n.length,"个IP,有另外的").concat(s.join("、"),"没有匹配上，请检查"),this.$message({message:this.inputIpMsg,type:"warning"}),this.inputIps=this.$lodash.join(s,"\n")):(this.inputIps="",this.showIpText=!1))}}},Ha=za,Fa=Object(h["a"])(Ha,Aa,Ma,!1,null,null,null),Va=Fa.exports;function Ga(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Wa(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Ga(Object(a),!0).forEach((function(t){Object(xa["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Ga(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Za={data:function(){return{layerInfo:{alloc_type_code:2,exp_layer_comment:"【实验目的】\n\n【实验方案】\n\n【实验风险】",exp_layer_name:"",alloc_condition_enable:0,flow_type:1,traffic_weight:0},restTrafficWeight:1e3}},components:{FlowAlloc:Va},computed:Wa({},Object(va["b"])({showDomainInput:"show_domain"})),mounted:function(){this.$store.state.create_exp.strategy_set_id<1?this.$emit("preStep"):(Object.keys(this.$store.state.create_exp.exp_base_info).length>0&&(console.log(this.$store.state.create_exp.exp_base_info),this.layerInfo=this.$store.state.create_exp.exp_base_info),this.getRestDomain())},methods:{commitLayerInfo:function(){this.$store.commit("setExpBaseInfo",this.layerInfo)},checkInputData:function(){return""==this.layerInfo.exp_layer_name?["请输入实验名称"]:this.layerInfo.exp_layer_name.length>60?["实验名称长度在 1 到 60个字符"]:""==this.layerInfo.exp_layer_comment?["请输入实验描述"]:this.showDomainInput&&this.layerInfo.traffic_weight<1?["请划分实验域流量占比"]:[]},getRestDomain:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.showDomainInput){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.$api.strategy.getStrategyExpStat(this.$store.state.create_exp.strategy_set_id);case 4:t=e.sent,this.restTrafficWeight=1e3-t.data.use_traffic;case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},Ka=Za,Ya=Object(h["a"])(Ka,Ra,qa,!1,null,null,null),Ja=Ya.exports,Xa=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-col",[a("el-form",{attrs:{"label-position":"top","label-width":"150px"},model:{value:e.layerInfo,callback:function(t){e.layerInfo=t},expression:"layerInfo"}},[a("el-form-item",{attrs:{label:"实验名称："}},[a("el-input",{attrs:{placeholder:"请输入实验名称（不超过20个字）"},on:{change:e.commitLayerInfo},model:{value:e.layerInfo.exp_layer_name,callback:function(t){e.$set(e.layerInfo,"exp_layer_name",t)},expression:"layerInfo.exp_layer_name"}})],1),a("el-form-item",{attrs:{label:"实验描述："}},[a("el-input",{attrs:{type:"textarea",rows:"6",placeholder:"【请填写实验的预期目标，实验的设计方案，实验的放量计划，实验关心的核心指标等】"},on:{change:e.commitLayerInfo},model:{value:e.layerInfo.exp_layer_comment,callback:function(t){e.$set(e.layerInfo,"exp_layer_comment",t)},expression:"layerInfo.exp_layer_comment"}})],1),a("el-form-item",{attrs:{label:"流量A/B分桶类型："}},[a("el-radio",{attrs:{label:2},on:{change:e.commitLayerInfo},model:{value:e.layerInfo.alloc_type_code,callback:function(t){e.$set(e.layerInfo,"alloc_type_code",t)},expression:"layerInfo.alloc_type_code"}},[e._v("用户哈希分桶")]),a("el-radio",{attrs:{label:3},on:{change:e.commitLayerInfo},model:{value:e.layerInfo.alloc_type_code,callback:function(t){e.$set(e.layerInfo,"alloc_type_code",t)},expression:"layerInfo.alloc_type_code"}},[e._v("用户按天哈希分桶")]),a("el-radio",{attrs:{label:1},on:{change:e.commitLayerInfo},model:{value:e.layerInfo.alloc_type_code,callback:function(t){e.$set(e.layerInfo,"alloc_type_code",t)},expression:"layerInfo.alloc_type_code"}},[e._v("流量哈希分桶")])],1),a("el-form-item",{attrs:{label:"特殊支持："}},[a("el-switch",{attrs:{"active-text":"预算分桶实验"},on:{change:e.changeBudgetExp},model:{value:e.layerInfo.is_divide_budget,callback:function(t){e.$set(e.layerInfo,"is_divide_budget",t)},expression:"layerInfo.is_divide_budget"}})],1),a("el-form-item",{attrs:{label:"实验对象类型："}},[a("el-radio",{attrs:{label:"CUSTID",disabled:e.layerInfo.is_divide_budget},on:{change:e.commitLayerInfo},model:{value:e.layerInfo.exp_object_type,callback:function(t){e.$set(e.layerInfo,"exp_object_type",t)},expression:"layerInfo.exp_object_type"}},[e._v("广告主")]),a("el-radio",{attrs:{label:"ADID"},on:{change:e.commitLayerInfo},model:{value:e.layerInfo.exp_object_type,callback:function(t){e.$set(e.layerInfo,"exp_object_type",t)},expression:"layerInfo.exp_object_type"}},[e._v("广告计划")]),a("el-radio",{attrs:{label:"MID",disabled:e.layerInfo.is_divide_budget},on:{change:e.commitLayerInfo},model:{value:e.layerInfo.exp_object_type,callback:function(t){e.$set(e.layerInfo,"exp_object_type",t)},expression:"layerInfo.exp_object_type"}},[e._v("博文")]),a("el-radio",{attrs:{label:"TAG",disabled:e.layerInfo.is_divide_budget},on:{change:e.commitLayerInfo},model:{value:e.layerInfo.exp_object_type,callback:function(t){e.$set(e.layerInfo,"exp_object_type",t)},expression:"layerInfo.exp_object_type"}},[e._v("广告行业")])],1),a("el-form-item",{attrs:{label:"实验对象："}},[a("el-input",{attrs:{type:"textarea",rows:"6",placeholder:"实验对象"},on:{change:e.commitLayerInfo},model:{value:e.layerInfo.exp_object,callback:function(t){e.$set(e.layerInfo,"exp_object",t)},expression:"layerInfo.exp_object"}})],1)],1)],1)},er=[],tr={data:function(){return{layerInfo:{exp_layer_type:1,alloc_type_code:2,exp_layer_comment:"【实验目的】\n\n【实验方案】\n\n【实验风险】",exp_layer_name:"",flow_type:0,is_divide_budget:!1,exp_object_type:"ADID",exp_object:""},budgetExp:!1}},mounted:function(){this.$store.state.create_exp.strategy_set_id<1?this.$emit("preStep"):Object.keys(this.$store.state.create_exp.exp_base_info).length>0&&(console.log(this.$store.state.create_exp.exp_base_info),this.layerInfo=this.$store.state.create_exp.exp_base_info)},methods:{changeBudgetExp:function(){this.layerInfo.is_divide_budget&&"ADID"!=this.layerInfo.exp_object_type&&(this.layerInfo.exp_object_type="ADID",this.layerInfo.exp_object=""),this.commitLayerInfo()},commitLayerInfo:function(){this.$store.commit("setExpBaseInfo",this.layerInfo)},checkInputData:function(){return""==this.layerInfo.exp_layer_name?["请输入实验名称"]:this.layerInfo.exp_layer_name.length>20?["实验名称长度在 1 到 20个字符"]:""==this.layerInfo.exp_layer_comment?["请输入实验描述"]:""==this.layerInfo.exp_object?["请输入实验对象"]:[]}}},ar=tr,rr=Object(h["a"])(ar,Xa,er,!1,null,null,null),sr=rr.exports,nr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-col",[a("el-form",{attrs:{"label-position":"top","label-width":"150px"},model:{value:e.layerInfo,callback:function(t){e.layerInfo=t},expression:"layerInfo"}},[a("el-form-item",{attrs:{label:"实验名称："}},[a("el-input",{attrs:{placeholder:"请输入实验名称（不超过20个字）"},on:{change:e.commitLayerInfo},model:{value:e.layerInfo.exp_layer_name,callback:function(t){e.$set(e.layerInfo,"exp_layer_name",t)},expression:"layerInfo.exp_layer_name"}})],1),a("el-form-item",{attrs:{label:"实验描述："}},[a("el-input",{attrs:{type:"textarea",rows:"6",placeholder:"【请填写实验的预期目标，实验的设计方案，实验的放量计划，实验关心的核心指标等】"},on:{change:e.commitLayerInfo},model:{value:e.layerInfo.exp_layer_comment,callback:function(t){e.$set(e.layerInfo,"exp_layer_comment",t)},expression:"layerInfo.exp_layer_comment"}})],1),a("el-form-item",{attrs:{label:"实验对象类型："}},[a("el-radio",{attrs:{label:4},on:{change:e.commitLayerInfo},model:{value:e.layerInfo.alloc_type_code,callback:function(t){e.$set(e.layerInfo,"alloc_type_code",t)},expression:"layerInfo.alloc_type_code"}},[e._v("广告主")]),a("el-radio",{attrs:{label:5},on:{change:e.commitLayerInfo},model:{value:e.layerInfo.alloc_type_code,callback:function(t){e.$set(e.layerInfo,"alloc_type_code",t)},expression:"layerInfo.alloc_type_code"}},[e._v("广告计划")]),a("el-radio",{attrs:{label:6},on:{change:e.commitLayerInfo},model:{value:e.layerInfo.alloc_type_code,callback:function(t){e.$set(e.layerInfo,"alloc_type_code",t)},expression:"layerInfo.alloc_type_code"}},[e._v("博文")]),a("el-radio",{attrs:{label:7},on:{change:e.commitLayerInfo},model:{value:e.layerInfo.alloc_type_code,callback:function(t){e.$set(e.layerInfo,"alloc_type_code",t)},expression:"layerInfo.alloc_type_code"}},[e._v("广告行业")])],1)],1)],1)},ir=[],or={data:function(){return{layerInfo:{exp_layer_type:1,alloc_type_code:7,exp_layer_comment:"【实验目的】\n\n【实验方案】\n\n【实验风险】",exp_layer_name:""}}},mounted:function(){this.$store.state.create_exp.strategy_set_id<1?this.$emit("preStep"):Object.keys(this.$store.state.create_exp.exp_base_info).length>0&&(console.log(this.$store.state.create_exp.exp_base_info),this.layerInfo=this.$store.state.create_exp.exp_base_info)},methods:{commitLayerInfo:function(){this.$store.commit("setExpBaseInfo",this.layerInfo)},checkInputData:function(){return""==this.layerInfo.exp_layer_name?["请输入实验名称"]:this.layerInfo.exp_layer_name.length>60?["实验名称长度在 1 到 60个字符"]:""==this.layerInfo.exp_layer_comment?["请输入实验描述"]:[]}}},lr=or,cr=Object(h["a"])(lr,nr,ir,!1,null,null,null),ur=cr.exports,pr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{staticStyle:{padding:"20px 0 30px 0"}},[a("p",{staticStyle:{"font-size":"18px"}},[e._v("已使用流量占比")]),a("el-progress",{attrs:{"text-inside":!0,"stroke-width":28,percentage:e.totalWeight/10}})],1),a("el-col",[a("el-tabs",{attrs:{type:"card",editable:""},on:{edit:e.handleTabsEdit},model:{value:e.editableTabsValue,callback:function(t){e.editableTabsValue=t},expression:"editableTabsValue"}},e._l(e.expList,(function(t,r){return a("el-tab-pane",{key:t.tab_name,attrs:{label:t.exp_title+"【"+t.traffic_weight/10+"%】",closable:!1,name:t.tab_name}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form",{attrs:{"label-position":"top"}},[a("el-form-item",{attrs:{label:"子实验名称："}},[a("el-input",{attrs:{placeholder:"请输入实验名称（不超过20个字）",disabled:2==t.exp_type_code||t.exp_id>0||"基准nodiff实验"==t.exp_title},model:{value:t.exp_title,callback:function(a){e.$set(t,"exp_title",a)},expression:"item.exp_title"}})],1),a("el-form-item",{attrs:{label:"描述："}},[a("el-input",{attrs:{type:"textarea",rows:"3",placeholder:"实验描述"},model:{value:t.exp_comment,callback:function(a){e.$set(t,"exp_comment",a)},expression:"item.exp_comment"}})],1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form",{attrs:{"label-position":"top"}},[a("el-form-item",{attrs:{label:"流量权重:"}},[a("el-input",{attrs:{placeholder:"请输入实验名称（不超过20个字）",type:"number"},model:{value:t.traffic_weight,callback:function(a){e.$set(t,"traffic_weight",e._n(a))},expression:"item.traffic_weight"}})],1),a("el-form-item",{attrs:{label:"用户白名单:"}},[a("el-input",{attrs:{type:"textarea",rows:"3",placeholder:"请输入用户uid，用逗号分隔",disabled:2==t.exp_type_code||t.exp_id>0||"基准nodiff实验"==t.exp_title},model:{value:t.white_list_uid,callback:function(a){e.$set(t,"white_list_uid",a)},expression:"item.white_list_uid"}})],1)],1)],1)],1),a("el-form",{attrs:{"label-position":"top"}},[e._l(e.strategyTypeMap,(function(r,s){return[a("el-form-item",{attrs:{label:s+"、"+r}},[a("el-input",{attrs:{type:"textarea",rows:"3",disabled:2==t.exp_type_code||t.exp_id>0||"基准nodiff实验"==t.exp_title},model:{value:t["s@"+s],callback:function(a){e.$set(t,"s@"+s,a)},expression:"item['s@'+key]"}})],1)]}))],2)],1)})),1)],1)],1)},_r=[],dr={data:function(){return{editableTabsValue:"0",tabIndex:0,expList:[],strategyList:[],strategyMap:{},defaultStrategyMap:{},strategyTypeMap:{}}},computed:{totalWeight:function(){var e=0;return this.expList.forEach((function(t,a){""!=t.traffic_weight&&(e+=parseInt(t.traffic_weight))})),e}},watch:{expList:{handler:function(){this.$store.commit("setExpList",this.getCommitExpList())},deep:!0}},mounted:function(){this.$store.state.create_exp.strategy_set_id<1?this.$emit("preStep"):this.getStrategys()},methods:{getStrategys:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.strategy.getStrategyByGo(this.$store.state.create_exp.strategy_set_id);case 2:t=e.sent,a=[],t.data.strategy_list.forEach((function(e){a.push(r.$lodash.merge(e,JSON.parse(e.verification)))})),this.strategyList=a,this.genStrategyMap(),this.getOriginExpList();case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getOriginExpList:function(){this.$store.state.create_exp.exp_list.length>0?(this.expList=this.getUnCommitExpList(this.$store.state.create_exp.exp_list),this.tabIndex=this.expList.length-1,this.editableTabsValue=this.expList[0].tab_name):(this.expList.push(this.genBaseExp()),this.addBaseNoDiffExp(),this.addExp())},getUnCommitExpList:function(e){var t=[];return e.forEach((function(e,a){var r=ve.a.pick(e,["exp_title","exp_type_code","traffic_weight","exp_comment","white_list_uid","exp_id","exp_layer_id","tab_name"]);Object.keys(e.exp_strategy_content).forEach((function(t){r["s@"+t]=e.exp_strategy_content[t]})),t.push(r)})),t},genStrategyMap:function(){for(var e in this.strategyList)this.defaultStrategyMap["s@"+this.strategyList[e].strategy_name]=this.strategyList[e].strategy_defult_value,"int"==this.strategyList[e].type?this.strategyTypeMap[this.strategyList[e].strategy_name]="类型:int，范围:[".concat(this.strategyList[e].min,", ").concat(this.strategyList[e].max,"]"):"string"==this.strategyList[e].type?this.strategyTypeMap[this.strategyList[e].strategy_name]="类型:string，最大长度:".concat(this.strategyList[e].max_length):"bool"==this.strategyList[e].type&&(this.strategyTypeMap[this.strategyList[e].strategy_name]="类型:bool")},genBaseExp:function(){return ve.a.merge({exp_title:"基准实验",exp_type_code:2,traffic_weight:0,exp_comment:"基准实验",white_list_uid:"",tab_name:"0"},this.defaultStrategyMap)},handleTabsEdit:function(e,t){"add"===t&&this.addExp(),"remove"===t&&this.removeExp(e)},addExp:function(){var e=++this.tabIndex+"";this.expList.push(ve.a.merge({exp_title:"实验"+e,exp_type_code:1,traffic_weight:0,exp_comment:"",white_list_uid:"",tab_name:e},this.defaultStrategyMap)),this.editableTabsValue=e},addBaseNoDiffExp:function(){var e=++this.tabIndex+"";this.expList.push(ve.a.merge({exp_title:"基准nodiff实验",exp_type_code:1,traffic_weight:0,exp_comment:"基准nodiff实验",white_list_uid:"",tab_name:e},this.defaultStrategyMap)),this.editableTabsValue=e},removeExp:function(e){var t=this.expList,a=this.editableTabsValue,r={};return t.forEach((function(t,a){t.tab_name===e&&(r=t)})),2==r.exp_type_code?(this.$message({type:"warning",message:"不能删除基准子实验"}),!1):2==this.expList.length?(this.$message({type:"warning",message:"请至少保留一个子实验"}),!1):(void 0!=r.exp_id&&r.exp_id>0&&this.$store.commit("setDelExp",r),a===e&&t.forEach((function(r,s){if(r.tab_name===e){var n=t[s+1]||t[s-1];n&&(a=n.tab_name)}})),this.editableTabsValue=a,void(this.expList=t.filter((function(t){return t.tab_name!==e}))))},checkInputData:function(){var e=this,t=[];return this.expList.forEach((function(a,r){var s=e.checkExpBaseInfo(a,r);""!=s&&t.push(s),e.strategyList.forEach((function(r,s){var n=e.checkStrategy(r,a["s@"+r.strategy_name]);""!=n&&t.push("子实验“".concat(a.exp_title,"”")+n)}))})),t},getCommitExpList:function(){var e=this,t=[];return this.expList.forEach((function(a,r){var s=ve.a.pick(a,["exp_id","exp_layer_id","exp_title","exp_type_code","traffic_weight","exp_comment","white_list_uid","tab_name"]);s.exp_strategy_content={},e.strategyList.forEach((function(e,t){s.exp_strategy_content[e.strategy_name]=a["s@"+e.strategy_name]})),t.push(s)})),t},checkExpBaseInfo:function(e,t){if(""==e.exp_title)return"第"+(t+1)+"个子实验名称不能为空";var a=e.exp_title;return e.exp_title.length>20?"子实验<strong>".concat(a,"</strong>名称长度不能超过20"):""==e.exp_comment?"子实验<strong>".concat(a,"</strong>描述不能为空"):0==e.traffic_weight&&""==e.white_list_uid?"子实验<strong>".concat(a,"</strong>流量权重不能为0"):e.traffic_weight>0&&""!=e.white_list_uid?"子实验<strong>".concat(a,"</strong>有白名单，流量权重必须为0"):""},checkStrategy:function(e,t){return"int"!=e.type||this.checkInt(t,e.min,e.max)?"string"!=e.type||this.checkString(t,e.max_length)?"bool"!=e.type||this.checkBool(t)?"":"策略".concat(e.strategy_name,"类型为bool，只能为true或者false"):"策略".concat(e.strategy_name,"类型为string，最大长度为").concat(e.max_length):"策略".concat(e.strategy_name,"类型为int，范围为").concat(e.min," ~ ").concat(e.max)},checkString:function(e,t){return e.length<=t},checkBool:function(e){return"true"==e||"false"==e},checkInt:function(e,t,a){var r=parseInt(e),s=parseInt(a),n=parseInt(t);return r>=n&&r<=s}}},fr=dr,hr=Object(h["a"])(fr,pr,_r,!1,null,"640131a4",null),mr=hr.exports,yr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-alert",{staticStyle:{"margin-bottom":"10px"},attrs:{type:"warning",closable:!1}},[a("strong",{staticStyle:{"font-size":"18px"}},[e._v("非同质实验对象只能在一个子实验里，不能被其他子实验共用")])]),a("el-col",[a("el-tabs",{attrs:{type:"card",editable:""},on:{edit:e.handleTabsEdit},model:{value:e.editableTabsValue,callback:function(t){e.editableTabsValue=t},expression:"editableTabsValue"}},e._l(e.expList,(function(t,r){return a("el-tab-pane",{key:t.tab_name,attrs:{label:t.exp_title,closable:!1,name:t.tab_name}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:20}},[a("el-form",{attrs:{"label-position":"top"}},[a("el-form-item",{attrs:{label:"子实验名称："}},[a("el-input",{attrs:{placeholder:"请输入实验名称（不超过20个字）",disabled:t.exp_id>0},model:{value:t.exp_title,callback:function(a){e.$set(t,"exp_title",a)},expression:"item.exp_title"}})],1),a("el-form-item",{attrs:{label:"描述："}},[a("el-input",{attrs:{type:"textarea",rows:"3",placeholder:"实验描述"},model:{value:t.exp_comment,callback:function(a){e.$set(t,"exp_comment",a)},expression:"item.exp_comment"}})],1),a("el-form-item",{attrs:{label:"实验对象名单:"}},[a("el-input",{attrs:{type:"textarea",rows:"3",placeholder:e.tip,disabled:t.exp_id>0},model:{value:t.white_list_uid,callback:function(a){e.$set(t,"white_list_uid",a)},expression:"item.white_list_uid"}})],1)],1)],1)],1),a("el-form",{attrs:{"label-position":"top"}},[e._l(e.strategyTypeMap,(function(r,s){return[a("el-form-item",{attrs:{label:s+"、"+r}},[a("el-input",{attrs:{type:"textarea",rows:"3",disabled:t.exp_id>0},model:{value:t["s@"+s],callback:function(a){e.$set(t,"s@"+s,a)},expression:"item['s@'+key]"}})],1)]}))],2)],1)})),1)],1)],1)},gr=[],br=a("86e5"),xr=a.n(br),vr={props:["allocType"],data:function(){return{editableTabsValue:"0",tabIndex:0,expList:[],strategyList:[],strategyMap:{},defaultStrategyMap:{},strategyTypeMap:{},tip:""}},watch:{expList:{handler:function(){this.$store.commit("setExpList",this.getCommitExpList())},deep:!0}},mounted:function(){this.$store.state.create_exp.strategy_set_id<1?this.$emit("preStep"):(void 0!=this.allocType?this.tip="请输入"+xr.a.CustObjectTypeMap[this.allocType+""]+"ID":void 0!=this.$store.state.create_exp.exp_base_info.alloc_type_code&&(this.tip="请输入"+xr.a.CustObjectTypeMap[this.$store.state.create_exp.exp_base_info.alloc_type_code+""]+"ID"),this.getStrategys())},methods:{getStrategys:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.strategy.getStrategyByGo(this.$store.state.create_exp.strategy_set_id);case 2:t=e.sent,a=[],t.data.strategy_list.forEach((function(e){a.push(r.$lodash.merge(e,JSON.parse(e.verification)))})),this.strategyList=a,this.genStrategyMap(),this.getOriginExpList();case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getOriginExpList:function(){this.$store.state.create_exp.exp_list.length>0?(this.expList=this.getUnCommitExpList(this.$store.state.create_exp.exp_list),this.tabIndex=this.expList.length-1,this.editableTabsValue=this.expList[0].tab_name):this.addExp()},getUnCommitExpList:function(e){var t=[];return e.forEach((function(e,a){var r=ve.a.pick(e,["exp_title","exp_type_code","traffic_weight","exp_comment","white_list_uid","exp_id","exp_layer_id","tab_name"]);Object.keys(e.exp_strategy_content).forEach((function(t){r["s@"+t]=e.exp_strategy_content[t]})),t.push(r)})),t},genStrategyMap:function(){for(var e in this.strategyList)this.defaultStrategyMap["s@"+this.strategyList[e].strategy_name]=this.strategyList[e].strategy_defult_value,"int"==this.strategyList[e].type?this.strategyTypeMap[this.strategyList[e].strategy_name]="类型:int，范围:[".concat(this.strategyList[e].min,", ").concat(this.strategyList[e].max,"]"):"string"==this.strategyList[e].type?this.strategyTypeMap[this.strategyList[e].strategy_name]="类型:string，最大长度:".concat(this.strategyList[e].max_length):"bool"==this.strategyList[e].type&&(this.strategyTypeMap[this.strategyList[e].strategy_name]="类型:bool")},handleTabsEdit:function(e,t){"add"===t&&this.addExp(),"remove"===t&&this.removeExp(e)},addExp:function(){var e=++this.tabIndex+"";this.expList.push(ve.a.merge({exp_title:"实验"+e,exp_type_code:1,traffic_weight:0,exp_comment:"",white_list_uid:"",tab_name:e},this.defaultStrategyMap)),this.editableTabsValue=e},removeExp:function(e){var t=this.expList,a=this.editableTabsValue;if(1==this.expList.length)return this.$message({type:"warning",message:"请至少保留一个子实验"}),!1;a===e&&t.forEach((function(r,s){if(r.tab_name===e){var n=t[s+1]||t[s-1];n&&(a=n.tab_name)}})),this.editableTabsValue=a,this.expList=t.filter((function(t){return t.tab_name!==e}))},checkInputData:function(){var e=this,t=[];return this.expList.forEach((function(a,r){var s=e.checkExpBaseInfo(a,r);""!=s&&t.push(s),e.strategyList.forEach((function(r,s){var n=e.checkStrategy(r,a["s@"+r.strategy_name]);""!=n&&t.push("子实验<strong>".concat(a.exp_title,"</strong>")+n)}))})),t},getCommitExpList:function(){var e=this,t=[];return this.expList.forEach((function(a,r){var s=ve.a.pick(a,["exp_id","exp_layer_id","exp_title","exp_type_code","traffic_weight","exp_comment","white_list_uid","tab_name"]);s.exp_strategy_content={},e.strategyList.forEach((function(e,t){s.exp_strategy_content[e.strategy_name]=a["s@"+e.strategy_name]})),t.push(s)})),t},checkExpBaseInfo:function(e,t){if(""==e.exp_title)return"第"+(t+1)+"个子实验名称不能为空";var a=e.exp_title;return e.exp_title.length>20?"<strong>".concat(a,"</strong>名称长度不能超过20"):""==e.exp_comment?"<strong>".concat(a,"</strong>描述不能为空"):""==e.white_list_uid?"请填写<strong>".concat(a,"</strong>实验对象"):""},checkStrategy:function(e,t){return"int"!=e.type||this.checkInt(t,e.min,e.max)?"string"!=e.type||this.checkString(t,e.max_length)?"bool"!=e.type||this.checkBool(t)?"":"策略".concat(e.strategy_name,"类型为bool，只能为true或者false"):"策略".concat(e.strategy_name,"类型为string，最大长度为").concat(e.max_length):"策略".concat(e.strategy_name,"类型为int，范围为").concat(e.min," ~ ").concat(e.max)},checkString:function(e,t){return e.length<=t},checkBool:function(e){return"true"==e||"false"==e},checkInt:function(e,t,a){var r=parseInt(e),s=parseInt(a),n=parseInt(t);return r>=n&&r<=s}}},wr=vr,kr=Object(h["a"])(wr,yr,gr,!1,null,null,null),Sr=kr.exports,Ir=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticStyle:{margin:"0 20px"}},[a("el-card",{staticClass:"box-card"},[a("p",[a("strong",[e._v("实验类型：")]),e._v(" "+e._s(e.layerTypeName)+" ")])]),a("el-card",{staticClass:"box-card",staticStyle:{"margin-top":"20px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("strong",[e._v("实验基本信息")])]),a("p",[a("strong",[e._v("实验名称：")]),e._v(" "+e._s(e.previewData.exp_layer_name)+" ")]),a("p",[a("strong",[e._v("实验描述：")]),e._v(" "+e._s(e.previewData.exp_layer_comment)+" ")]),1==e.previewData.is_same_type?a("p",[a("strong",[e._v("流量A/B分桶类型：")]),e._v(" "+e._s(e.allocTypeName)+" ")]):e._e(),0==e.previewData.exp_layer_type?[a("p",[a("strong",[e._v("流量团圈定：")]),e._v(" "+e._s(0==e.previewData.alloc_condition_enable?"不启用":"")+" ")]),1==e.previewData.alloc_condition_enable?a("el-card",{staticClass:"box-card"},[e._l(e.allocCondition,(function(t){return[a("p",[a("strong",[e._v(e._s(t.name)+" :")]),e._v(" "+e._s(t.data)+" ")])]}))],2):e._e()]:e._e(),1==e.previewData.exp_layer_type&&1==e.previewData.is_same_type?[a("p",[a("strong",[e._v("预算分桶实验：")]),e._v(" "+e._s(e.previewData.is_divide_budget?"是":"否")+" ")]),a("p",[a("strong",[e._v("实验对象类型：")]),e._v(" "+e._s(e.custObjTypeName)+" ")]),a("p",[a("strong",[e._v("实验对象：")]),e._v(" "+e._s(e.custExpObj)+" ")])]:e._e(),1==e.previewData.exp_layer_type&&0==e.previewData.is_same_type?[a("p",[a("strong",[e._v("实验对象类型：")]),e._v(" "+e._s(e.custObjTypeName)+" ")])]:e._e()],2),a("el-card",{staticClass:"box-card",staticStyle:{"margin-top":"20px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("strong",[e._v("子实验分桶设置")])]),e._l(e.expList,(function(t,r){return[a("el-card",{key:r,staticClass:"box-card"},[a("p",[a("strong",[e._v("子实验 :")]),e._v(" "+e._s(t.exp_title)+" ")]),a("p",[a("strong",[e._v("子实验描述 :")]),e._v(" "+e._s(t.exp_comment)+" ")]),1==e.previewData.is_same_type?a("p",[a("strong",[e._v("流量权重 :")]),e._v(" "+e._s(t.traffic_weight)+" ")]):e._e(),1==e.previewData.is_same_type?a("p",[a("strong",[e._v("用户白名单 :")]),e._v(" "+e._s(t.white_list_uid)+" ")]):e._e(),0==e.previewData.is_same_type?a("p",[a("strong",[e._v("实验对象 :")]),e._v(" "+e._s(t.white_list_uid)+" ")]):e._e(),a("p",[a("strong",[e._v("策略 :")])]),a("ul",e._l(t.exp_strategy_content,(function(t,r){return a("li",[a("span",{staticClass:"green-font"},[e._v(e._s(r)+":")]),e._v(" "+e._s(t)+" ")])})),0)])]}))],2)],1)},Lr=[],$r={props:["previewData"],data:function(){return{allocCondition:{},expList:[]}},computed:{custObjTypeName:function(){return 1==this.previewData.exp_layer_type&&1==this.previewData.is_same_type?xr.a.CustObjectTypeMap[this.previewData.exp_object_type]:1==this.previewData.exp_layer_type&&0==this.previewData.is_same_type?xr.a.CustObjectTypeMap[this.previewData.alloc_type_code+""]:""},custExpObj:function(){if(1==this.previewData.exp_layer_type&&1==this.previewData.is_same_type){var e=Object.keys(this.previewData.alloc_condition_value)[0];return this.previewData.alloc_condition_value[e]}return""},allocTypeName:function(){return xr.a.AllocTypeMap[this.previewData.alloc_type_code]},layerTypeName:function(){return 0==this.previewData.exp_layer_type?"流量侧":1==this.previewData.exp_layer_type&&1==this.previewData.is_same_type?"广告主侧 - 同质":1==this.previewData.exp_layer_type&&0==this.previewData.is_same_type?"广告主侧 - 非同质":"流量侧"},showJsonStr:function(){return JSON.stringify(this.previewData)}},methods:{reload:function(){this.expList=this.previewData.data,0==this.previewData.exp_layer_type&&(this.allocCondition=this.$tool.foramatAllocCondition(this.previewData.alloc_condition_value))}}},Dr=$r,Cr=Object(h["a"])(Dr,Ir,Lr,!1,null,null,null),Er=Cr.exports;function Tr(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Or(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Tr(Object(a),!0).forEach((function(t){Object(xa["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Tr(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var jr={data:function(){return{stepIndex:0,showNextStep:!1,showPrevStep:!1,showPreview:!1,disableSubmit:!1,previewDrawer:!1,checkMsgList:[],postData:{},assignAuditor:[]}},components:{SelectExpType:$a,SelectStrategySet:ja,ExpBaseInfo:Ja,CustExpBaseInfo:sr,CustExp2BaseInfo:ur,SetExp:mr,SetExpTwo:Sr,ExpPreview:Er,AddAuditor:Ze},beforeDestroy:function(){this.$store.commit("setStrategySetId",0)},computed:Or({},Object(va["c"])({layerType:function(e){return e.create_exp.exp_layer_type},sameType:function(e){return e.create_exp.is_same_type},strategySetId:function(e){return e.create_exp.strategy_set_id},expZoneCode:function(e){return e.create_exp.exp_zone_code}}),{refName:function(){return 1==this.stepIndex?"strategyset":2==this.stepIndex?"expbaseinfo":3==this.stepIndex?"setexp":void 0}}),watch:{stepIndex:function(){0==this.stepIndex&&(this.showNextStep=this.showPrevStep=!1,this.showPreview=!1),1==this.stepIndex&&(this.showPrevStep=!0,this.showNextStep=!0,this.showPreview=!1),2==this.stepIndex&&(this.showPrevStep=this.showNextStep=!0,this.showPreview=!1),3==this.stepIndex&&(this.showPreview=!0,this.showNextStep=!1,this.showPrevStep=!0)},strategySetId:function(){this.checkStrategySet(),this.$store.dispatch("clearExpInfo")}},mounted:function(){this.$route.query.from_exp_layer_id>0&&this.cloneExpLayer(this.$route.query.from_exp_layer_id)},methods:{cloneExpLayer:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a,r,s,n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.exp.getExpDetailByGo(t);case 2:a=e.sent,r=a.data.exp_list,r.forEach((function(e,t){r[t].tab_name=t+"",r[t].exp_id=0})),s=a.data.origin_exp_layer,this.$store.commit("clearData"),this.$store.commit("setExpZoneCode",s.exp_zone_code),this.$store.commit("setExpLayerType",s.exp_layer_type),this.$store.commit("setSameType",s.is_same_type),this.$store.commit("setStrategySetId",s.strategy_set_id),this.$set(this,"stepIndex",1),setTimeout((function(){n.checkStrategySet(),setTimeout((function(){if(n.showNextStep){if(1==s.alloc_condition_enable){var e=n.$tool.unZipAlloCondtion(s.alloc_condition_value);Object.keys(e).length>0&&n.$store.commit("setFlowAlloConf",e)}n.$store.commit("setExpBaseInfo",{alloc_type_code:s.alloc_type_code,exp_layer_comment:s.exp_layer_comment,exp_layer_name:"",alloc_condition_enable:s.alloc_condition_enable,flow_type:0,traffic_weight:0}),n.$store.commit("setExpList",r),n.$set(n,"stepIndex",2)}}),1e3)}),1e3);case 13:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),nextStep:function(){if(2==this.stepIndex){var e=this.$refs[this.refName].checkInputData();if(this.checkMsgList=e,e.length>0)return this.$message(e.join("、")),void window.scrollTo(0,0)}this.stepIndex=this.stepIndex+1,window.scrollTo(0,0)},checkStrategySet:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.showNextStep=!1,void 0!=this.$refs[this.refName]){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,this.$refs[this.refName].checkInputData();case 5:t=e.sent,this.checkMsgList=t,t.length<1&&(this.showNextStep=!0);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),prevStep:function(){this.stepIndex=this.stepIndex-1<0?0:this.stepIndex-1,this.checkMsgList=[],window.scrollTo(0,0)},getLayerPostParam:function(){var e=this.$store.state.create_exp.exp_base_info;if(e.strategy_set_id=this.$store.state.create_exp.strategy_set_id,e.is_same_type=this.$store.state.create_exp.is_same_type,e.alloc_condition_value={},e.alloc_condition_code=[],1==e.alloc_condition_enable){var t=this.$tool.zipAllocCondition(this.$store.state.create_exp.flow_alloc_conf);e.alloc_condition_value=t,e.alloc_condition_code=Object.keys(t)}return e.data=this.$store.state.create_exp.exp_list,e.exp_layer_type=this.$store.state.create_exp.exp_layer_type,e},showPreviewDrawer:function(){var e=this,t=this.$refs[this.refName].checkInputData();if(this.checkMsgList=t,t.length>0)return this.$message(t.join("、")),void window.scroll(0,0);this.previewDrawer=!0,0==this.layerType?this.$set(this,"postData",this.getLayerPostParam()):this.$set(this,"postData",this.getCustLayerPostParam()),setTimeout((function(){e.$refs["preview"].reload()}),100)},getCustLayerPostParam:function(){var e=this.$store.state.create_exp.exp_base_info;return e.strategy_set_id=this.$store.state.create_exp.strategy_set_id,e.is_same_type=this.$store.state.create_exp.is_same_type,e.data=this.$store.state.create_exp.exp_list,e.exp_layer_type=this.$store.state.create_exp.exp_layer_type,0==e.is_same_type?(e.alloc_condition_enable=0,e.alloc_condition_value={}):1==e.is_same_type&&(e.alloc_condition_enable=1,e.alloc_condition_value={},e.alloc_condition_value[e.exp_object_type]=e.exp_object),e},toSubmit:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(this.assignAuditor.length<1)){e.next=3;break}return this.$message("请指定审核人"),e.abrupt("return");case 3:if(this.postData.assign_auditor=this.assignAuditor,this.postData.flow_type=0,e.prev=5,this.disableSubmit=!0,t={},0!=this.layerType){e.next=14;break}return e.next=11,this.$api.exp.create(this.postData);case 11:t=e.sent,e.next=17;break;case 14:return e.next=16,this.$api.exp.createCustomerExp(this.postData);case 16:t=e.sent;case 17:0==t.errcode?(this.$alert(t.errmsg||"创建成功","提示",{confirmButtonText:"确定",callback:function(e){a.$router.push({path:"/lab/list"})}}),this.$store.dispatch("clearExpInfo")):(this.disableSubmit=!1,this.$message({type:"error",message:t.errmsg})),e.next=24;break;case 20:e.prev=20,e.t0=e["catch"](5),this.$message({type:"error",message:e.t0.message||"请刷新页面重试"}),this.disableSubmit=!1;case 24:case"end":return e.stop()}}),e,this,[[5,20]])})));function t(){return e.apply(this,arguments)}return t}()}},Rr=jr,qr=(a("4291"),Object(h["a"])(Rr,ga,ba,!1,null,null,null)),Ar=qr.exports,Mr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{offset:2,span:20}},[a("el-form",{attrs:{"label-position":"right","label-width":"180px",model:e.layerInfo}},[a("el-form-item",{attrs:{label:"所属产品线(实验区)："}},[e._v(e._s(e.formate.product_chinese_name)+" | "+e._s(e.formate.exp_zone_chinese_name))]),a("el-form-item",{attrs:{label:"实验策略："}},[e._v(e._s(e.strategySet.strategy_set_name))]),e.showDomainInput?a("el-form-item",{attrs:{label:"划分实验域流量占比："}},[a("el-slider",{attrs:{min:0,max:e.restTrafficWeight,step:10},model:{value:e.formate.traffic_weight,callback:function(t){e.$set(e.formate,"traffic_weight",t)},expression:"formate.traffic_weight"}}),a("p",[e._v(" 本实验使用流量： "),a("el-tag",[e._v(e._s(e.formate.traffic_weight))]),e._v("，其他域已用流量： "),a("el-tag",{attrs:{type:"warning"}},[e._v(e._s(1e3-e.restTrafficWeight))]),e._v("，剩余： "),a("el-tag",{attrs:{type:"success"}},[e._v(e._s(e.restTrafficWeight-e.formate.traffic_weight))])],1)],1):e._e(),a("el-form-item",{attrs:{label:"实验层名称："}},[e._v(e._s(e.layerInfo.exp_layer_name))]),a("el-form-item",{attrs:{label:"实验描述："}},[a("el-input",{attrs:{type:"textarea",rows:"6",placeholder:"【请填写实验的预期目标，实验的设计方案，实验的放量计划，实验关心的核心指标等】"},model:{value:e.layerInfo.exp_layer_comment,callback:function(t){e.$set(e.layerInfo,"exp_layer_comment",t)},expression:"layerInfo.exp_layer_comment"}})],1),a("el-form-item",{attrs:{label:"流量A/B分桶类型："}},[e._v(e._s(e.formate.alloc_type_name))]),a("el-form-item",{attrs:{label:"流量团圈定："}},[e.formate.is_online_ever&&0==e.layerInfo.alloc_condition_enable?[e._v("不启用")]:e._e(),e.formate.is_online_ever?e._e():[a("el-radio",{attrs:{label:0},model:{value:e.layerInfo.alloc_condition_enable,callback:function(t){e.$set(e.layerInfo,"alloc_condition_enable",t)},expression:"layerInfo.alloc_condition_enable"}},[e._v("不启用")]),a("el-radio",{attrs:{label:1},model:{value:e.layerInfo.alloc_condition_enable,callback:function(t){e.$set(e.layerInfo,"alloc_condition_enable",t)},expression:"layerInfo.alloc_condition_enable"}},[e._v("启用")])]],2)],1),e.formate.is_online_ever||1!=e.layerInfo.alloc_condition_enable?e._e():[a("el-card",{staticClass:"box-card"},[a("FlowAlloc")],1)],e.formate.is_online_ever&&1==e.layerInfo.alloc_condition_enable?[a("el-card",{staticClass:"box-card"},[e._l(e.layerInfo.alloc_condition_display,(function(t){return[a("p",[a("strong",[e._v(e._s(t.name)+" :")]),e._v(" "+e._s(t.data)+" ")])]}))],2)]:e._e()],2),e.showExpList?a("el-col",{attrs:{offset:2,span:20}},[a("SetExp",{ref:"setexp"})],1):e._e(),a("el-dialog",{attrs:{title:"选择审核人",visible:e.showDialogAuditor},on:{"update:visible":function(t){e.showDialogAuditor=t}}},[a("AddAuditor",{attrs:{expZoneCode:e.layerInfo.exp_zone_code},model:{value:e.assignAuditor,callback:function(t){e.assignAuditor=t},expression:"assignAuditor"}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.showDialogAuditor=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.hideFormAuditor}},[e._v("确 定")])],1)],1),a("el-col",{staticStyle:{"margin-top":"20px"},attrs:{align:"center"}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.layerInfo.exp_layer_status_code,expression:"layerInfo.exp_layer_status_code == 2"}],attrs:{type:"primary",disabled:e.isDisableSubmit},on:{click:e.toEditExp}},[e._v(e._s(e.isDisableSubmit?"正在提交中，请等待...":"修改实验"))]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:3==e.layerInfo.exp_layer_status_code,expression:"layerInfo.exp_layer_status_code == 3"}],attrs:{type:"primary",disabled:e.isDisableSubmit},on:{click:e.toEditExp}},[e._v(e._s(e.isDisableSubmit?"正在提交中，请等待...":"放量实验"))])],1),a("el-dialog",{attrs:{title:"[实验放量超20%审核]"+e.layerInfo.exp_layer_name,visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("p",{staticClass:"red-font h4"},[e._v("重要提醒：效果实验放量超20%需要leader邮件组一致审核通过！！！请确认你已经发送了邮件")]),a("el-form",{attrs:{"label-position":"top","label-width":"150px"}},[a("el-form-item",{attrs:{label:"发送时间"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期",format:"yyyy-MM-dd HH:mm","value-format":"yyyy-MM-dd HH:mm"},model:{value:e.mailInfo.time,callback:function(t){e.$set(e.mailInfo,"time",t)},expression:"mailInfo.time"}})],1),a("el-form-item",{attrs:{label:"邮件内容"}},[a("el-input",{attrs:{type:"textarea",rows:6},model:{value:e.mailInfo.content,callback:function(t){e.$set(e.mailInfo,"content",t)},expression:"mailInfo.content"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.comfirmFillMail}},[e._v("确 定")])],1)],1)],1)},Br=[],Pr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("modal",{attrs:{modalId:"auditFlow",modalSize:"modal-md"}},[r("template",{slot:"header"},[r("h4",{staticClass:"modal-title"},[e._v("实验放量审核流程示意图")])]),r("div",{staticClass:"text-left"},[r("p",{staticClass:"h4"},[r("a",{attrs:{href:"http://faraday.biz.weibo.com/wiki/3.7.html",target:"_blank"}},[e._v("实验放量审核流程wiki")])])]),r("div",{staticClass:"text-center"},[r("img",{attrs:{src:a("9559"),height:"440px"}})]),r("div",{staticClass:"text-left"},[r("p",{staticClass:"red-font h4"},[e._v(" 提醒：效果实验放量超20%，需通过leader邮件组审批！！！ ")])]),r("p",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"blue-font"},[e._v(" 管理员列表："+e._s(e.adminList.join("、"))+" ")])],2)],1)},Qr=[],Ur={data:function(){return{adminList:[]}},mounted:function(){},methods:{getAdminList:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.user.queryUserByGo("",4);case 2:t=e.sent,this.adminList=ve.a.map(t.data,"user_name");case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},Nr=Ur,zr=Object(h["a"])(Nr,Pr,Qr,!1,null,null,null),Hr=zr.exports,Fr={data:function(){return{expLayerId:0,layerInfo:{exp_zone_code:""},formate:{},strategySet:{},restTrafficWeight:1e3,showExpList:!1,showCondition:!1,isDisableSubmit:!1,mailInfo:{},mailSubject:"",showDialogAuditor:!1,assignAuditor:[],dialogFormVisible:!1}},computed:{showDomainInput:function(){return 78301==this.layerInfo.exp_zone_code}},components:{FlowAlloc:Va,SetExp:mr,VolumeAuditFlow:Hr,AddAuditor:Ze},mounted:function(){this.$route.query.exp_layer_id>0?this.expLayerId=this.$route.query.exp_layer_id:this.$router.push({path:"/"}),this.getLayerInfo(),this.$store.dispatch("clearExpInfo"),this.$store.dispatch("clearDelExps")},methods:{getLayerInfo:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.exp.getExpDetailByGo(this.expLayerId);case 2:if(t=e.sent,this.layerInfo=t.data.origin_exp_layer,this.formate=t.data.format,this.strategySet=t.data.strategy_set,2==this.layerInfo.exp_layer_status_code||3==this.layerInfo.exp_layer_status_code){e.next=10;break}return this.$message({message:"该实验暂时不能编辑",type:"error"}),this.$router.push({path:"/lab/detail",query:{exp_layer_id:this.expLayerId}}),e.abrupt("return");case 10:this.$store.commit("setStrategySetId",this.layerInfo.strategy_set_id),a=t.data.exp_list.filter((function(e){return e.exp_type_code>0})),a.forEach((function(e,t){a[t].tab_name=t+""})),this.$store.commit("setExpList",a),this.showExpList=!0,this.setAlloCondtion(),this.showCondition=!0,this.getRestDomain();case 18:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getRestDomain:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.showDomainInput){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.$api.strategy.getStrategyExpStat(this.layerInfo.strategy_set_id);case 4:t=e.sent,this.restTrafficWeight=1e3-(t.data.use_traffic-this.formate.traffic_weight);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),setAlloCondtion:function(){var e=JSON.parse(this.layerInfo.alloc_condition_value),t=this.$tool.unZipAlloCondtion(e);Object.keys(t).length<1||(t=this.$lodash.merge(this.$store.state.create_exp.flow_alloc_conf,t),this.layerInfo.alloc_condition_display=this.$tool.getAllocConfDisplayData(this.layerInfo.alloc_condition_value),this.$store.commit("setFlowAlloConf",t))},getUpdateParam:function(){var e={exp_layer_comment:this.layerInfo.exp_layer_comment,traffic_weight:this.formate.traffic_weight,data:this.$store.state.create_exp.exp_list,assign_auditor:this.assignAuditor,flow_type:0};if(this.$store.state.create_exp.del_exp_list.length>0&&this.$store.state.create_exp.del_exp_list.forEach((function(t){e.data.push(t)})),this.layerInfo.is_online_ever)return e;if(e.alloc_condition_value={},e.alloc_condition_code=[],e.alloc_condition_enable=this.layerInfo.alloc_condition_enable,1==e.alloc_condition_enable){var t=this.$tool.zipAllocCondition(this.$store.state.create_exp.flow_alloc_conf);e.alloc_condition_value=t,e.alloc_condition_code=Object.keys(t)}return e},hideFormAuditor:function(){this.assignAuditor.length<1?this.$message("请指定审核人"):(this.showDialogAuditor=!1,this.toEditExp())},toEditExp:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(this.assignAuditor.length<1)){e.next=3;break}return this.showDialogAuditor=!0,e.abrupt("return");case 3:if(t=this.getUpdateParam(),t.exp_layer_id=parseInt(this.$route.query.exp_layer_id),t.mail_info=this.mailInfo,3==this.layerInfo.exp_layer_status_code?"放量成功":"修改成功",!this.isDisableSubmit){e.next=9;break}return e.abrupt("return",!1);case 9:return this.isDisableSubmit=!0,e.prev=10,e.next=13,this.$api.exp.updateByGo(t);case 13:a=e.sent,0==a.errcode?this.$message({message:a.errmsg,duration:1e3,onClose:function(){r.$router.push({path:"/lab/detail",query:{exp_layer_id:r.$route.query.exp_layer_id}})}}):3==a.errcode?(this.isDisableSubmit=!1,this.showMailAlert()):(this.isDisableSubmit=!1,this.$message(a.errmsg),this.mailInfo={}),e.next=20;break;case 17:e.prev=17,e.t0=e["catch"](10),this.$message(e.t0.message||"请刷新页面重试");case 20:case"end":return e.stop()}}),e,this,[[10,17]])})));function t(){return e.apply(this,arguments)}return t}(),showMailAlert:function(){this.dialogFormVisible=!0},comfirmFillMail:function(e){this.dialogFormVisible=!1,this.toEditExp()}}},Vr=Fr,Gr=Object(h["a"])(Vr,Mr,Br,!1,null,null,null),Wr=Gr.exports,Zr=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("mytable",{attrs:{listData:e.listData}})],1)},Kr=[],Yr={components:{mytable:at["a"]},data:function(){return{listData:[]}},mounted:function(){this.getListData()},methods:{getListData:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={},e.next=3,this.$api.exp.getLayerListByGo("my_audit");case 3:t=e.sent,this.$set(this,"listData",t.data);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},Jr=Yr,Xr=Object(h["a"])(Jr,Zr,Kr,!1,null,null,null),es=Xr.exports,ts=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-tabs",{attrs:{type:"border-card"},model:{value:e.listType,callback:function(t){e.listType=t},expression:"listType"}},[a("el-tab-pane",{attrs:{label:"我的实验",name:"mine"}}),a("el-tab-pane",{attrs:{label:"放量实验",name:"volume"}}),a("el-tab-pane",{attrs:{label:"已结束实验",name:"finish"}}),a("el-tab-pane",{attrs:{label:"所有",name:"all"}}),a("el-row",[a("el-col",{attrs:{span:9}},[a("el-form",{ref:"form"},[a("el-form-item",[a("el-input",{attrs:{placeholder:"输入策略、描述或创建人，自动检索"},on:{input:e.searchLayerList},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}})],1)],1)],1),a("el-col",{attrs:{span:2,offset:13}},[a("el-button",{attrs:{id:"export",type:"warning",icon:"el-icon-upload"},on:{click:e.exportLayerList}},[e._v("导出")])],1)],1),a("ExpTable",{attrs:{listData:"all"==e.listType||"finish"==e.listType?e.listData:e.showDatas}}),"all"!=e.listType&&"finish"!=e.listType||""!=e.keyword?e._e():a("el-pagination",{staticStyle:{"margin-top":"20px"},attrs:{"current-page":e.page,layout:"total, prev, pager, next",total:e.total,"page-size":20,"hide-on-single-page":!0,align:"center",background:""},on:{"current-change":e.getAllListData,"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t}}})],1)],1)},as=[],rs=a("c601"),ss=rs["a"],ns=Object(h["a"])(ss,ts,as,!1,null,null,null),is=ns.exports,os=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{directives:[{name:"show",rawName:"v-show",value:e.layer.show_add_user_tip,expression:"layer.show_add_user_tip"}],attrs:{span:20,offset:2}},[a("el-alert",{attrs:{type:"warning",closable:!1}},[a("p",{staticStyle:{"font-size":"14px"}},[e._v(" 想拥有该实验的放量权限，请联系实验创建者 "),a("strong",{staticClass:"red-font"},[e._v(e._s(e.layer.creator))]),e._v("为你添加协作者身份 ")])])],1),a("el-col",{attrs:{align:"center"}},[a("OptBtn",{attrs:{layerId:e.$route.query.exp_layer_id,layerInfo:e.layer},on:{toPushAll:e.toPushAll}})],1),Object.keys(e.grayIpInfo).length>0?a("el-col",{staticStyle:{"margin-top":"20px"},attrs:{span:16,offset:4}},[a("el-card",{staticClass:"box-card",staticStyle:{background:"rgb(250, 236, 216)"}},[a("p",[a("strong",[e._v("单台机器灰度中")])]),a("p",[a("strong",[e._v("灰度机器IP：")]),e._v(" "+e._s(e.grayIpInfo.ip)+" ")]),a("p",{class:e.grayIpInfo.running_status_cls},[a("strong",[e._v("运行状态：")]),e._v(" "+e._s(e.grayIpInfo.running_status_text)+" ")]),-1==e.grayIpInfo.running_status?[a("p",{class:e.grayIpInfo.running_status_cls},[a("strong",[e._v("该机器上fisher进程检查失败，检查脚本如下:")])]),a("code",[e._v('#!/bin/bash\\nsudo netstat -anpt | grep \\":9999\\" | wc -l')]),a("p",[e._v("检查结果为："+e._s(e.grayIpInfo.health_state.log||"null"))])]:e._e()],2)],1):e._e(),a("el-col",{staticStyle:{"margin-top":"20px"},attrs:{span:20,offset:2}},[a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("strong",{staticStyle:{color:"#d04925","font-size":"23px"}},[e._v(e._s(e.layer.exp_layer_name))]),e._v(" (ID："+e._s(e.layer.exp_layer_id)+") "),a("span",{staticStyle:{display:"inline-block",float:"right"}},[a("el-button",{attrs:{type:"text"},on:{click:e.showUpdateRecord}},[e._v("变更记录")]),a("el-divider",{attrs:{direction:"vertical"}}),a("el-button",{staticStyle:{"font-size":"18px"},attrs:{type:"text"},on:{click:e.toExpStat}},[e._v("实验检验")]),a("el-divider",{attrs:{direction:"vertical"}}),1==e.layer.is_same_type?a("router-link",{attrs:{to:{path:"/lab/create_exp_step",query:{from_exp_layer_id:e.layer.exp_layer_id}}}},[e._v("克隆")]):e._e()],1)]),a("el-form",{attrs:{"label-width":"120px"}},[a("el-form-item",{staticStyle:{"margin-bottom":"2px"},attrs:{label:"状态："}},[a("span",{staticStyle:{"font-size":"20px",color:"red"}},[e._v(e._s(e.formateInfo.status_text))])]),a("el-form-item",{staticStyle:{"margin-bottom":"2px"},attrs:{label:"产品线："}},[e._v(e._s(e.formateInfo.product_chinese_name)+" | "+e._s(e.formateInfo.exp_zone_chinese_name))]),a("el-form-item",{staticStyle:{"margin-bottom":"2px"},attrs:{label:"作用策略："}},[a("router-link",{staticStyle:{"font-size":"20px"},attrs:{to:{path:"/strategy/detail",query:{strategy_set_id:e.layer.strategy_set_id}}}},[a("strong",[e._v(e._s(e.strategySet.strategy_set_name))])])],1),a("el-form-item",{staticStyle:{"margin-bottom":"2px"},attrs:{label:"创建人："}},[e._v(" "+e._s(e.layer.creator)+" "),a("span",{staticStyle:{color:"grey"}},[e._v("（创建于："+e._s(e.layer.create_time)+"， 更新于："+e._s(e.layer.update_time)+"）")])]),a("el-form-item",{staticStyle:{"margin-bottom":"2px"},attrs:{label:"审核人："}},[e._v(e._s(""!=e.layer.assign_auditor?e.layer.assign_auditor:"无"))]),a("el-form-item",{staticStyle:{"margin-bottom":"2px"},attrs:{label:"协作人："}},[e._v(" "+e._s(""!=e.layer.access_user?e.layer.access_user:"暂无")+" "),a("el-button",{attrs:{type:"warning",size:"small"},on:{click:e.toAddUser}},[a("i",{staticClass:"el-icon-plus"}),e._v("添加 ")])],1),a("el-form-item",{staticStyle:{"margin-bottom":"2px"},attrs:{label:"属性："}},[a("el-tag",{attrs:{type:"primary"}},[e._v(e._s(e.layer.exp_layer_type_name))]),a("el-tag",{attrs:{type:"success"}},[e._v(e._s(e.layer.is_same_type_name))]),e.formateInfo.is_divide_budget?a("el-tag",{attrs:{type:"info"}},[e._v("预算分配实验")]):e._e()],1),0==e.layer.is_same_type?a("el-form-item",{staticStyle:{"margin-bottom":"2px"},attrs:{label:"实验对象类型："}},[e._v(e._s(e.formateInfo.alloc_type_name))]):e._e()],1),a("el-collapse",[a("el-collapse-item",{attrs:{name:"1"}},[a("template",{slot:"title"},[a("strong",{staticStyle:{"font-size":"16px"}},[e._v("实验描述")]),a("i",{staticClass:"header-icon el-icon-info"})]),a("div",{domProps:{innerHTML:e._s(e.layer.exp_layer_comment.replace(/\n/g,"<br>"))}})],2)],1)],1),0!=e.layer.is_same_type?a("el-card",{staticClass:"box-card",staticStyle:{"margin-top":"20px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("strong",{staticStyle:{"font-size":"21px"}},[e._v("流量团圈定")])]),a("p",[a("strong",[e._v("流量区域：")]),e._v(" "+e._s(1==e.layer.flow_type?"灰度流量":"全部流量")+" ")]),a("p",[a("strong",[e._v("流量分配类型：")]),e._v(" "+e._s(e.formateInfo.alloc_type_name)+" ")]),0==e.layer.exp_layer_type?a("p",[a("strong",[e._v("流量分配条件:")]),0==e.layer.alloc_condition_enable?[e._v("禁用")]:e._e()],2):e._e(),1==e.layer.exp_layer_type?a("p",[a("strong",[e._v("实验对象:")])]):e._e(),1==e.layer.alloc_condition_enable?a("el-card",{staticClass:"box-card"},[e._l(e.allocConfDisplay,(function(t,r){return[a("p",{key:r},[a("strong",[e._v(e._s(t.name)+"：")]),e._v(" "+e._s(t.data)+" ")])]}))],2):e._e()],1):e._e(),a("el-card",{staticClass:"box-card",staticStyle:{"margin-top":"10px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("strong",{staticStyle:{color:"#d04925","font-size":"23px"}},[e._v("实验配置：")])]),a("el-table",{ref:"tab",staticStyle:{width:"100%"},attrs:{data:e.expList,border:"",height:"600px"}},[a("el-table-column",{attrs:{label:"实验id",width:"180",fixed:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("layer-"+e._s(e.layer.exp_layer_id)+"#exp-"+e._s(t.row.exp_id))]}}])}),a("el-table-column",{attrs:{prop:"exp_title",label:"标题",width:"220",fixed:"left"}}),a("el-table-column",{attrs:{prop:"traffic_weight",label:"流量权重",width:"100"}}),a("el-table-column",{attrs:{prop:"traffic_weight",label:1==e.layer.is_same_type?"用户白名单":"实验对象",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",{staticClass:"p-break"},[e._v(e._s(t.row.white_list_uid))])]}}])}),e._l(e.layer.expListStrategyKey,(function(t){return[a("el-table-column",{attrs:{label:"策略："+t,width:"400"},scopedSlots:e._u([{key:"default",fn:function(r){return[a("p",{staticClass:"p-break",class:r.row.exp_strategy_content[t]==e.base[t]?"":e.diffFont},[e._v(e._s(r.row.exp_strategy_content[t]||""))])]}}],null,!0)})]}))],2)],1),a("el-card",{staticClass:"box-card",staticStyle:{"margin-top":"10px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("放量邮件申请记录")])]),a("VolumeApplyList",{ref:"VolumeApplyList",attrs:{expLayerId:e.$route.query.exp_layer_id,strategySetId:e.layer.strategy_set_id}})],1)],1),a("el-dialog",{attrs:{title:"填写申请全量信息",visible:e.showApplyFullForm},on:{"update:visible":function(t){e.showApplyFullForm=t}}},[a("p",{staticClass:"red-font"},[e._v("重要提醒：效果实验放量超20%需要leader邮件组一致审核通过！！！请确认你已经发送了邮件")]),a("el-form",{attrs:{"label-position":"top","label-width":"150px"}},[a("el-form-item",{attrs:{label:"选择实验效果满意的子实验:"}},[a("el-radio-group",{model:{value:e.pushAllExpId,callback:function(t){e.pushAllExpId=t},expression:"pushAllExpId"}},[e._l(e.expList,(function(t){return[1==t.exp_type_code&&"基准nodiff实验"!=t.exp_title?a("el-radio",{attrs:{label:t.exp_id}},[e._v(e._s(t.exp_title)+"【layer-"+e._s(e.layer.exp_layer_id)+"#exp-"+e._s(t.exp_id))]):e._e()]}))],2)],1),a("el-form-item",{attrs:{label:"邮件发送时间:"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期",format:"yyyy-MM-dd HH:mm","value-format":"yyyy-MM-dd HH:mm"},model:{value:e.mailInfo.time,callback:function(t){e.$set(e.mailInfo,"time",t)},expression:"mailInfo.time"}})],1),a("el-form-item",{attrs:{label:"邮件内容:"}},[a("el-input",{attrs:{type:"textarea",rows:6},model:{value:e.mailInfo.content,callback:function(t){e.$set(e.mailInfo,"content",t)},expression:"mailInfo.content"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.showApplyFullForm=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.applyPushAll}},[e._v("确 定")])],1)],1),a("el-drawer",{attrs:{title:"实验变更记录",visible:e.showRecord,size:"80%","custom-class":"drawerscroll"},on:{"update:visible":function(t){e.showRecord=t}}},[a("el-row",{staticStyle:{overflow:"scroll"},style:{height:e.drawerHeight}},[a("ExpUpdateRecord",{ref:"record",attrs:{layerId:e.layer.exp_layer_id,strategySetName:e.layer.strategy_set_name,strategys:e.layer.expListStrategyKey}})],1)],1),a("el-col",{staticStyle:{"margin-top":"20px"},attrs:{align:"center"}},[a("OptBtn",{attrs:{layerId:e.$route.query.exp_layer_id,layerInfo:e.layer},on:{toPushAll:e.toPushAll}})],1)],1)},ls=[],cs=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"btn-group"},[e._l(e.quotaList,(function(t){return[a("button",{staticClass:"btn btn-default",class:!0===e.selectQuotaList[t.quota_id]?"btn-info":"",attrs:{type:"button"},on:{click:function(a){return e.selectQuota(t)},mouseover:function(a){return e.showQuotaDetail(t,a)}}},[e._v(" "+e._s(t.quota_text))])]}))],2)])},us=[],ps=(a("a9e3"),{props:{expLayerType:String,selectQuotaIds:Array,expZoneCode:Number},data:function(){return{quotaList:[],selectQuotaList:{},isSelect:!1}},watch:{selectQuotaIds:{handler:function(e,t){this.isSelect||(this.initSelectQuota(e),this.isSelect=!0)}},expZoneCode:{handler:function(){this.initQuotaList()}}},updated:function(){var e=this,t=[];Object.keys(this.selectQuotaList).forEach((function(a,r){1==e.selectQuotaList[a]&&t.push(a)})),this.$emit("changeExpQuota",t)},mounted:function(){this.initQuotaList(),void 0!=this.selectQuotaIds&&this.selectQuotaIds.length>0&&this.initSelectQuota(this.selectQuotaIds)},methods:{initSelectQuota:function(e){var t=this;e.forEach((function(e,a){t.$set(t.selectQuotaList,e,!0)}))},initQuotaList:function(){"traffic"==this.expLayerType?this.getTrafficQuotaList():"customer"==this.expLayerType&&this.getCustomerQuotaList()},selectQuota:function(e){void 0!=this.selectQuotaList[e.quota_id]?this.$set(this.selectQuotaList,e.quota_id,!this.selectQuotaList[e.quota_id]):this.$set(this.selectQuotaList,e.quota_id,!0)},getTrafficQuotaList:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.quota.getTrafficQuotas(this.expZoneCode);case 2:t=e.sent,this.quotaList=t.data;case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getCustomerQuotaList:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.quota.getCustomerQuotas(this.expZoneCode);case 2:t=e.sent,this.quotaList=t.data;case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),showQuotaDetail:function(e,t){}}}),_s=ps,ds=(a("c552"),Object(h["a"])(_s,cs,us,!1,null,"29d77ab0",null)),fs=(ds.exports,function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.applyList.length>0?a("div",{staticClass:"panel panel-info"},[a("table",{staticClass:"table table-bordered table-hover"},[e._m(0),a("tbody",[e._l(e.applyList,(function(t,r){return[void 0==e.expLayerId||e.expLayerId==t.layer.exp_layer_id?a("tr",{key:r},[a("td",[10==t.apply.apply_type?a("a",{attrs:{href:"javascript:;"}},[e._v(e._s(t.apply.id))]):e._e(),2==t.apply.apply_type?[e._v(e._s(t.apply.id))]:e._e()],2),a("td",[e._v(e._s(t.apply_type_text))]),a("td",[e._v(e._s(t.confirm_text))]),a("td",[e._v(e._s(t.apply.username))]),a("td",[e._v(e._s(t.apply.create_time))]),a("td",[e._v(e._s(t.apply.update_time))]),a("td",[e._v(e._s(t.apply.auditor))]),a("td",[e._v(e._s(t.apply.audit_reason))])]):e._e()]}))],2)]),a("modal",{attrs:{modalId:"confirmDetail"}},[a("template",{slot:"header"},[a("h4",{staticClass:"modal-title"},[e._v("确认详情")])]),a("ul",{staticClass:"list-group"},[e._l(e.confirmList.leader,(function(t,r){return[a("li",{staticClass:"list-group-item"},[e._v(" "+e._s(r+1)+". "),a("label",[e._v(e._s(t.assign_user))]),a("span",{staticClass:"label",class:t.as_status_cls},[e._v(e._s(t.as_status_text))]),t.show_expire?a("span",{staticClass:"label label-primary"},[e._v("将于"+e._s(t.expire_time)+"过期")]):e._e(),-1==t.as_status?a("span",{staticClass:"label label-danger"},[e._v("理由："+e._s(t.reply_content))]):e._e()])]}))],2)],2)],1):a("div",[e._v("暂无")])}),hs=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("thead",[a("tr",[a("td",[e._v("ID")]),a("td",[e._v("类型")]),a("td",[e._v("状态")]),a("td",[e._v("申请人")]),a("td",[e._v("创建时间")]),a("td",[e._v("更新时间")]),a("td",[e._v("操作人")]),a("td",[e._v("备注")])])])}],ms={props:["expLayerId","strategySetId"],data:function(){return{applyList:[],confirmList:{leader:[],exper:[]}}},methods:{getApplyList:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.strategy.getVolumeApplys(this.strategySetId);case 2:t=e.sent,null!=t.data?this.applyList=t.data:this.applyList=[];case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getConfirmList:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.exp.getConfirmListByApplyId(t);case 2:a=e.sent,$("#confirmDetail").modal("show"),this.confirmList=a.data;case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}},ys=ms,gs=Object(h["a"])(ys,fs,hs,!1,null,null,null),bs=gs.exports,xs=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-row",[a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.operateBtn.edit,expression:"operateBtn.edit"}],attrs:{type:"primary",disabled:e.operating},on:{click:e.toEditExp}},[e._v("实验编辑")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.operateBtn.audit_pass,expression:"operateBtn.audit_pass"}],attrs:{type:"success",disabled:e.operating},on:{click:function(t){return e.toUpOnlineExp(!1)}}},[e._v("审核上线")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.operateBtn.volume,expression:"operateBtn.volume"}],attrs:{type:"primary",disabled:e.operating},on:{click:e.toEditExp}},[e._v("实验放量")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.operateBtn.audit_refuse,expression:"operateBtn.audit_refuse"}],attrs:{type:"warning",disabled:e.operating},on:{click:function(t){return e.toRefuseExp(!1)}}},[e._v("驳回")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.operateBtn.do_full,expression:"operateBtn.do_full"}],attrs:{type:"danger",disabled:e.operating},on:{click:e.toDoFull}},[e._v("全量发布")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.operateBtn.cancel_full,expression:"operateBtn.cancel_full"}],attrs:{type:"info",disabled:e.operating},on:{click:e.toCancelFull}},[e._v("取消全量发布")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.operateBtn.offline,expression:"operateBtn.offline"}],attrs:{type:"danger",disabled:e.operating},on:{click:function(t){return e.toDelExp(!1)}}},[e._v("下线")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.operateBtn.apply_full_volume,expression:"operateBtn.apply_full_volume"}],attrs:{type:"danger",disabled:e.operating},on:{click:function(t){return e.clickTo("toPushAll")}}},[e._v("一键全量")])],1),e.operateBtn.show_volume_full_tip?a("el-row",{staticStyle:{"margin-top":"10px"}},[a("el-col",{attrs:{span:14,offset:5}},[a("el-alert",{attrs:{type:"warning",closable:!1,center:"","show-icon":"",effect:"dark"}},[e._v("该实验策略有推全申请，故该实验暂时不能放量，请等待推全结果")])],1)],1):e._e()],1)},vs=[],ws={props:["layerId","layerInfo"],data:function(){return{operateBtn:{edit:!1,audit_pass:!1,volume:!1,audit_refuse:!1,offline:!1,clone:!1,re_up_online:!1,apply_full_volume:!1,do_full:!1,cancel_full:!1,add_user:!1,show_volume_full_tip:!1},operating:!1}},watch:{layerId:function(){this.getBtns()}},mounted:function(){this.getBtns()},methods:{getBtns:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.exp.getExpBtnByGo(this.layerId);case 2:t=e.sent,this.operateBtn=t.data;case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),toEditExp:function(){1==this.layerInfo.exp_layer_type?this.$router.push({path:"/lab/custom_exp_edit",query:{exp_layer_id:this.layerId}}):this.$router.push({path:"/lab/edit",query:{exp_layer_id:this.layerId}})},toRefuseExp:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!1!==t){e.next=3;break}return this.$confirm("确认驳回该实验?","驳回提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){r.toRefuseExp(!0)})).catch((function(){})),e.abrupt("return",!1);case 3:return this.operating=!0,e.next=6,this.$api.exp.auditRefuseByGo(this.layerId);case 6:a=e.sent,0==a.errcode?this.$message({message:"驳回成功",duration:500,onClose:function(){r.$tool.reload()}}):this.$message(a.errmsg||"驳回失败，请重试");case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),toDelExp:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!1!==t){e.next=3;break}return this.$confirm("确认下线该实验?","下线提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){r.toDelExp(!0)})).catch((function(){})),e.abrupt("return");case 3:return this.operating=!0,e.next=6,this.$api.exp.auditOfflineByGo(this.layerId);case 6:a=e.sent,0==a.errcode?this.$message({message:"下线成功",duration:500,type:"success",onClose:function(){r.$tool.reload()}}):this.$message(a.errmsg||"下线失败，请重试");case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),toUpOnlineExp:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!1!==t){e.next=3;break}return this.$confirm("确认上线该实验?","上线提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){r.toUpOnlineExp(!0)})).catch((function(){})),e.abrupt("return");case 3:return this.operating=!0,e.next=6,this.$api.exp.auditOnlineByGo(this.layerId);case 6:a=e.sent,0==a.errcode?this.$message({message:"上线成功",duration:500,type:"success",onClose:function(){r.$tool.reload()}}):this.$message(a.errmsg||"上线失败，请重试");case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),toDoFull:function(){var e=this;this.$confirm("确认进行全量上线么?","全量上线提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.doFull()})).catch((function(){}))},doFull:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.operating=!0,e.next=3,this.$api.exp.doPushAllByGo(this.layerId);case 3:t=e.sent,a=t.errmsg,0==t.errcode&&(a="推全成功"),this.$message({message:a,type:"success",duration:500,onClose:function(){r.$tool.reload()}});case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),toCancelFull:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.$confirm("确认取消全量上线么？取消后可再次申请","取消全量提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.cancelFull()})).catch((function(){}));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),cancelFull:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.operating=!0,e.next=3,this.$api.exp.cancelPushAllByGo(this.layerId);case 3:t=e.sent,a=t.errmsg,0==t.errcode&&(a="取消成功"),this.$message({message:a,type:"success",duration:500,onClose:function(){r.$tool.reload()}});case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),clickTo:function(e){this.$emit(e)}}},ks=ws,Ss=Object(h["a"])(ks,xs,vs,!1,null,null,null),Is=Ss.exports,Ls=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{offset:1,span:22}},[a("Timeline",{attrs:{data:e.records},scopedSlots:e._u([{key:"detail",fn:function(t){return["create"==t.record.record.action||"edit"==t.record.record.action||"volume"==t.record.record.action?a("ul",{staticClass:"detail"},[a("li",[a("span",{staticClass:"key"},[e._v("名 称")]),a("span",{staticClass:"val"},[e._v(e._s(t.record.exp_layer.exp_layer_name))])]),a("li",[a("span",{staticClass:"key"},[e._v("描 述")]),a("span",{staticClass:"val"},[e._v(e._s(t.record.exp_layer.exp_layer_comment))])]),a("li",[a("span",{staticClass:"key"},[e._v("创建人")]),a("span",{staticClass:"val"},[e._v(e._s(t.record.exp_layer.creator))])]),a("li",[a("span",{staticClass:"key"},[e._v("策略集")]),a("span",{staticClass:"val"},[e._v(e._s(e.strategySetName))])]),a("li",[a("span",{staticClass:"key"},[e._v("实验配置")]),a("span",{staticClass:"val"})]),a("section",{staticStyle:{overflow:"scroll"}},[a("table",{staticClass:"exps table table-striped table-bordered"},[a("thead",[a("tr",[a("th",[e._v("子实验id")]),a("th",[e._v("标题")]),a("th",[e._v("流量权重")]),a("th",[e._v("用户白名单")]),e._l(e.strategys,(function(t){return[a("th",[e._v("策略:"+e._s(t))])]}))],2)]),a("tbody",e._l(t.record.exp_list,(function(t){return a("tr",[a("td",[e._v("layer-"+e._s(t.exp_layer_id)+"#exp-"+e._s(t.exp_id))]),a("td",[e._v(e._s(t.exp_title))]),a("td",[e._v(e._s(t.traffic_weight))]),a("td",[e._v(e._s(t.white_list_uid))]),e._l(e.strategys,(function(r){return[a("td",[a("p",{staticClass:"p-break",class:JSON.parse(t.exp_strategy_content)[r]==e.base[r]?"":e.diffFont},[e._v(e._s(JSON.parse(t.exp_strategy_content)[r]))])])]}))],2)})),0)])])]):e._e(),"volume"==t.record.record.action?a("ul",{staticClass:"detail"},[a("li",[a("span",{staticClass:"key"},[e._v("流量变化：")])]),Object.keys(t.record.edit_log.update).length>0?a("el-table",{staticStyle:{width:"100%"},attrs:{data:Object.keys(t.record.edit_log.update).map((function(e){return t.record.edit_log.update[e]})),size:"mini",border:"",stripe:""}},[a("el-table-column",{attrs:{label:"子实验id"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("layer-"+e._s(t.row.exp_layer_id)+"#exp-"+e._s(t.row.exp_id))]}}],null,!0)}),a("el-table-column",{attrs:{prop:"exp_title",label:"标题"}}),a("el-table-column",{attrs:{label:"放量前流量权重"},scopedSlots:e._u([{key:"default",fn:function(r){return[a("span",{class:t.record.old_exp_list[r.row.exp_id].traffic_weight!=r.row.traffic_weight?"red-font":""},[e._v(e._s(t.record.old_exp_list[r.row.exp_id].traffic_weight))])]}}],null,!0)}),a("el-table-column",{attrs:{label:"放量后流量权重"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{class:t.row.traffic_weight_old!=t.row.traffic_weight?"red-font":""},[e._v(e._s(t.row.traffic_weight))])]}}],null,!0)})],1):e._e(),Object.keys(t.record.edit_log.add).length>0?a("el-table",{staticStyle:{width:"100%"},attrs:{data:Object.keys(t.record.edit_log.add).map((function(e){return t.record.edit_log.add[e]})),"show-header":!1,size:"mini",border:"",stripe:""}},[a("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(" layer-"+e._s(t.row.exp_layer_id)+"#exp-"+e._s(t.row.exp_id)+" "),a("b",{staticClass:"green-font"},[e._v("(新增)")])])]}}],null,!0)}),a("el-table-column",{attrs:{prop:"exp_title"}}),a("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"red-font"},[e._v(e._s("0"))])]}}],null,!0)}),a("el-table-column",{staticClass:"red-font",attrs:{prop:"traffic_weight"}})],1):e._e(),Object.keys(t.record.edit_log.delete).length>0?a("el-table",{staticStyle:{width:"100%"},attrs:{data:Object.keys(t.record.edit_log.delete).map((function(e){return t.record.edit_log.delete[e]})),"show-header":!1,size:"mini",border:"",stripe:""}},[a("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(t){return[a("s",[e._v(" layer-"+e._s(t.row.exp_layer_id)+"#exp-"+e._s(t.row.exp_id)+" "),a("b",{staticClass:"red-font"},[e._v("(删除)")])])]}}],null,!0)}),a("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(t){return[a("s",[e._v(e._s(t.row.exp_title))])]}}],null,!0)}),a("el-table-column",{staticClass:"red-font",attrs:{prop:"traffic_weight"}}),a("el-table-column",{scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticClass:"red-font"},[e._v(e._s("0"))])]}}],null,!0)})],1):e._e()],1):e._e()]}}])})],1)],1)},$s=[],Ds={props:["layerId","strategySetName","strategys"],data:function(){return{records:[],base:{},diffFont:"diff-font"}},watch:{layerId:function(){this.getUpdateRecord()}},mounted:function(){this.getUpdateRecord()},components:{Timeline:P},methods:{getUpdateRecord:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.exp.getExpsOperateListByGo(this.layerId);case 2:if(t=e.sent,0==t.errcode){e.next=5;break}return e.abrupt("return");case 5:if(null!=t.data){e.next=7;break}return e.abrupt("return");case 7:t.data.sort((function(e,t){return e.record.id>t.record.id?-1:1})),this.records=t.data,a=Object.keys(this.records[0].exp_list),this.base=JSON.parse(this.records[0].exp_list[a[0]].exp_strategy_content);case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},Cs=Ds,Es=(a("c3c1"),Object(h["a"])(Cs,Ls,$s,!1,null,"c322e6f8",null)),Ts=Es.exports,Os={data:function(){return{layer:{exp_layer_comment:""},selectQuotaId:[],expLayerId:null,grayIpInfo:{},pushAllExpId:"",mailInfo:{time:"",content:""},mailSubject:"",base:{},diffFont:"diff-font",showApplyFullForm:!1,showRecord:!1,strategySet:{},expList:[],formateInfo:{},allocConfDisplay:[],drawerHeight:"600px"}},components:{SingelDomainLayer:Te,FullVolumeConfirmList:ze,VolumeApplyList:bs,VolumeFullApplyList:Me,OptBtn:Is,ExpUpdateRecord:Ts},mounted:function(){this.$route.query.exp_layer_id>0?this.getExpLayerInfo(this.$route.query.exp_layer_id):this.$router.push({path:"/lab/mine"}),"open_record"==this.$route.query.action&&this.showUpdateRecord(),this.drawerHeight=document.documentElement.clientHeight-150+"px"},watch:{expList:function(){var e=this;this.$nextTick((function(){e.$refs.tab.doLayout()}))}},methods:{getExpGrayIpInfo:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.exp.getGrayIp(t);case 2:a=e.sent,this.grayIpInfo=a.data;case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),getExpLayerInfo:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a,r,s=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.exp.getExpDetailByGo(t);case 2:a=e.sent,r=a.data,this.layer=r.origin_exp_layer,this.strategySet=r.strategy_set,this.expList=r.exp_list,this.formateInfo=r.format,setTimeout((function(){s.$refs["VolumeApplyList"].getApplyList()}),100),1==this.layer.alloc_condition_enable&&0==this.layer.exp_layer_type&&(this.allocConfDisplay=this.$tool.getAllocConfDisplayData(this.layer.alloc_condition_value)),1==this.layer.alloc_condition_enable&&1==this.layer.exp_layer_type&&(this.allocConfDisplay=this.$tool.formateCustExpObject(this.layer)),this.layer.expListStrategyKey=Object.keys(this.expList[0].exp_strategy_content),this.$store.commit("setHeadBreadCrumb",this.layer.exp_layer_name),this.base=this.expList[0].exp_strategy_content,this.layer.exp_layer_type_name="流量侧实验",0==this.layer.access_user.indexOf(",")&&(this.layer.access_user=this.layer.access_user.substr(1)),""!=this.layer.access_user&&(this.layer.access_user=this.layer.access_user.replace(/\,/g,"、")),""!=this.layer.assign_auditor&&(this.layer.assign_auditor=this.layer.assign_auditor.replace(/\,/g,"、")),1==this.layer.exp_layer_type&&(this.layer.exp_layer_type_name="广告主侧实验"),this.layer.is_same_type>0?this.layer.is_same_type_name="同质性实验":this.layer.is_same_type_name="非同质性实验";case 20:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),domainClick:function(e){this.$tool.reload()},doApplyPusllAll:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.exp.applyPushAllByGo(this.pushAllExpId,this.mailInfo);case 2:t=e.sent,"",0==t.errcode?("申请完成，等待审核",this.showApplyFullForm=!1,this.$alert("申请成功",{confirmButtonText:"确定",callback:function(){a.$tool.reload()}})):(t.errmsg||"申请失败",this.showApplyFullForm=!0,this.$alert(t.errmsg||"申请失败",{confirmButtonText:"确定",callback:function(){a.$tool.reload()}}));case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),toPushAll:function(){this.showApplyFullForm=!0},applyPushAll:function(){""!=this.pushAllExpId?""!=this.mailInfo.time?""!=this.mailInfo.content?this.doApplyPusllAll():this.$message("请选择全量申请邮件发送内容"):this.$message("请选择全量申请邮件发送时间"):this.$message("请选择子实验")},showUpdateRecord:function(){this.showRecord=!0},toExpStat:function(){this.layer.is_same_type>0?this.$router.push({path:"/monitor/exp_data_stat",query:{exp_layer_id:this.layer.exp_layer_id}}):this.$router.push({path:"/monitor/cust_exp_data_stat",query:{exp_layer_id:this.layer.exp_layer_id}})},toAddUser:function(){var e=this;this.$prompt("请输入用户名","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputValidator:function(e){if(null==e||""==e)return"请输入用户名"}}).then((function(t){var a=t.value;e.addUser(a)})).catch((function(){e.$message({type:"info",message:"取消输入"})}))},addUser:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.exp.addUser(this.layer.exp_layer_id,t);case 2:if(a=e.sent,!(a.errcode<0)){e.next=6;break}return this.$message(a.errmsg),e.abrupt("return");case 6:this.$message({message:"添加成功",duration:500,onClose:function(){r.$tool.reload()}});case 7:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}},js=Os,Rs=(a("63ea"),Object(h["a"])(js,os,ls,!1,null,"6f454290",null)),qs=Rs.exports,As=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{offset:2,span:20}},[a("el-form",{attrs:{"label-position":"right","label-width":"180px",model:e.layerInfo}},[a("el-form-item",{attrs:{label:"所属产品线(实验区)："}},[e._v(e._s(e.formate.product_chinese_name)+" | "+e._s(e.formate.exp_zone_chinese_name))]),a("el-form-item",{attrs:{label:"实验策略："}},[e._v(e._s(e.strategySet.strategy_set_name))]),a("el-form-item",{attrs:{label:"实验层名称："}},[e._v(e._s(e.layerInfo.exp_layer_name))]),a("el-form-item",{attrs:{label:"实验描述："}},[a("el-input",{attrs:{type:"textarea",rows:"6",placeholder:"【请填写实验的预期目标，实验的设计方案，实验的放量计划，实验关心的核心指标等】"},model:{value:e.layerInfo.exp_layer_comment,callback:function(t){e.$set(e.layerInfo,"exp_layer_comment",t)},expression:"layerInfo.exp_layer_comment"}})],1),0==e.layerInfo.is_same_type?a("el-form-item",{attrs:{label:"实验对象类型："}},[e._v(e._s(e.formate.alloc_type_name))]):e._e(),e.layerInfo.is_same_type>0?[a("el-form-item",{attrs:{label:"流量A/B分桶类型："}},[e._v(e._s(e.formate.alloc_type_name))]),a("el-form-item",{attrs:{label:"实验对象类型："}},[e._v(e._s(e.layerInfo.exp_object_type_name))])]:e._e(),e.layerInfo.is_same_type>0?a("el-form-item",{attrs:{label:"实验对象："}},[a("el-input",{attrs:{type:"textarea",rows:"6",placeholder:"【请填写实验的预期目标，实验的设计方案，实验的放量计划，实验关心的核心指标等】",disabled:e.formate.is_online_ever},model:{value:e.layerInfo.exp_object,callback:function(t){e.$set(e.layerInfo,"exp_object",t)},expression:"layerInfo.exp_object"}})],1):e._e()],2)],1),e.showExpList?a("el-col",{attrs:{offset:2,span:20}},[e.layerInfo.is_same_type>0?a("SetExp",{ref:"setexp"}):e._e(),0==e.layerInfo.is_same_type?a("SetExpTwo",{ref:"setexp",attrs:{allocType:e.layerInfo.alloc_type_code}}):e._e()],1):e._e(),a("el-dialog",{attrs:{title:"选择审核人",visible:e.showDialogAuditor},on:{"update:visible":function(t){e.showDialogAuditor=t}}},[a("AddAuditor",{attrs:{expZoneCode:e.layerInfo.exp_zone_code},model:{value:e.assignAuditor,callback:function(t){e.assignAuditor=t},expression:"assignAuditor"}}),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.showDialogAuditor=!1}}},[e._v("取 消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.hideFormAuditor}},[e._v("确 定")])],1)],1),a("el-col",{staticStyle:{"margin-top":"20px"},attrs:{align:"center"}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:2==e.layerInfo.exp_layer_status_code,expression:"layerInfo.exp_layer_status_code == 2"}],attrs:{type:"primary",disabled:e.isDisableSubmit},on:{click:e.toEditExp}},[e._v(e._s(e.isDisableSubmit?"正在提交中，请等待...":"修改实验"))]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:3==e.layerInfo.exp_layer_status_code,expression:"layerInfo.exp_layer_status_code == 3"}],attrs:{type:"primary",disabled:e.isDisableSubmit},on:{click:e.toEditExp}},[e._v(e._s(e.isDisableSubmit?"正在提交中，请等待...":"放量实验"))])],1)],1)},Ms=[],Bs={data:function(){return{formate:{alloc_type_name:""},strategySet:{},expLayerId:0,layerInfo:{exp_zone_code:"",exp_object:"",exp_object_type_name:"",is_same_type:1},showExpList:!1,isDisableSubmit:!1,showDialogAuditor:!1,assignAuditor:[]}},components:{FlowAlloc:Va,SetExp:mr,SetExpTwo:Sr,AddAuditor:Ze},mounted:function(){this.$route.query.exp_layer_id>0?this.expLayerId=this.$route.query.exp_layer_id:this.$router.push({path:"/"}),this.getlayerInfo()},methods:{getlayerInfo:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.exp.getExpDetailByGo(this.expLayerId);case 2:if(t=e.sent,this.layerInfo=t.data.origin_exp_layer,this.formate=t.data.format,this.strategySet=t.data.strategy_set,2==this.layerInfo.exp_layer_status_code||3==this.layerInfo.exp_layer_status_code){e.next=10;break}return this.$message({message:"该实验暂时不能编辑",type:"error"}),this.$router.push({path:"/lab/detail",query:{exp_layer_id:this.expLayerId}}),e.abrupt("return");case 10:this.setExpObject(),this.$store.commit("setStrategySetId",this.layerInfo.strategy_set_id),a=t.data.exp_list.filter((function(e){return e.exp_type_code>0})),a.forEach((function(e,t){a[t].tab_name=t+""})),this.$store.commit("setExpList",a),this.showExpList=!0;case 16:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),setExpObject:function(){var e=this.$tool.formateCustExpObject(this.layerInfo);if(!(Object.keys(e).length<1)){var t=e[0];this.layerInfo.exp_object_type=t.name_code,this.$set(this.layerInfo,"exp_object",t.data),this.layerInfo.exp_object_type_name=t.name}},getUpdateParam:function(){var e={strategy_set_id:this.layerInfo.strategy_set_id,exp_layer_comment:this.layerInfo.exp_layer_comment,data:this.$store.state.create_exp.exp_list,assign_auditor:this.assignAuditor};return this.layerInfo.is_same_type>0&&!this.formate.is_online_ever&&(e.alloc_condition_value={},e.alloc_condition_value[this.layerInfo.exp_object_type]=this.layerInfo.exp_object,e.alloc_condition_enable=1),this.$store.state.create_exp.del_exp_list.length>0&&this.$store.state.create_exp.del_exp_list.forEach((function(t){e.data.push(t)})),e},hideFormAuditor:function(){this.assignAuditor.length<1?this.$message("请指定审核人"):(this.showDialogAuditor=!1,this.toEditExp())},toEditExp:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(this.assignAuditor.length<1)){e.next=3;break}return this.showDialogAuditor=!0,e.abrupt("return");case 3:if(t=this.getUpdateParam(),t.exp_layer_id=parseInt(this.$route.query.exp_layer_id),3==this.layerInfo.exp_layer_status_code?"放量成功":"修改成功",!this.isDisableSubmit){e.next=8;break}return e.abrupt("return",!1);case 8:return e.prev=8,e.next=11,this.$api.exp.updateByGo(t);case 11:a=e.sent,0==a.errcode?this.$alert("修改成功，等待审核员审核","创建成功",{confirmButtonText:"确定",callback:function(e){r.$router.push({path:"/lab/detail",query:{exp_layer_id:r.$route.query.exp_layer_id}})}}):(this.isDisableSubmit=!1,this.$message(a.errmsg)),e.next=18;break;case 15:e.prev=15,e.t0=e["catch"](8),this.$message(e.t0.message||"请刷新页面重试");case 18:case"end":return e.stop()}}),e,this,[[8,15]])})));function t(){return e.apply(this,arguments)}return t}()}},Ps=Bs,Qs=Object(h["a"])(Ps,As,Ms,!1,null,null,null),Us=Qs.exports,Ns=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{ref:"form",attrs:{"label-position":"right","label-width":"150px"}},[a("el-form-item",{attrs:{label:"产品线"}},[a("el-radio-group",{model:{value:e.expZoneCode,callback:function(t){e.expZoneCode=t},expression:"expZoneCode"}},[e._l(e.supportExpZones,(function(t,r){return[a("el-radio-button",{attrs:{label:r}},[e._v(e._s(t))])]}))],2)],1),a("el-form-item",{attrs:{label:"策略/参数"}},[a("el-col",{attrs:{span:20}},[a("el-select",{staticStyle:{display:"block"},attrs:{placeholder:"请选择策略",filterable:""},model:{value:e.strategySetId,callback:function(t){e.strategySetId=t},expression:"strategySetId"}},[e._l(e.strategySetList,(function(e){return[a("el-option",{key:e.strategy_set_id,attrs:{label:e.strategy_set_name,value:e.strategy_set_id}})]}))],2)],1)],1)],1),e.showDomain?a("el-row",[a("el-form",{ref:"form",attrs:{"label-position":"right","label-width":"150px"}},[a("el-form-item",[a("el-col",{attrs:{span:20}},[a("SingelDomainLayer",{attrs:{strategySetId:e.strategySetId,expLayerId:e.tabLayerId},on:{domainClick:e.domainClick}})],1)],1),a("el-form-item",[a("el-col",{attrs:{span:20}},[a("el-tabs",{attrs:{type:"border-card"},model:{value:e.tabLayerId,callback:function(t){e.tabLayerId=t},expression:"tabLayerId"}},[e._l(e.domainLayer,(function(t,r){return["system"!=t.exp_layer.creator?a("el-tab-pane",{attrs:{label:"实验域"+(r+1),name:t.exp_layer.exp_layer_id+""}},[a("el-progress",{staticStyle:{"margin-bottom":"10px"},attrs:{"stroke-width":15,percentage:t.progress,"text-inside":!0}}),a("p",[a("strong",[e._v("实验名：")]),a("router-link",{attrs:{to:{path:"/lab/detail",query:{exp_layer_id:t.exp_layer.exp_layer_id}}}},[e._v(e._s(t.exp_layer.exp_layer_name)+"【"+e._s(t.exp_layer.exp_layer_id)+"】")])],1),a("p",[a("strong",[e._v("流量分配条件：")]),1==t.exp_layer.alloc_condition_enable?a("span",[e._v("无")]):e._e()]),1==t.exp_layer.alloc_condition_enable?a("el-card",{staticClass:"box-card"},e._l(t.exp_layer.alloc_condition,(function(t,r){return a("p",{staticClass:"p-break"},[e._v(e._s(t.name)+" : "+e._s(t.data))])})),0):e._e(),a("p",[a("strong",[e._v("创建人：")]),e._v(" "+e._s(t.exp_layer.creator)+" ")]),a("p",[a("strong",[e._v("创建时间：")]),e._v(" "+e._s(t.exp_layer.create_time)+" ")]),a("p",[a("strong",[e._v("更新时间：")]),e._v(" "+e._s(t.exp_layer.update_time)+" ")]),a("el-button",{staticStyle:{"margin-left":"10px","margin-top":"10px"},attrs:{size:"medium",type:"primary"},on:{click:function(a){return e.toExpDataStat(t.exp_layer)}}},[e._v("实验检验")])],1):e._e()]}))],2)],1)],1)],1)],1):e._e(),e.showDomain?e._e():a("el-row",[a("el-form",{ref:"form",attrs:{"label-position":"right","label-width":"150px"}},[a("el-form-item",[a("el-col",{attrs:{span:20}},[e._l(e.expLayerList,(function(t,r){return[a("el-card",{staticClass:"box-card"},[a("p",[a("strong",[e._v("实验名：")]),a("router-link",{attrs:{to:{path:"/lab/detail",query:{exp_layer_id:t.exp_layer_id}}}},[e._v(e._s(t.exp_layer_name)+"【"+e._s(t.exp_layer_id)+"】")])],1),a("p",[a("strong",[e._v("流量分配条件：")]),0==t.alloc_condition_enable?a("span",[e._v("无")]):e._e()]),1==t.alloc_condition_enable?a("el-card",{staticClass:"box-card"},e._l(t.alloc_condition,(function(t,r){return a("p",{staticClass:"p-break"},[e._v(e._s(t.name)+" : "+e._s(t.data))])})),0):e._e(),a("p",[a("strong",[e._v("创建人：")]),e._v(" "+e._s(t.creator)+" ")]),a("p",[a("strong",[e._v("创建时间：")]),e._v(" "+e._s(t.create_time)+" ")]),a("p",[a("strong",[e._v("更新时间：")]),e._v(" "+e._s(t.update_time)+" ")]),a("el-button",{staticStyle:{"margin-left":"10px","margin-top":"10px"},attrs:{size:"medium",type:"primary"},on:{click:function(a){return e.toExpDataStat(t)}}},[e._v("实验检验")])],1)]}))],2)],1)],1)],1)],1)},zs=[],Hs={data:function(){return{expZoneCode:0,strategySetId:0,domainLayer:[],layerList:{},supportExpZones:{},allStratgyList:{},allLayerList:{},tabLayerId:"0"}},components:{SingelDomainLayer:Te},mounted:function(){this.getLayerList()},watch:{expZoneCode:function(){this.strategySetList.length>0&&(this.strategySetId=this.strategySetList[0].strategy_set_id)},strategySetId:function(e,t){this.showDomain&&this.getDomainLayer()}},computed:{showDomain:function(){return"78301"==this.expZoneCode&&0==this.expLayerList[0].exp_layer_type},strategySetList:function(){return void 0!=this.allStratgyList[this.expZoneCode]?this.$lodash.uniqBy(this.allStratgyList[this.expZoneCode],"strategy_set_id"):[]},expLayerList:function(){return void 0!=this.allLayerList[this.strategySetId]?this.allLayerList[this.strategySetId]:[]}},methods:{getLayerList:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a,r,s,n=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.exp.getLayerListByGo("online");case 2:t=e.sent,a={},r={},s={},t.data.forEach((function(e){1e3==e.origin_exp_layer.product_code?a[e.origin_exp_layer.exp_zone_code]=e.product_chinese_name+"-"+e.exp_zone_chinese_name:a[e.origin_exp_layer.exp_zone_code]=e.product_chinese_name,void 0==r[e.origin_exp_layer.exp_zone_code]&&(r[e.origin_exp_layer.exp_zone_code]=[]),r[e.origin_exp_layer.exp_zone_code].push({strategy_set_id:e.origin_exp_layer.strategy_set_id,strategy_set_name:e.strategy_set_name}),void 0==s[e.origin_exp_layer.strategy_set_id]&&(s[e.origin_exp_layer.strategy_set_id]=[]),1==e.origin_exp_layer.alloc_condition_enable&&0==e.origin_exp_layer.exp_layer_type?e.origin_exp_layer.alloc_condition=n.$tool.foramatAllocCondition(JSON.parse(e.origin_exp_layer.alloc_condition_value)):1==e.origin_exp_layer.alloc_condition_enable&&1==e.origin_exp_layer.exp_layer_type?e.origin_exp_layer.alloc_condition=n.$tool.formateCustExpObject(e.origin_exp_layer):e.origin_exp_layer.alloc_condition=[],s[e.origin_exp_layer.strategy_set_id].push(e.origin_exp_layer)})),this.$set(this,"allStratgyList",r),this.$set(this,"supportExpZones",a),this.$set(this,"allLayerList",s),void 0!=this.supportExpZones[78301]?this.expZoneCode=78301:this.expZoneCode=Object.keys(this.supportExpZones)[0],this.$set(this,"layerList",t.data);case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getDomainLayer:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a,r=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!=parseInt(this.strategySetId)){e.next=2;break}return e.abrupt("return",!1);case 2:return this.domainLayer=[],e.next=5,this.$api.strategy.getStrategyDomainList(this.strategySetId);case 5:t=e.sent,a=[],t.data.forEach((function(e){1==e.exp_layer.alloc_condition_enable&&0==e.exp_layer.exp_layer_type?e.exp_layer.alloc_condition=r.$tool.foramatAllocCondition(JSON.parse(e.exp_layer.alloc_condition_value)):1==e.exp_layer.alloc_condition_enable&&1==e.exp_layer.exp_layer_type?e.exp_layer.alloc_condition=r.$tool.formateCustExpObject(e.origin_exp_layer):e.exp_layer.alloc_condition=[],a.push(e)})),this.domainLayer=a,this.tabLayerId=this.domainLayer[0].exp_layer.exp_layer_id+"";case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),toExpDataStat:function(e){e.is_same_type>0?this.$router.push({path:"/monitor/exp_data_stat",query:{exp_layer_id:e.exp_layer_id}}):this.$router.push({path:"/monitor/cust_exp_data_stat",query:{exp_layer_id:e.exp_layer_id}})},domainClick:function(e){this.tabLayerId=e.exp_layer_id+""}}},Fs=Hs,Vs=Object(h["a"])(Fs,Ns,zs,!1,null,null,null),Gs=Vs.exports,Ws=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{"padding-bottom":"5px"}},[102==e.layerInfo.product_code?a("FansFilter",{on:{queryByFilter:e.queryByFilter}}):e.layerInfo.product_code>0?a("EffectFilter",{on:{queryByFilter:e.queryByFilter}}):e._e()],1),a("div",{staticStyle:{"padding-bottom":"5px"}},[a("ExpLayerVersionList",{attrs:{expLayerId:e.expLayerId},on:{queryBySetTime:e.queryBySetTime,clickToQuery:e.clickToQuery}})],1),a("ExpEffectTable",{attrs:{statData:e.statData}})],1)},Zs=[],Ks=(a("7db0"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tabs",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{type:"border-card","element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[a("el-tab-pane",[a("span",{attrs:{slot:"label"},on:{click:function(t){return e.switchTab("rate")}},slot:"label"},[e._v("相对值")])]),a("el-tab-pane",{attrs:{label:"配置管理"}},[a("span",{attrs:{slot:"label"},on:{click:function(t){return e.switchTab("detail")}},slot:"label"},[e._v("绝对值")])]),a("el-alert",{staticStyle:{"margin-bottom":"10px"},attrs:{title:"本次查询时间范围："+e.statData.from+"至"+e.statData.to,type:"success",closable:!1}}),e.statData.is_over_30_days?[a("el-alert",{staticStyle:{"margin-bottom":"10px"},attrs:{title:"选择时间范围超出30天",type:"warning",description:"暂时只支持实验选择范围30天的数据！！！","show-icon":"",closable:!1}})]:e._e(),e.statData.is_cross_version?[a("el-alert",{staticStyle:{"margin-bottom":"10px"},attrs:{title:"跨实验版本提醒",type:"warning",description:"您选择的时间段已经超过当前版本的日期选择范围，所统计的数据可能已不具备参考价值，请谨慎使用，后果请自行承担","show-icon":"",closable:!1}})]:e._e(),a("el-row",{staticStyle:{"margin-bottom":"15px"}},[a("el-select",{attrs:{placeholder:"请选择基准子实验"},model:{value:e.baseExpId,callback:function(t){e.baseExpId=t},expression:"baseExpId"}},e._l(e.statData.exp_list,(function(e,t){return a("el-option",{key:t,attrs:{label:e.exp_title,value:t}})})),1),a("el-select",{staticStyle:{width:"30%"},attrs:{multiple:"",filterable:"",placeholder:"选择展示的指标","collapse-tags":""},on:{change:e.changeSelectQuota},model:{value:e.selectQuotas,callback:function(t){e.selectQuotas=t},expression:"selectQuotas"}},[e._l(e.statData.quota_list,(function(e,t){return[a("el-option",{key:t,attrs:{label:e.quota_text,value:e.quota_name}})]}))],2),a("el-select",{staticStyle:{width:"30%"},attrs:{multiple:"",filterable:"",placeholder:"选择展示的实验","collapse-tags":""},model:{value:e.selectExps,callback:function(t){e.selectExps=t},expression:"selectExps"}},[e._l(e.statData.exp_list,(function(t,r){return[a("el-option",{key:r,attrs:{label:t.exp_title,value:r,disabled:"rate"==e.tableType&&r==e.baseExpId}})]}))],2),a("el-dropdown",{staticStyle:{"margin-left":"10px"},on:{command:e.handleCommand}},[a("span",{staticClass:"el-dropdown-link"},[e._v(" 工具 "),a("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"downloadHourData"}},[e._v("下载小时数据")]),a("el-dropdown-item",{attrs:{command:"downloadDayData"}},[e._v("下载天数据")]),a("el-dropdown-item",{attrs:{command:"exportExcel"}},[e._v("报表导出")]),a("el-dropdown-item",{attrs:{command:"openUserStat"}},[e._v("三方会审评测")]),2==e.exp_layer.is_same_type?a("el-dropdown-item",{attrs:{command:"showConsume"}},[e._v("预算分桶实验消耗")]):e._e(),a("el-dropdown-item",{attrs:{command:"getDebugParam"}},[e._v("debug参数")])],1)],1),a("router-link",{attrs:{to:{path:"/lab/detail",query:{exp_layer_id:e.$route.query.exp_layer_id}},target:"_blank"}},[e._v("实验详情")]),a("router-link",{attrs:{to:{path:"/quota/list",query:{quota_type:"quotaBook"}},target:"_blank"}},[e._v("实验指标字典")])],1),a("el-row",{directives:[{name:"show",rawName:"v-show",value:e.showSaveAlert,expression:"showSaveAlert"}]},[a("p",[e._v("保存所选指标，下次进来直接展示？"),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.saveSelectQuota}},[e._v("保存")])],1)]),a("div",{staticClass:"tab-pane",staticStyle:{overflow:"scroll"}},[a("table",{staticClass:"table table-hover",attrs:{id:"tableRateId"}},[a("thead",[a("tr",{staticClass:"info"},[a("td",{staticStyle:{"text-align":"center"}},[e._v("指标")]),a("td",{staticStyle:{"text-align":"right"}},[e._v("实验")]),e._l(e.statData.header,(function(t,r){return[a("td",{key:r,staticStyle:{"text-align":"right"}},[e._v(e._s(t.name))])]}))],2)]),a("tbody",[e._l(e.statData.quota_list,(function(t,r){return[e._l(e.showExpIds,(function(r,s){return[0==e.selectQuotas.length||e.selectQuotas.indexOf(t.quota_name)>-1?a("tr",{class:{trBorderBottom:s===e.showExpIds.length-1,"first-tr":0==s}},[0==s?[a("td",{staticClass:"firstTd",attrs:{rowspan:e.showExpIds.length}},[a("el-popover",{attrs:{placement:"top-start",width:"200",trigger:"hover",content:t.quota_comment}},[a("span",{staticClass:"label",class:t.cls,attrs:{slot:"reference"},on:{click:function(a){return e.showQuotaHourData(t.quota_name,t.quota_text,"-1")}},slot:"reference"},[e._v(e._s(t.quota_en_text))])]),a("br"),a("h6",[e._v(e._s(t.quota_text))])],1)]:e._e(),a("td",{staticStyle:{"text-align":"right"}},[a("span",{directives:[{name:"popover",rawName:"v-popover:exp",arg:"exp"}],staticStyle:{cursor:"pointer"},on:{mouseover:function(t){return e.showExpTitle(e.statData.exp_list[r],t)},mouseleave:function(t){return e.hideExpTitle(e.statData.exp_list[r].exp_title,t)}}},[e._v(e._s(e.statData.exp_list[r].exp_title.length>50?e.statData.exp_list[r].exp_title.substring(0,48)+"..":e.statData.exp_list[r].exp_title))]),a("span",{directives:[{name:"show",rawName:"v-show",value:0==e.exp_layer.exp_layer_type,expression:"exp_layer.exp_layer_type==0"}],staticStyle:{color:"#113285","padding-right":"2px"}},[e._v("["+e._s(e.statData.exp_list[r].traffic_weight/10)+"%]")])]),e._l(e.statData.header,(function(s){return[a("td",[a("p",{class:void 0!==e.statData[e.tableType][t.quota_name][r][s.code]?e.statData[e.tableType][t.quota_name][r][s.code].cls:"",staticStyle:{cursor:"pointer"},on:{mouseover:function(a){return e.showTip(a,t.quota_name,r,s.code)},mouseleave:function(t){return e.hideTip(t)}}},[e._v(e._s(void 0!==e.statData[e.tableType][t.quota_name][r][s.code]?e.statData[e.tableType][t.quota_name][r][s.code].val:"-"))])])]}))],2):e._e()]}))]}))],2)])])],2),a("el-dialog",{attrs:{visible:e.showDialog,width:"70%"},on:{"update:visible":function(t){e.showDialog=t}}},[a("div",{staticClass:"clearfix",attrs:{slot:"title"},slot:"title"},[a("strong",[e._v(" "+e._s(e.dialogTitle)+" "),e.hloading?a("i",{staticClass:"el-icon-loading"}):e._e()]),a("el-select",{attrs:{placeholder:"请选择"},on:{change:e.changeDimType},model:{value:e.dimType,callback:function(t){e.dimType=t},expression:"dimType"}},e._l(e.statData.header,(function(e,t){return a("el-option",{key:t,attrs:{label:e.name,value:e.code}})})),1)],1),a("drawchart",{attrs:{chartData:e.quotaHourData,chartId:"hourDataChartId"}})],1),a("el-dialog",{attrs:{visible:e.showDebugDialog,width:"70%"},on:{"update:visible":function(t){e.showDebugDialog=t}}},[a("div",{staticClass:"clearfix",attrs:{slot:"title"},slot:"title"},[a("strong",[e._v("debug参数")])]),e._l(e.debugData,(function(t,r){return a("div",{staticStyle:{"margin-bottom":"20px"}},[a("p",[a("strong",[e._v("Key：")]),e._v(" "+e._s(r)+" ")]),a("p",[a("strong",[e._v("Param：")]),e._v(" "+e._s(t.param)+" ")]),a("p",[a("strong",[e._v("Token：")]),e._v(" "+e._s(t.token)+" ")]),a("p",[a("strong",[e._v("AdType：")]),e._v(" "+e._s(t.ad_type)+" ")]),a("el-divider")],1)}))],2),a("el-dialog",{attrs:{visible:e.showConsumeDialog,width:"70%"},on:{"update:visible":function(t){e.showConsumeDialog=t}}},[a("div",{staticClass:"clearfix",attrs:{slot:"title"},slot:"title"},[a("strong",[e._v("实验对象的预算消耗曲线")])]),a("BudgetExpConsume",{ref:"budget",attrs:{expLayerId:e.exp_layer.exp_layer_id}})],1),e._m(0)],1)}),Ys=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"row text-right",staticStyle:{"padding-right":"20px"}},[a("span",{staticStyle:{color:"grey","font-size":"12px"}},[e._v("由D+提供算力支持(Powered by D+)")])])}],Js=(a("b680"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("el-col",{attrs:{offset:4}},[a("el-form",{attrs:{inline:!0}},[a("el-form-item",{attrs:{label:"实验："}},[a("el-select",{attrs:{placeholder:"选择实验"},model:{value:e.expId,callback:function(t){e.expId=t},expression:"expId"}},[e._l(e.expList,(function(e,t){return[a("el-option",{attrs:{label:e.exp_title,value:e.uniqe_exp_id}})]}))],2)],1),a("el-form-item",{attrs:{label:"实验："}},[a("el-select",{attrs:{placeholder:"广告计划："},model:{value:e.expObject,callback:function(t){e.expObject=t},expression:"expObject"}},[e._l(e.expObjects,(function(e){return[a("el-option",{attrs:{label:e,value:e}})]}))],2)],1),a("el-form-item",[e.loadState?a("i",{staticClass:"el-icon-loading"}):e._e()])],1)],1)],1),0==e.loadState?a("el-row",["loading"!=e.loadState?a("drawchart",{attrs:{chartData:e.chartData,chartId:"budgetExpLayerConsumeChart"}}):e._e()],1):e._e()],1)}),Xs=[],en={props:["expLayerId"],data:function(){return{chartData:{data:{},title:"",xAxis:[]},expId:"",expObject:"",expList:[],expObjects:[],loadState:""}},watch:{expId:function(){this.getChart()},expObject:function(){this.getChart()}},methods:{getBudgetExpLayer:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.exp.getBudgetExpLayer(this.expLayerId);case 2:t=e.sent,this.$set(this,"expList",t.data.exp_list),this.$set(this,"expObjects",t.data.exp_object),this.$set(this,"expId",t.data.exp_list[0].uniqe_exp_id),this.$set(this,"expObject",t.data.exp_object[0]),this.getChart();case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getChart:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loadState=!0,this.chartData={data:{},title:"",xAxis:[]},e.next=4,this.$api.exp.getExpObjectConsume(this.expId,this.expObject);case 4:t=e.sent,this.loadState=!1,this.$set(this,"chartData",t.data);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},tn=en,an=Object(h["a"])(tn,Js,Xs,!1,null,null,null),rn=an.exports;function sn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function nn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?sn(Object(a),!0).forEach((function(t){Object(xa["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):sn(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var on={props:["statData"],data:function(){return{tableType:"rate",selectQuotas:[],selectExps:[],quotaHourData:{data:{},title:"",xAxis:[]},hloading:!1,showDialog:!1,dialogTitle:"",dimType:0,quota:"",baseExpId:"",showDebugDialog:!1,debugData:{},showConsumeDialog:!1,firstAccess:!0,showSaveAlert:!1}},watch:{loading:function(){this.firstAccess&&0==this.loading&&(this.selectQuotas=this.statData.show_quotas,this.firstAccess=!1,this.baseExpId=this.statData.base_exp_id)},baseExpId:function(){this.$store.commit("setBaseExpId",this.baseExpId)}},components:{BudgetExpConsume:rn},computed:nn({},Object(va["c"])({exp_layer:function(e){return e.exp_effect.exp_layer},loading:function(e){return e.exp_effect.load_state}}),{showExpIds:function(){return"rate"==this.tableType&&ve.a.pull(this.selectExps,this.statData.base_exp_id),0==this.selectExps.length?"rate"==this.tableType?this.statData.exp_ids:ve.a.union([this.statData.base_exp_id],this.statData.exp_ids).sort():this.selectExps}}),methods:{changeSelectQuota:function(){this.selectQuotas.length>0&&(this.showSaveAlert=!0)},showExpTitle:function(e,t){var a,r=JSON.parse(e.exp_strategy_content),s=Object.keys(r),n="";for(var i in s){var o=r[s[i]];o.length>100&&(o=o.substring(0,100)+"..."),n+='<p class="p-break-full"><strong>'+s[i]+"：</strong>"+o+"</p>"}$(t.currentTarget).popover((a={placement:"top",html:!0,delay:1,content:n},Object(xa["a"])(a,"html",!0),Object(xa["a"])(a,"container","body"),Object(xa["a"])(a,"title",e.exp_title),Object(xa["a"])(a,"animation",!0),Object(xa["a"])(a,"template",'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'),a)).popover("toggle")},hideExpTitle:function(e,t){$(t.currentTarget).popover("destroy")},getQuotaVal:function(e,t,a){var r=ve.a.get(this.statData.detail,"".concat(e,".").concat(t,"[").concat(a,"].val"),0)+"";return r.replace(/,/g,"")},showTip:function(e,t,a,r){var s=ve.a.findIndex(this.statData.quota_list,["quota_name",t]);if(!(s<0)){var n=ve.a.get(this.statData.quota_list,"".concat(s,".quota_type"),1);if(1!=n){var i=this.getQuotaVal(t,a,-1);if("0"!=i){var o=this.getQuotaVal(t,a,r),l=(o/i*100).toFixed(3),c="占整体".concat(l,"%");$(e.currentTarget).tooltip({placement:"top",html:!0,delay:0,title:c,container:"body"}).tooltip("show")}}}},hideTip:function(e){$(e.currentTarget).tooltip("hide")},switchTab:function(e){this.tableType=e},getQuotaHourData:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,a){var r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={exp_layer_id:this.$store.state.exp_effect.exp_layer.exp_layer_id,begin:this.$store.state.exp_effect.time_area[0],end:this.$store.state.exp_effect.time_area[1],target:t,stat_type_code:a,extra_query:this.$store.state.exp_effect.query,group_by:this.$store.state.exp_effect.group_by},this.quotaHourData={data:{},title:"",xAxis:[]},this.hloading=!0,e.next=5,this.$api.effect.getQuotaChartData(r);case 5:s=e.sent,this.hloading=!1,0==s.errcode&&s.data.xAxis.length>0?this.quotaHourData=s.data:this.quotaHourData={data:{},title:"",xAxis:[]};case 8:case"end":return e.stop()}}),e,this)})));function t(t,a){return e.apply(this,arguments)}return t}(),showQuotaHourData:function(e,t,a){this.showDialog=!0,this.dialogTitle=t,this.dimType=a,this.quota=e,this.getQuotaHourData(e,a)},changeDimType:function(){this.getQuotaHourData(this.quota,this.dimType)},downloadData:function(e){var t=JSON.stringify(this.$store.state.exp_effect.query);window.open("//faraday.biz.weibo.com/go/stat_d/download_hour_data?exp_layer_id="+this.$store.state.exp_effect.exp_layer.exp_layer_id+"&begin="+this.$store.state.exp_effect.time_area[0]+"&end="+this.$store.state.exp_effect.time_area[1]+"&extra_query="+t+"&aggre="+e)},handleCommand:function(e){switch(e){case"downloadHourData":this.downloadData("hour");break;case"downloadDayData":this.downloadData("day");break;case"exportExcel":this.exportExcel();break;case"getDebugParam":this.getDebugParam();break;case"openUserStat":this.openUserStat();break;case"showConsume":this.showConsume();break}},exportExcel:function(){var e="rate"==this.tableType?this.exp_layer.exp_layer_name+"相对值":this.exp_layer.exp_layer_name+"绝对值";this.Export2Excel.export_table_to_excel("tableRateId",e)},getDebugParam:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={exp_layer_id:this.$store.state.exp_effect.exp_layer.exp_layer_id,begin:this.$store.state.exp_effect.time_area[0],end:this.$store.state.exp_effect.time_area[1],extra_query:this.$store.state.exp_effect.query,group_by:this.$store.state.exp_effect.group_by},e.next=3,this.$api.effect.getDebugParamByGo(t);case 3:a=e.sent,this.debugData=a.data,this.showDebugDialog=!0;case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),openUserStat:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.exp.getLinkTask(this.exp_layer.exp_layer_id,0);case 2:t=e.sent,0==t.errcode?window.open("http://st.tongji.weibo.com/custom/detail_show?task_id="+t.data.task_id):this.$message("暂无该实验的三方会审页面");case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),showConsume:function(){this.showConsumeDialog=!0,this.$refs.budget.getBudgetExpLayer()},saveSelectQuota:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={exp_layer_id:this.exp_layer.exp_layer_id+"",base_exp_id:this.statData.base_exp_id,select_exp:this.selectExps.join(","),show_quota:this.selectQuotas.join(",")},e.prev=1,e.next=4,this.$api.effect.saveCustomization(t);case 4:a=e.sent,0==a.errcode?this.$message("保存成功"):this.$message("保存失败，请重试"),this.showSaveAlert=!1,e.next=13;break;case 9:e.prev=9,e.t0=e["catch"](1),console.log(e.t0),this.$message("保存失败，请稍后重试");case 13:case"end":return e.stop()}}),e,this,[[1,9]])})));function t(){return e.apply(this,arguments)}return t}()}},ln=on,cn=(a("657b"),Object(h["a"])(ln,Ks,Ys,!1,null,"75c0fc40",null)),un=cn.exports,pn=(a("5384"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"panel panel-default",staticStyle:{"margin-bottom":"0"}},[a("div",{staticClass:"panel-heading"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-12"},[a("div",{staticStyle:{display:"inline-block"}},[a("popover",{attrs:{popStr:"核心指标颜色为红色"}},[a("span",{staticClass:"label label-danger"},[e._v("核心指标")])]),a("popover",{attrs:{popStr:"关注指标颜色为蓝色"}},[a("span",{staticClass:"label label-primary"},[e._v("关注指标")])]),a("popover",{attrs:{popStr:"参考指标颜色为黑色"}},[a("span",{staticClass:"label label-deep-gray"},[e._v("参考指标")])])],1),a("a",{attrs:{href:"javascript:;"},on:{click:function(t){return e.clickFunc("expConsume")}}},[e._v("预算分桶实验消耗")]),e._v(" | "),a("router-link",{attrs:{to:{path:"/lab/detail",query:{exp_layer_id:e.expLayerId}},target:"_blank"}},[a("span",{staticClass:"glyphicon glyphicon-equalizer",attrs:{"aria-hidden":"true"}}),e._v("实验详情 ")]),e._v("| "),a("a",{attrs:{href:"javascript:;"},on:{click:e.openUserStat}},[a("span",{staticClass:"glyphicon glyphicon-link",attrs:{"aria-hidden":"true"}}),e._v("三方会审评测 ")]),e._v(" | "),a("a",{attrs:{href:"javascript:;",id:"HourData"},on:{click:function(t){return e.clickFunc("downloadHourData")}}},[a("span",{staticClass:"glyphicon glyphicon-save",attrs:{"aria-hidden":"true"}}),e._v("下载小时数据 ")]),e._v(" | "),a("a",{attrs:{href:"javascript:;",id:"HourData"},on:{click:function(t){return e.clickFunc("downloadDayData")}}},[a("span",{staticClass:"glyphicon glyphicon-save",attrs:{"aria-hidden":"true"}}),e._v("下载天数据 ")]),e._v(" | "),a("a",{attrs:{href:"javascript:;"},on:{click:function(t){return e.clickFunc("exportExcel")}}},[a("span",{staticClass:"glyphicon glyphicon-export",attrs:{"aria-hidden":"true"}}),e._v("报表导出 ")]),a("a",{attrs:{href:"javascript:;"},on:{click:function(t){return e.clickFunc("getDebugParam")}}},[a("span",{staticClass:"glyphicon glyphicon-link",attrs:{"aria-hidden":"true"}}),e._v("查询引擎参数 ")])],1)])])])}),_n=[],dn={props:["expLayerId","expVersionCode"],methods:{openUserStat:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=this.$api.exp.getLinkTask(this.expLayerId,this.expVersionCode),0==t.errcode?window.open("http://st.tongji.weibo.com/custom/detail_show?task_id="+t.data.task_id):confirm("没有关联任务，是否跳往列表页面？？")&&window.open("http://st.tongji.weibo.com/index.php/custom/index");case 2:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),clickFunc:function(e){this.$emit("clickFunc",e)}}},fn=dn,hn=Object(h["a"])(fn,pn,_n,!1,null,null,null),mn=(hn.exports,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("strong",[e._v("版本列表")]),a("el-button",{staticStyle:{float:"right",padding:"3px 0"},attrs:{type:"text",icon:e.isFold?"el-icon-arrow-down":"el-icon-arrow-up"},on:{click:e.setFold}},[e._v(e._s(e.isFold?"更多版本":"折叠"))])],1),e._l(e.showExpVersionList,(function(t,r){return[a("el-row",{key:r,staticStyle:{"margin-bottom":"15px"}},[a("el-col",{attrs:{span:2}},[a("el-tag",{attrs:{type:t.version_code==e.expVersionCode?"danger":""}},[e._v("版本-"+e._s(t.version_code))])],1),a("el-col",{attrs:{span:5}},[a("el-button",{attrs:{type:t.version_code==e.expVersionCode?"danger":"",size:"small"},on:{click:function(a){return e.queryByExpVersion(t)}}},[a("span",[e._v(" "+e._s(t.begin_time.substr(5))+" 至 "),"现在"!=t.end_time?[e._v(e._s(t.end_time.substr(5)))]:"现在"==t.end_time?[e._v("现在")]:e._e()],2)])],1),a("el-col",{attrs:{span:17}},[a("div",{staticClass:"progress",staticStyle:{height:"35px","margin-bottom":"0px"}},[a("div",{staticClass:"progress-bar bg-warning",style:{width:t.base_exp_info.prograss_bar_wd+"%","line-height":"35px"},on:{mouseover:function(a){return e.showExpInfo(t.base_exp_info,a)}}},[a("span",[a("b",{directives:[{name:"show",rawName:"v-show",value:1==e.exp_layer.is_same_type,expression:"exp_layer.is_same_type == 1"}]},[e._v(e._s(t.base_exp_info.traffic_weight_percent+"%"))]),e._v("(基准实验) ")])]),e._l(t.test_exp_info,(function(t,r){return[a("div",{key:t.id,class:["progress-bar",r%2==0?"bg-primary":"bg-info"],style:{width:t.prograss_bar_wd+"%","line-height":"35px"},on:{mouseover:function(a){return e.showExpInfo(t,a)}}},[a("span",[a("b",{directives:[{name:"show",rawName:"v-show",value:1==e.exp_layer.is_same_type,expression:"exp_layer.is_same_type == 1"}]},[e._v(e._s(t.traffic_weight_percent+"%"))]),e._v(" ("+e._s(t.exp_title)+") ")])])]})),a("div",{staticClass:"progress-bar progress-bar-color-grey",style:{width:t.rest_exp_info.prograss_bar_wd+"%","line-height":"35px"},on:{mouseover:function(a){return e.showExpInfo(t.rest_exp_info,a)}}},[a("span",[a("b",{directives:[{name:"show",rawName:"v-show",value:1==e.exp_layer.is_same_type,expression:"exp_layer.is_same_type == 1"}]},[e._v(e._s(t.rest_exp_info.traffic_weight_percent+"%"))]),e._v("(未使用流量） ")])])],2)])],1)]})),a("el-row",[a("el-col",[a("el-form",{ref:"form",attrs:{"label-position":"left","label-width":"100px",inline:!0}},[a("el-form-item",{attrs:{label:"自定义时间"}},[a("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"left",size:"small",format:"yyyy-MM-dd HH:mm","value-format":"yyyy-MM-dd HH:mm",clearable:!1,"time-arrow-control":!0},on:{change:e.clickToQuery},model:{value:e.timeArea,callback:function(t){e.timeArea=t},expression:"timeArea"}})],1),0==e.exp_layer.is_same_type?a("el-form-item",{attrs:{label:"实验前时间"}},[a("el-date-picker",{attrs:{type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"left",size:"small",format:"yyyy-MM-dd HH:mm","value-format":"yyyy-MM-dd HH:mm","time-arrow-control":!0},model:{value:e.unExpTimeArea,callback:function(t){e.unExpTimeArea=t},expression:"unExpTimeArea"}})],1):e._e(),a("el-form-item",[a("el-button",{attrs:{type:"warning",icon:"el-icon-search",size:"small"},on:{click:e.clickToQuery}},[e._v("查询")])],1)],1)],1)],1)],2)}),yn=[];a("fb6a");function gn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function bn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?gn(Object(a),!0).forEach((function(t){Object(xa["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):gn(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var xn={props:["expLayerId"],data:function(){return{expVersionList:[],expVersionCode:1,versionInfo:{},isFold:!0,pickerOptions:{shortcuts:[{text:"今日",onClick:function(e){e.$emit("pick",[_()().startOf("day").toDate(),_()().toDate()])}},{text:"昨日",onClick:function(e){e.$emit("pick",[_()().subtract("days",1).startOf("day").toDate(),_()().startOf("day").toDate()])}},{text:"最近3日",onClick:function(e){e.$emit("pick",[_()().subtract("days",3).startOf("day").toDate(),_()().startOf("day").toDate()])}},{text:"最近一周",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}}]},timeArea:[],unExpTimeArea:[]}},computed:bn({},Object(va["c"])({exp_layer:function(e){return e.exp_effect.exp_layer}}),{showExpVersionList:function(){return this.isFold&&this.expVersionList.length>3?this.expVersionList.slice(0,3):this.expVersionList}}),watch:{expLayerId:function(e,t){this.getExpVerionList()}},methods:{setFold:function(){this.isFold=!this.isFold},getExpVerionList:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(parseInt(this.expLayerId)<1)){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.$api.exp.getVersionList(this.expLayerId);case 4:t=e.sent,null==t.data&&(t.data=[]),this.expVersionList=t.data,this.expVersionList.length>0?this.queryByExpVersion(this.expVersionList[0]):this.$message.error("该实验暂未上线运行");case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),showExpInfo:function(e,t){$(t.currentTarget).tooltip({placement:"top",title:e.exp_title}).tooltip("show")},queryByExpVersion:function(e){this.expVersionCode=e.version_code,this.versionInfo=e;var t=this.versionInfo.end_time;"现在"==t&&(t=_()().format("YYYY-MM-DD HH:mm")),this.$set(this,"timeArea",[this.versionInfo.begin_time,t]),this.setUnExpTime(),this.$emit("queryBySetTime",this.timeArea)},setUnExpTime:function(){if(!(this.exp_layer.is_same_type>0)){var e=_()(this.timeArea[0]).format("YYYY-MM-DD HH:00:00"),t=_()(this.timeArea[1]).format("YYYY-MM-DD HH:00:00"),a=_()(e).unix()-(_()(t).unix()-_()(e).unix()),r=_.a.unix(a).format("YYYY-MM-DD HH:mm:00");this.unExpTimeArea=[r,_()(e).format("YYYY-MM-DD HH:00:00")],this.$store.commit("setUnExpTime",this.unExpTimeArea)}},clickToQuery:function(){this.$emit("clickToQuery",this.timeArea,this.unExpTimeArea)}}},vn=xn,wn=(a("948a"),Object(h["a"])(vn,mn,yn,!1,null,"7beeff65",null)),kn=wn.exports,Sn=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-card",{staticClass:"box-card"},[a("el-form",{ref:"form",attrs:{"label-position":"left","label-width":"100px"},model:{value:e.queryConfig,callback:function(t){e.queryConfig=t},expression:"queryConfig"}},[a("el-form-item",{attrs:{label:"场景"}},[a("el-checkbox-group",{on:{change:e.toSetQueryConfig},model:{value:e.queryConfig.psid,callback:function(t){e.$set(e.queryConfig,"psid",t)},expression:"queryConfig.psid"}},[e._l(e.statConfig.psid,(function(t,r){return[a("el-checkbox",{attrs:{label:t.code+""}},[e._v(e._s(t.name))])]}))],2)],1),a("el-form-item",{attrs:{label:"竞价类型"}},[a("el-checkbox-group",{on:{change:e.toSetQueryConfig},model:{value:e.queryConfig.bid_type,callback:function(t){e.$set(e.queryConfig,"bid_type",t)},expression:"queryConfig.bid_type"}},[e._l(e.statConfig.bid_type,(function(t,r){return[a("el-checkbox",{attrs:{label:t.code}},[e._v(e._s(t.name))])]}))],2)],1)],1),e.showQuotaTip?[a("el-alert",{attrs:{title:"请求类指标提醒",type:"warning",description:"展现维度为营销目标、竞价类型、创意类型 或 筛选条件包含营销目标、竞价类型、创意类型时，请求类的指标和请求类的相关率值不会返回，\n                请求类的指标包含：库存、请求量、出广告的请求量","show-icon":"",closable:!1}})]:e._e(),a("el-collapse",{staticStyle:{"margin-bottom":"20px"}},[a("el-collapse-item",{attrs:{title:"更多筛选条件...",name:"1"}},[a("el-form",{ref:"form2",attrs:{"label-position":"left","label-width":"100px"},model:{value:e.queryConfig,callback:function(t){e.queryConfig=t},expression:"queryConfig"}},[a("el-form-item",{attrs:{label:"平台"}},[a("el-checkbox-group",{on:{change:e.toSetQueryConfig},model:{value:e.queryConfig.platform,callback:function(t){e.$set(e.queryConfig,"platform",t)},expression:"queryConfig.platform"}},[e._l(e.statConfig.platform,(function(t,r){return[a("el-checkbox",{attrs:{label:t.code}},[e._v(e._s(t.name))])]}))],2)],1),a("el-form-item",{attrs:{label:"营销目标"}},[a("el-checkbox-group",{on:{change:e.toSetQueryConfig},model:{value:e.queryConfig.promotion_objective,callback:function(t){e.$set(e.queryConfig,"promotion_objective",t)},expression:"queryConfig.promotion_objective"}},[e._l(e.statConfig.promotion_objective,(function(t,r){return[a("el-checkbox",{attrs:{label:t.code}},[e._v(e._s(t.name))])]}))],2)],1),a("el-form-item",{attrs:{label:"优化目标"}},[a("el-checkbox-group",{on:{change:e.toSetQueryConfig},model:{value:e.queryConfig.optimization_goal,callback:function(t){e.$set(e.queryConfig,"optimization_goal",t)},expression:"queryConfig.optimization_goal"}},[e._l(e.statConfig.optimization_objective,(function(t,r){return[a("el-checkbox",{attrs:{label:t.code}},[e._v(e._s(t.name))])]}))],2)],1),a("el-form-item",{attrs:{label:"创意类型"}},[a("el-checkbox-group",{on:{change:e.toSetQueryConfig},model:{value:e.queryConfig.creative_style_id,callback:function(t){e.$set(e.queryConfig,"creative_style_id",t)},expression:"queryConfig.creative_style_id"}},[e._l(e.statConfig.creative_style_id,(function(t,r){return[a("el-checkbox",{attrs:{label:t.code}},[e._v(e._s(t.name))])]}))],2)],1)],1)],1)],1),a("el-form",{ref:"form3",attrs:{"label-position":"right","label-width":"100px"}},[a("el-form-item",{attrs:{label:"选择展现维度"}},[a("el-radio-group",{on:{change:e.toSetQueryConfig},model:{value:e.groupBy,callback:function(t){e.groupBy=t},expression:"groupBy"}},[a("el-radio-button",{attrs:{label:"psid"}},[e._v("场景")]),a("el-radio-button",{attrs:{label:"bid_type"}},[e._v("竞价类型")]),a("el-radio-button",{attrs:{label:"platform"}},[e._v("平台")]),a("el-radio-button",{attrs:{label:"promotion_objective"}},[e._v("营销目标")]),a("el-radio-button",{attrs:{label:"creative_style_id"}},[e._v("创意类型")])],1)],1)],1)],2)],1)},In=[],Ln={data:function(){return{activeNames:[],statConfig:{platform:[],bid_type:[],promotion_objective:[],optimization_objective:[],creative_style_id:[],psid:[],service:[]},queryConfig:{platform:[],bid_type:[],promotion_objective:[],creative_style_id:[],optimization_goal:[],psid:[]},groupBy:"psid"}},mounted:function(){this.$store.commit("setQueryConfig",this.queryConfig),this.getStatConfig()},computed:{showQuotaTip:function(){return["bid_type","promotion_objective","creative_style_id"].indexOf(this.groupBy)>-1||this.queryConfig.bid_type.length>0||this.queryConfig.promotion_objective.length>0||this.queryConfig.creative_style_id.length>0}},methods:{getStatConfig:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.effect.getConfig();case 2:t=e.sent,this.$set(this,"statConfig",t.data);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),toSetQueryConfig:function(){this.$store.commit("selectGroupBy",this.groupBy),this.$store.commit("setQueryConfig",this.queryConfig)}}},$n=Ln,Dn=(a("f8fe"),Object(h["a"])($n,Sn,In,!1,null,"55fa8e37",null)),Cn=Dn.exports,En=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{staticClass:"box-card"},[a("el-form",{ref:"form",attrs:{"label-position":"left","label-width":"100px"},model:{value:e.queryConfig,callback:function(t){e.queryConfig=t},expression:"queryConfig"}},[a("el-form-item",{attrs:{label:"场景"}},[a("el-checkbox-group",{on:{change:e.toSetQueryConfig},model:{value:e.queryConfig.psid,callback:function(t){e.$set(e.queryConfig,"psid",t)},expression:"queryConfig.psid"}},[e._l(e.statConfig.service,(function(t,r){return[a("el-checkbox",{attrs:{label:t.code+""}},[e._v(e._s(t.name))])]}))],2)],1)],1),a("el-form",{ref:"form3",attrs:{"label-position":"right","label-width":"100px"}},[a("el-form-item",{attrs:{label:"选择展现维度"}},[a("el-radio-group",{on:{change:e.toSetQueryConfig},model:{value:e.groupBy,callback:function(t){e.groupBy=t},expression:"groupBy"}},[a("el-radio-button",{attrs:{label:"psid"}},[e._v("场景")])],1)],1)],1)],1)},Tn=[],On={data:function(){return{statConfig:{platform:[],bid_type:[],promotion_objective:[],optimization_objective:[],creative_style_id:[],psid:[],service:[]},queryConfig:{platform:[],bid_type:[],promotion_objective:[],creative_style_id:[],optimization_goal:[],psid:[]},groupBy:"psid"}},mounted:function(){this.getStatConfig()},methods:{getStatConfig:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.effect.getConfig();case 2:t=e.sent,this.$set(this,"statConfig",t.data);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),toSetQueryConfig:function(){this.$store.commit("selectGroupBy",this.groupBy),this.$store.commit("setQueryConfig",this.queryConfig)}}},jn=On,Rn=(a("f613"),Object(h["a"])(jn,En,Tn,!1,null,"a1ed77b6",null)),qn=Rn.exports,An={data:function(){return{expLayerId:0,layerInfo:{product_code:0},fromTime:"",endTime:"",statData:{}}},mounted:function(){this.$store.commit("setBaseExpId",""),this.$store.commit("selectGroupBy","psid"),this.$store.commit("setLoadState",!1),this.$route.query.exp_layer_id>0?(this.expLayerId=this.$route.query.exp_layer_id,this.getLayerInfo()):this.$router.push({path:"/monitor/expEffect"})},methods:{queryByFilter:function(){this.loadRateData()},buildQueryParams:function(){return{exp_layer_id:this.expLayerId,begin:this.fromTime,end:this.endTime,extra_query:this.$store.state.exp_effect.query,base_exp_id:this.$store.state.exp_effect.base_exp_id,group_by:this.$store.state.exp_effect.group_by}},loadRateData:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!this.$store.state.exp_effect.load_state){e.next=3;break}return this.$message("请等待上次请求完成"),e.abrupt("return");case 3:return this.$store.commit("setLoadState",!0),this.statData.quota_list=[],t=this.buildQueryParams(),e.prev=6,e.next=9,this.$api.effect.getStat(t);case 9:if(a=e.sent,this.$store.commit("setLoadState",!1),0==a.errcode){e.next=15;break}return this.$message("暂无数据"),this.statData={quota_list:[],exp_ids:[],select_exps:[],base_exp_id:[],show_quotas:[]},e.abrupt("return");case 15:this.statData=a.data,this.fixTableLeftSlide(),this.$emit("fixedTableHead","#tableRateId"),e.next=24;break;case 20:e.prev=20,e.t0=e["catch"](6),this.$message.error("后台出错，请刷新页面重试下"),this.$store.commit("setLoadState",!1);case 24:case"end":return e.stop()}}),e,this,[[6,20]])})));function t(){return e.apply(this,arguments)}return t}(),getLayerInfo:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.exp.getExpLayer(this.expLayerId);case 2:t=e.sent,this.layerInfo=t.data.origin_exp_layer,this.$store.commit("setExpLayer",this.layerInfo),this.$store.commit("selectGroupBy","psid"),this.$store.commit("setHeadBreadCrumb",this.layerInfo.exp_layer_name);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),queryBySetTime:function(e){this.fromTime=e[0],this.endTime=e[1],this.$store.commit("setTime",e),this.loadRateData()},clickToQuery:function(e){this.queryBySetTime(e)},fixTableLeftSlide:function(){$(".tab-pane").scroll((function(e){var t=e.target,a=t.scrollLeft;a>0?($("#tableRateId thead tr").find("td:eq(0),td:eq(1)").css({transform:"translateX("+a+"px)",background:"#d3edf8"}),$("#tableRateId tbody .first-tr").find("td:eq(1)").css({transform:"translateX("+a+"px)",background:"#d3edf8"}),$("#tableRateId tbody tr").find("td:eq(0)").css({transform:"translateX("+a+"px)",background:"#d3edf8","z-index":"1000"})):($("#tableRateId thead tr").find("td:eq(0),td:eq(1)").css({transform:"",background:""}),$("#tableRateId tbody .first-tr").find("td:eq(1)").css({transform:"",background:""}),$("#tableRateId tbody tr").find("td:eq(0)").css({transform:"",background:""}))}))}},components:{ExpEffectTable:un,ExpLayerVersionList:kn,EffectFilter:Cn,BudgetExpConsume:rn,FansFilter:qn}},Mn=An,Bn=Object(h["a"])(Mn,Ws,Zs,!1,null,null,null),Pn=Bn.exports,Qn=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{"padding-bottom":"5px"}},[a("CustExpFilter")],1),a("div",{staticStyle:{"padding-bottom":"5px"}},[a("ExpLayerVersionList",{attrs:{expLayerId:e.expLayerId},on:{queryBySetTime:e.queryBySetTime,clickToQuery:e.clickToQuery}})],1),a("ExpEffectTable",{attrs:{custExpStatData:e.statData}})],1)},Un=[],Nn=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tabs",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{type:"border-card","element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[a("div",{staticClass:"h5"},[Object.keys(e.custExpStatData.time_info).length>0?a("p",[a("strong",[e._v("实验前：")]),e._v(" "+e._s(e.custExpStatData.time_info.before.from)+" ~ "+e._s(e.custExpStatData.time_info.before.to)+" "),a("strong",[e._v("实验后：")]),e._v(" "+e._s(e.custExpStatData.time_info.after.from)+" ~ "+e._s(e.custExpStatData.time_info.after.to)+" ")]):e._e()]),a("table",{staticClass:"table table-condensed table-hover",attrs:{"data-headfix":"true"}},[a("thead",[a("tr",{staticClass:"info"},[a("td",{staticStyle:{"text-align":"center"}},[e._v("实验指标")]),a("td",{staticStyle:{"text-align":"right","max-width":"80px","min-width":"80px"}},[e._v("实验前后")]),e._l(e.custExpStatData.group_by_config,(function(t,r){return[a("td",{staticStyle:{"text-align":"right"}},[e._v(e._s(t.name))])]}))],2)]),a("tbody",[e._l(e.custExpStatData.data,(function(t,r){return[a("tr",[a("td",{staticClass:"firstTd",attrs:{rowspan:"3"}},[a("a",{attrs:{href:"javascript:;"}},[e._v(e._s(t.target_name))])]),a("td",[e._v("实验前")]),e._l(e.custExpStatData.group_by_config,(function(r,s){return[a("td",{class:void 0!==t.stat_list[r.code]?t.stat_list[r.code].before_cls:""},[e._v(e._s(void 0!==t.stat_list[r.code]?t.stat_list[r.code].before_val:"-"))])]}))],2),a("tr",[a("td",[e._v("实验后")]),e._l(e.custExpStatData.group_by_config,(function(r,s){return[a("td",{class:void 0!==t.stat_list[r.code]?t.stat_list[r.code].after_cls:""},[e._v(e._s(void 0!==t.stat_list[r.code]?t.stat_list[r.code].after_val:"-"))])]}))],2),a("tr",{staticClass:"trBorderBottom"},[a("td",{staticClass:"gray-font"},[e._v("效果对比")]),e._l(e.custExpStatData.group_by_config,(function(r,s){return[a("td",{class:void 0!==t.stat_list[r.code]?t.stat_list[r.code].incr_cls:""},[e._v(e._s(void 0!==t.stat_list[r.code]?t.stat_list[r.code].incr_val:"-"))])]}))],2)]}))],2)])]),e._m(0)],1)},zn=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"row text-right",staticStyle:{"padding-right":"20px"}},[a("span",{staticStyle:{color:"grey","font-size":"12px"}},[e._v("由D+提供算力支持(Powered by D+)")])])}];function Hn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Fn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Hn(Object(a),!0).forEach((function(t){Object(xa["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Hn(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var Vn={props:["custExpStatData"],computed:Fn({},Object(va["c"])({loading:function(e){return e.exp_effect.load_state}}))},Gn=Vn,Wn=(a("d8ab"),Object(h["a"])(Gn,Nn,zn,!1,null,"b7fe499c",null)),Zn=Wn.exports,Kn=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-card",{staticClass:"box-card"},[a("el-form",{ref:"form",attrs:{"label-position":"left","label-width":"100px"},model:{value:e.queryConfig,callback:function(t){e.queryConfig=t},expression:"queryConfig"}},[a("el-form-item",{attrs:{label:"场景"}},[a("el-checkbox-group",{on:{change:e.toSetQueryConfig},model:{value:e.queryConfig.psid,callback:function(t){e.$set(e.queryConfig,"psid",t)},expression:"queryConfig.psid"}},[e._l(e.statConfig.psid,(function(t,r){return[a("el-checkbox",{attrs:{label:t.code+""}},[e._v(e._s(t.name))])]}))],2)],1),a("el-form-item",{attrs:{label:"竞价类型"}},[a("el-checkbox-group",{on:{change:e.toSetQueryConfig},model:{value:e.queryConfig.bid_type,callback:function(t){e.$set(e.queryConfig,"bid_type",t)},expression:"queryConfig.bid_type"}},[e._l(e.statConfig.bid_type,(function(t,r){return[a("el-checkbox",{attrs:{label:t.code}},[e._v(e._s(t.name))])]}))],2)],1)],1),a("el-collapse",{staticStyle:{"margin-bottom":"20px"}},[a("el-collapse-item",{attrs:{title:"更多筛选条件...",name:"1"}},[a("el-form",{ref:"form2",attrs:{"label-position":"left","label-width":"100px"},model:{value:e.queryConfig,callback:function(t){e.queryConfig=t},expression:"queryConfig"}},[a("el-form-item",{attrs:{label:"平台"}},[a("el-checkbox-group",{on:{change:e.toSetQueryConfig},model:{value:e.queryConfig.platform,callback:function(t){e.$set(e.queryConfig,"platform",t)},expression:"queryConfig.platform"}},[e._l(e.statConfig.platform,(function(t,r){return[a("el-checkbox",{attrs:{label:t.code}},[e._v(e._s(t.name))])]}))],2)],1),a("el-form-item",{attrs:{label:"营销目标"}},[a("el-checkbox-group",{on:{change:e.toSetQueryConfig},model:{value:e.queryConfig.promotion_objective,callback:function(t){e.$set(e.queryConfig,"promotion_objective",t)},expression:"queryConfig.promotion_objective"}},[e._l(e.statConfig.promotion_objective,(function(t,r){return[a("el-checkbox",{attrs:{label:t.code}},[e._v(e._s(t.name))])]}))],2)],1),a("el-form-item",{attrs:{label:"优化目标"}},[a("el-checkbox-group",{on:{change:e.toSetQueryConfig},model:{value:e.queryConfig.optimization_goal,callback:function(t){e.$set(e.queryConfig,"optimization_goal",t)},expression:"queryConfig.optimization_goal"}},[e._l(e.statConfig.optimization_objective,(function(t,r){return[a("el-checkbox",{attrs:{label:t.code}},[e._v(e._s(t.name))])]}))],2)],1),a("el-form-item",{attrs:{label:"创意类型"}},[a("el-checkbox-group",{on:{change:e.toSetQueryConfig},model:{value:e.queryConfig.creative_style_id,callback:function(t){e.$set(e.queryConfig,"creative_style_id",t)},expression:"queryConfig.creative_style_id"}},[e._l(e.statConfig.creative_style_id,(function(t,r){return[a("el-checkbox",{attrs:{label:t.code}},[e._v(e._s(t.name))])]}))],2)],1)],1)],1)],1),a("el-form",{ref:"form",attrs:{"label-position":"left","label-width":"100px"}},[a("el-form-item",{attrs:{label:"子实验"}},[a("el-select",{on:{change:e.toSetQueryConfig},model:{value:e.expId,callback:function(t){e.expId=t},expression:"expId"}},[e._l(e.expList,(function(e,t){return[a("el-option",{attrs:{value:"layer-"+e.exp_layer_id+"#exp-"+e.exp_id,label:e.exp_title}})]}))],2)],1)],1)],1)],1)},Yn=[];function Jn(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function Xn(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?Jn(Object(a),!0).forEach((function(t){Object(xa["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):Jn(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var ei={data:function(){return{activeNames:[],statConfig:{platform:[],bid_type:[],promotion_objective:[],optimization_objective:[],creative_style_id:[],psid:[],service:[]},queryConfig:{platform:[],bid_type:[],promotion_objective:[],creative_style_id:[],optimization_goal:[],psid:[]},groupBy:"psid",expId:""}},mounted:function(){this.$store.commit("setQueryConfig",this.queryConfig),this.getStatConfig()},watch:{expList:function(){this.expId="layer-"+this.expList[0].exp_layer_id+"#exp-"+this.expList[0].exp_id,this.toSetQueryConfig()}},computed:Xn({},Object(va["c"])({expList:function(e){return e.exp_effect.exp_list}}),{showQuotaTip:function(){return["bid_type","promotion_objective","creative_style_id"].indexOf(this.groupBy)>-1||this.queryConfig.bid_type.length>0||this.queryConfig.promotion_objective.length>0||this.queryConfig.creative_style_id.length>0}}),methods:{getStatConfig:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.effect.getConfig();case 2:t=e.sent,this.$set(this,"statConfig",t.data);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),toSetQueryConfig:function(){this.$store.commit("selectGroupBy",this.groupBy),this.$store.commit("setExpId",this.expId)}}},ti=ei,ai=(a("e94f"),Object(h["a"])(ti,Kn,Yn,!1,null,"cd857798",null)),ri=ai.exports,si={data:function(){return{expLayerId:0,layerInfo:{},statData:{data:{},time_info:{}}}},mounted:function(){this.$route.query.exp_layer_id>0?(this.expLayerId=this.$route.query.exp_layer_id,this.getLayerInfo()):this.$router.push({path:"/monitor/expEffect"})},methods:{loadCustExpData:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t,a){var r,s;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r={exp_layer_id:this.expLayerId,begin:t[0],end:t[1],before_begin:a[0],before_end:a[1],stat_type_code:0,extra_query:this.$store.state.exp_effect.query,exp_id:this.$store.state.exp_effect.exp_id},this.$store.commit("setLoadState",!0),this.statData={data:{},time_info:{}},e.next=5,this.$api.effect.getCustomerStat(r);case 5:if(s=e.sent,this.$store.commit("setLoadState",!1),0==s.errcode){e.next=10;break}return this.$message(s.errmsg),e.abrupt("return");case 10:this.statData=s.data,this.$store.commit("setLoadState",!1);case 12:case"end":return e.stop()}}),e,this)})));function t(t,a){return e.apply(this,arguments)}return t}(),getLayerInfo:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.exp.getExpDetailByGo(this.expLayerId);case 2:t=e.sent,this.layerInfo=t.data.origin_exp_layer,this.$store.commit("setExpLayer",this.layerInfo),this.$store.commit("setExpList",t.data.exp_list),this.$store.commit("setHeadBreadCrumb",this.layerInfo.exp_layer_name);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),queryBySetTime:function(e){this.$store.commit("setTime",e)},clickToQuery:function(e,t){this.loadCustExpData(e,t)}},components:{ExpEffectTable:Zn,ExpLayerVersionList:kn,CustExpFilter:ri}},ni=si,ii=Object(h["a"])(ni,Qn,Un,!1,null,null,null),oi=ii.exports,li=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-tabs",{attrs:{type:"border-card"},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"离线vs实时",name:"realtime_check"}},[a("RealtimeDataCheck")],1),a("el-tab-pane",{attrs:{label:"原表vs离线",name:"offline_check"}},[a("OfflineDataCheck")],1)],1)],1)},ci=[],ui=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0}},[a("el-form-item",{staticStyle:{"margin-left":"20px"},attrs:{label:"在线实验:"}},[a("el-select",{on:{change:e.loadData},model:{value:e.expLayerId,callback:function(t){e.expLayerId=t},expression:"expLayerId"}},[e._l(e.expLayerList,(function(e,t){return[a("el-option",{key:t,attrs:{label:e.exp_layer_name,value:e.exp_layer_id}})]}))],2)],1),a("el-form-item",{staticStyle:{"margin-left":"60px"},attrs:{label:"场景:"}},[a("el-select",{on:{change:e.loadData},model:{value:e.psid,callback:function(t){e.psid=t},expression:"psid"}},[a("el-option",{attrs:{value:-1,label:"整体"}}),e._l(e.psidList,(function(e,t){return[a("el-option",{key:t,attrs:{label:e.name,value:e.code}})]}))],2)],1)],1),a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",staticStyle:{height:"40px"},attrs:{slot:"header"},slot:"header"},[a("span",{staticStyle:{float:"right",padding:"3px 0"}},[a("el-form",{ref:"form",attrs:{"label-width":"80px"}},[a("el-form-item",{attrs:{label:"展示内容"}},[a("el-radio-group",{model:{value:e.dataType,callback:function(t){e.dataType=t},expression:"dataType"}},[a("el-radio",{attrs:{value:"offline",label:"offline"}},[e._v("离线数")]),a("el-radio",{attrs:{value:"realtime",label:"realtime"}},[e._v("实时数")]),a("el-radio",{attrs:{value:"dist",label:"dist"}},[e._v("误差数(实时数 - 离线数)")]),a("el-radio",{attrs:{value:"percent",label:"percent"}},[e._v("误差率(误差数 / hive数)")])],1)],1)],1)],1)]),a("el-row",{staticStyle:{width:"100%",overflow:"scroll"}},[a("table",{directives:[{name:"show",rawName:"v-show",value:e.showTable,expression:"showTable"}],staticClass:"table table-condensed table-hover",staticStyle:{overflow:"scroll"}},[a("thead",[a("tr",{staticClass:"info"},[a("th",{staticStyle:{"text-align":"center","vertical-align":"middle"}},[e._v("时间")]),a("th",{staticStyle:{"text-align":"center","vertical-align":"middle"}},[e._v("子实验")]),e._l(e.quotas,(function(t,r){return[a("th",{key:r,staticStyle:{"text-align":"center","vertical-align":"middle","min-width":"80px"}},[e._v(e._s(t))])]}))],2)]),a("tbody",[e._l(e.statData,(function(t,r){return[e._l(t,(function(s,n){return[a("tr",[0==n?[a("td",{staticStyle:{"vertical-align":"middle","text-align":"center"},attrs:{rowspan:t.length}},[e._v(e._s(r))])]:e._e(),a("td",[e._v(e._s(s.exp_title))]),e._l(e.quotas,(function(t,r){return[a("td",{key:r,class:s.cls[r],staticStyle:{cursor:"pointer"},on:{mouseover:function(t){return e.showStatDetail(s,r,t)}}},[e._v(" "+e._s(s[e.dataType][r])+" "),"percent"==e.dataType?[e._v("%")]:e._e()],2)]}))],2)]}))]}))],2)])]),a("loading",{staticStyle:{"padding-top":"20px"},attrs:{state:e.loadState}})],1),a("el-alert",{staticStyle:{"margin-top":"80px"}},[e._v("说明：实时数据只保留三天数据，我们选择其中某一个实验层的昨天实时小时数据和昨天离线小时数据进行对比")])],1)},pi=[],_i=a("bdf9"),di={components:{ScrollBtn:_i["a"]},data:function(){return{tableType:"rate",statData:{exp_list:{}},quotas:{},loadState:"",noData:!1,showTable:!1,expLayerId:0,psid:-1,expLayerList:[],psidList:[],day:"",dataType:"percent",errorLayer:[],templateId:"tableRealtimeId"}},mounted:function(){this.loadExpLayer(),this.loadPsid()},methods:{loadExpLayer:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.exp.getRecentExpsByGo();case 2:if(t=e.sent,0!=t.data.length){e.next=5;break}return e.abrupt("return");case 5:this.expLayerList=t.data,a=0,this.$route.query.exp_layer_id>0?(a=ve.a.findIndex(this.expLayerList,["exp_layer_id",parseInt(this.$route.query.exp_layer_id)]),a=a,this.expLayerId=this.expLayerList[a].exp_layer_id):this.$route.query.error_layer_Ids?this.findErrorLayer():this.expLayerId=this.expLayerList[a].exp_layer_id,this.loadData();case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),loadPsid:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.effect.getConfig();case 2:t=e.sent,this.psidList=t.data.psid;case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),loadData:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.statData={},this.loadState="loading",this.showTable=!1,e.next=5,this.$api.effect.getYesterdayStatByGo(this.expLayerId,this.psid);case 5:if(t=e.sent,this.loadState="",0==t.errcode){e.next=11;break}return this.loadState="no-data",this.showTable=!1,e.abrupt("return");case 11:this.statData=t.data.data,this.quotas=t.data.quotas,this.day=t.data.day,this.showTable=!0;case 15:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),fmtExpLayerList:function(e){var t=this.$route.query.error_layer_Ids||"";if(t)for(var a in e)t.indexOf(e[a].exp_layer_id)>-1&&(e[a].exp_layer_name=e[a].exp_layer_name+"-(误差大)");return e},findErrorLayer:function(){var e=this.$route.query.error_layer_Ids||"";if(""!=e){var t=e.split("|"),a=-1;for(var r in t)a=ve.a.findIndex(this.expLayerList,["exp_layer_id",parseInt(t[r])]),a>=0&&this.errorLayer.push(this.expLayerList[a]);this.errorLayer.length>0?this.expLayerId=this.errorLayer[0].exp_layer_id:this.expLayerId=this.expLayerList[0].exp_layer_id}else this.errorLayer=[]},switchExp:function(e){this.expLayerId=e,this.loadData()},showStatDetail:function(e,t,a){$(a.currentTarget).tooltip({placement:"top",html:!0,title:"离线数："+e.offline[t]+"<br>实时数："+e.realtime[t]+"<br>误差数："+e.dist[t]+"<br>误差率："+e.percent[t],container:"body"}).tooltip("toggle")}}},fi=di,hi=Object(h["a"])(fi,ui,pi,!1,null,"40ebbf36",null),mi=hi.exports,yi=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{directives:[{name:"show",rawName:"v-show",value:e.errDates.length>0,expression:"errDates.length > 0"}],staticClass:"alert alert-danger",attrs:{role:"alert"}},[e._v(" 以下日期的统计数据误差较大： "),a("div",{staticClass:"btn-group",attrs:{role:"group","aria-label":"..."}},[e._l(e.errDates,(function(t){return[a("button",{staticClass:"btn btn-default",class:e.date==t?"btn-danger":"",attrs:{type:"button"},on:{click:function(a){return e.switchDate(t)}}},[e._v(e._s(t))])]}))],2)]),e.layerInfo.exp_layer_id>0?a("p",[a("strong",[e._v("子实验：")]),e._v(" "+e._s(e.layerInfo.exp_layer_name)+" - "+e._s(e.expInfo.exp_title)+" ")]):e._e(),a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",staticStyle:{height:"40px"},attrs:{slot:"header"},slot:"header"},[a("span",[a("span",{staticClass:"glyphicon glyphicon-calendar",attrs:{"aria-hidden":"true"}}),a("el-select",{attrs:{placeholder:"请选择"},on:{change:e.loadData},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}},e._l(e.dateList,(function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1),a("span",{staticStyle:{float:"right",padding:"3px 0"}},[a("el-form",{ref:"form",attrs:{"label-width":"80px"}},[a("el-form-item",{attrs:{label:"特殊资源"}},[a("el-radio-group",{model:{value:e.dataType,callback:function(t){e.dataType=t},expression:"dataType"}},[a("el-radio",{attrs:{value:"hive",label:"hive"}},[e._v("hive数")]),a("el-radio",{attrs:{value:"offline",label:"offline"}},[e._v("离线数")]),a("el-radio",{attrs:{value:"dist",label:"dist"}},[e._v("误差数(离线数 - hive数)")]),a("el-radio",{attrs:{value:"percent",label:"percent"}},[e._v("误差率(误差数 / hive数)")])],1)],1)],1)],1)]),a("div",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{stripe:"",data:e.typeList,height:"500","element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[a("el-table-column",{attrs:{label:"日期",prop:"time"}}),e._l(e.quotas,(function(t,r){return[a("el-table-column",{attrs:{label:t},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{class:t.row.color[r],staticStyle:{cursor:"pointer"},on:{mouseover:function(a){return e.showStatDetail(e.statData[t.row.time],r,a)}}},[e._v(e._s(t.row[r])+" ")])]}}],null,!0)})]}))],2)],1),a("el-alert",{staticStyle:{"margin-top":"30px"},attrs:{title:"说明：原表数据是D+端每天随机选取一个固定的子实验的统计全部场景小时数据，写入mysql供我们读取，再和该子实验离线小时数据对比",type:"warning","show-icon":""}})],1)],1)},gi=[],bi={components:{ScrollBtn:_i["a"]},data:function(){return{statData:{},dateList:[],date:"",quotas:{},noData:!1,showTable:!1,expInfo:{exp_layer:{exp_layer_name:""},exp_title:""},layerInfo:{exp_layer_id:0},dataType:"percent",errDates:[],templateId:"tableOfflineId",loading:!0}},computed:{typeList:function(){var e=this,t=[];return Object.keys(this.statData).forEach((function(a){var r={time:a,activate_count:e.statData[a][e.dataType].activate_count,consume:e.statData[a][e.dataType].consume,download_count:e.statData[a][e.dataType].download_count,color:e.statData[a].cls,inventory_count:e.statData[a][e.dataType].inventory_count,monitor_pv_count:e.statData[a][e.dataType].monitor_pv_count,pv_count:e.statData[a][e.dataType].pv_count,req_count:e.statData[a][e.dataType].req_count,total_bhv_count:e.statData[a][e.dataType].total_bhv_count,unlike_count:e.statData[a][e.dataType].unlike_count};t.push(r)})),t}},mounted:function(){for(var e=1;e<=10;e++)this.dateList.push(_()().subtract(e,"day").format("YYYY-MM-DD"));this.$route.query.error_dates?this.findErrorDate():this.date=this.dateList[0],this.loadData()},methods:{loadData:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loading=!0,this.statData={},this.showTable=!1,e.next=5,this.$api.effect.getOfflineStatCheckByGo(this.date);case 5:if(t=e.sent,0==t.errcode){e.next=9;break}return this.showTable=!1,e.abrupt("return");case 9:this.statData=t.data.data,this.quotas=t.data.quotas,this.expInfo=t.data.exp,this.layerInfo=t.data.layer,this.loading=!1;case 14:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),findErrorDate:function(){var e=this.$route.query.error_dates||"";""!=e?(this.errDates=e.split("|"),this.errDates.length>0&&(this.date=this.errDates[0])):this.errDates=[]},switchDate:function(e){this.date=e,this.loadData()},showStatDetail:function(e,t,a){$(a.currentTarget).tooltip({placement:"top",html:!0,title:"hive数："+e.hive[t]+"<br>离线数："+e.offline[t]+"<br>误差数："+e.dist[t]+"<br>误差率："+e.percent[t],container:"body"}).tooltip("toggle")}}},xi=bi,vi=Object(h["a"])(xi,yi,gi,!1,null,"2e1b8e01",null),wi=vi.exports,ki={data:function(){return{tableType:"realtime_check",activeName:"realtime_check"}},mounted:function(){this.$emit("fixedTableHead","#tableRealtimeId"),this.$route.query.error_dates&&(this.tableType="offline_check")},components:{RealtimeDataCheck:mi,OfflineDataCheck:wi},methods:{handleClick:function(e,t){console.log(e,t),this.activeName=e.name,"realtime_check"==this.activeName?this.$emit("fixedTableHead","#tableRealtimeId"):this.$emit("fixedTableHead","#tableOfflineId")},switchTab:function(e){this.tableType=e,"realtime_check"==this.tableType?this.$emit("fixedTableHead","#tableRealtimeId"):this.$emit("fixedTableHead","#tableOfflineId")}}},Si=ki,Ii=Object(h["a"])(Si,li,ci,!1,null,"2b107c0c",null),Li=Ii.exports,$i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"snap-shot"},[a("el-row",[a("el-col",{staticClass:"now-shot",attrs:{span:6}},[a("el-button",{attrs:{type:"success"},on:{click:e.backOne}},[e._v("最新一条")]),a("el-button",{attrs:{type:"defalut",plain:""},on:{click:e.selectPrev}},[a("i",{staticClass:"el-icon-back"})])],1),a("el-col",{staticClass:"block",attrs:{span:14}},[a("p",{staticClass:"demonstration"},[a("strong",[e._v("倒数第"+e._s(e.skip+1)+"条")]),e._v("实验快照 ")]),a("el-slider",{attrs:{step:10,disabled:"","show-tooltip":!1},model:{value:e.value1,callback:function(t){e.value1=t},expression:"value1"}})],1),a("el-col",{staticClass:"next-shot",attrs:{span:4}},[a("el-button",{attrs:{type:"defalut",plain:""},on:{click:e.selectLater}},[a("i",{staticClass:"el-icon-right"})])],1)],1),a("el-row",[a("el-tabs",{staticStyle:{"margin-top":"30px"},attrs:{type:"border-card",span:18,offset:3},on:{"tab-click":e.switchTab},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"全局快照",name:"global"}}),a("el-tab-pane",{attrs:{label:"流量侧实验快照",name:"traffic_exp"}}),a("el-tab-pane",{attrs:{label:"广告主侧实验快照",name:"cust_exp"}}),a("el-row",[a("p",[a("el-date-picker",{attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd"},model:{value:e.date,callback:function(t){e.date=t},expression:"date"}}),a("el-button",{attrs:{type:"info",size:"small"},on:{click:e.locateDate}},[e._v("定位到该日期")])],1)]),a("p",[a("strong",[e._v(" 倒数第 "),a("strong",[e._v(e._s(e.skip+1))]),e._v(" 条全局快照，快照生成时间:"+e._s(e.snapshotData[e.activeName].snapshot_time)+" ")])]),a("ShowJson",{attrs:{showStr:e.snapshotContent}})],1)],1)],1)},Di=[],Ci={data:function(){return{tableType:"global",snapshotData:{global:{},traffic_exp:{},traffic_exp_new:{},cust_exp:{}},activeName:"global",date:"",skip:0,snapshotContent:"",value1:100}},mounted:function(){this.getSnapshot()},methods:{switchTab:function(e,t){this.tableType=this.activeName,this.snapshotContent=this.snapshotData[this.activeName].strategy_content},locateDate:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.user.locateSnapshotByGo(this.date,this.activeName);case 2:t=e.sent,this.skip=t.data.offset-1,this.getSnapshot();case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),selectPrev:function(){0!=this.skip?(this.skip<=10&&(this.value1=this.value1+10),this.skip--,this.getSnapshot()):this.$message.error("已经是最新的一条快照")},selectLater:function(){this.value1=this.value1-10,this.skip++,this.getSnapshot()},getSnapshot:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.user.getSnapshotByGo(this.skip);case 2:t=e.sent,this.snapshotData=t.data,this.switchTab(this.tableType);case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),backOne:function(){this.skip=0,this.value1=100}}},Ei=Ci,Ti=(a("a035"),a("4e84"),Object(h["a"])(Ei,$i,Di,!1,null,"64ed81a6",null)),Oi=Ti.exports,ji=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("iframe",{ref:"pdfiframe",attrs:{src:"/rc/faraday-logo.pdf",width:"100%",height:"1000px"}})])},Ri=[],qi={},Ai=Object(h["a"])(qi,ji,Ri,!1,null,null,null),Mi=Ai.exports,Bi=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("el-form",{staticClass:"demo-form-inline",staticStyle:{display:"flex","justify-content":"space-between",width:"80%","padding-left":"50px"},attrs:{inline:!0,model:e.formData}},[a("el-form-item",{attrs:{label:"用户名"}},[a("el-input",{attrs:{placeholder:"邮箱前缀"},model:{value:e.formData.user_name,callback:function(t){e.$set(e.formData,"user_name",t)},expression:"formData.user_name"}})],1),a("el-form-item",{attrs:{label:"权限类型"}},[a("el-select",{attrs:{placeholder:"活动区域"},on:{change:e.authoritySel},model:{value:e.formData.user_type,callback:function(t){e.$set(e.formData,"user_type",t)},expression:"formData.user_type"}},e._l(e.authorityTy,(function(e,t){return a("el-option",{key:t,attrs:{label:e.value,value:e.user_type}})})),1)],1),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.showLibArea,expression:"showLibArea"}],attrs:{label:"实验区"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.formData.area,callback:function(t){e.$set(e.formData,"area",t)},expression:"formData.area"}},e._l(e.exp_zone_list,(function(e){return a("el-option",{key:e.exp_zone_code,attrs:{label:e.product_chinese_name+"-"+e.exp_zone_chinese_name,value:e.exp_zone_code}})})),1)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.confirmDredge}},[a("span",{staticClass:"glyphicon glyphicon-plus"})])],1)],1),a("el-col",{staticStyle:{padding:"0 40px"},attrs:{span:24}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.currentLabData,height:"500",stripe:"",border:""}},[a("el-table-column",{attrs:{label:"编号"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(t.$index+1))])]}}])}),a("el-table-column",{attrs:{label:"用户名"},scopedSlots:e._u([{key:"default",fn:function(t){return[void 0!=t.row.type&&10==t.row.type?a("span",[e._v(e._s(t.row.user_name))]):a("span",[a("a",{attrs:{href:"javascript:;"},on:{click:function(a){return e.showAccessDetail(t.row.user_name)}}},[e._v(e._s(t.row.user_name))])])]}}])}),a("el-table-column",{attrs:{prop:"user_type_name",label:"权限类型"}}),a("el-table-column",{attrs:{prop:"address",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{on:{click:function(a){return e.deleteUser(t.row.user_name)}}},[a("a",{attrs:{href:"javascript:void(0);"}},[e._v("删除")])])]}}])})],1)],1),a("el-dialog",{attrs:{title:e.selectUserName+"权限列表",visible:e.dialogTableVisible},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.userAccessList,border:"",stripe:""}},[a("el-table-column",{attrs:{type:"index"}}),a("el-table-column",{attrs:{prop:"product_chinese_name",label:"产品线",width:"180"}}),a("el-table-column",{attrs:{prop:"user_type_name",label:"权限类型"}}),a("el-table-column",{attrs:{prop:"creator",label:"创建人"}}),a("el-table-column",{attrs:{prop:"create_time",label:"创建时间"}}),a("el-table-column",{attrs:{prop:"update_time",label:"更新时间"}})],1)],1)],1)],1)},Pi=[],Qi={data:function(){return{exp_zone_code:0,exp_zone_list:[],formData:{user_name:"",user_type:"0",area:[]},authorityTy:[{value:"全部",user_type:"0"},{value:"超级管理员",user_type:"10"},{value:"审核员",user_type:"4"},{value:"实验员",user_type:"2"},{value:"普通用户",user_type:"1"}],currentLabValue:"选择实验区查看",currentLabData:[],currentAuthority:"全部",selLibArea:[],showLibArea:!0,selectUserName:"",userAccessList:[],dialogTableVisible:!1}},watch:{"formData.user_name":function(e,t){this.searchUser()},"formData.user_type":function(e,t){this.searchUser()}},mounted:function(){this.getMyExpZoneList(),this.searchUser()},methods:{authoritySel:function(){this.showLibArea=10!=this.formData.user_type,this.searchUser()},getUserAuthorityList:function(){this.searchUser()},searchUser:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.formData.area.join(","),e.next=3,this.$api.user.queryUserByGo(this.formData.user_name,this.formData.user_type,t);case 3:a=e.sent,this.currentLabData=a.data;case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getMyExpZoneList:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.user.getUserExpZoneList();case 2:t=e.sent,this.exp_zone_list=t.data;case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),confirmDredge:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(""!=this.formData.user_name){e.next=3;break}return this.$message.error("请输入用户邮箱前缀"),e.abrupt("return");case 3:if(0!=this.formData.user_type){e.next=6;break}return this.$message.error("请选择用户类型"),e.abrupt("return");case 6:if(0!=this.formData.area.length||10==this.formData.user_type){e.next=9;break}return this.$message.error("请选择实验区"),e.abrupt("return");case 9:t=this.formData.area.join(","),this.$confirm("确认是否添加？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.$api.user.addUserAccess(a.formData.user_name,a.formData.user_type,t);case 2:r=e.sent,0==r.errcode?(a.$message({type:"success",message:"添加成功!"}),a.getUserAuthorityList()):a.$message({type:"error",message:r.errmsg});case 4:case"end":return e.stop()}}),e)})))).catch((function(){a.$message({type:"info",message:"已取消操作"})}));case 11:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),deleteUser:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.$confirm("是否确定删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(i["a"])(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.$api.user.deleteUser(t);case 2:r=e.sent,0==r.errcode?(a.$message({type:"success",message:"删除成功!"}),a.getUserAuthorityList()):a.$message({type:"error",message:"删除失败"});case 4:case"end":return e.stop()}}),e)})))).catch((function(){a.$message({type:"info",message:"取消删除"})}));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),showAccessDetail:function(e){this.selectUserName=e,this.getUserAccessData(),this.dialogTableVisible=!0},getUserAccessData:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.user.getUserAccess(this.selectUserName);case 2:t=e.sent,this.userAccessList=t.data;case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},Ui=Qi,Ni=Object(h["a"])(Ui,Bi,Pi,!1,null,null,null),zi=Ni.exports,Hi=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0}},[a("el-form-item",{attrs:{label:"选择时间"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.pickerOptions},model:{value:e.time,callback:function(t){e.time=t},expression:"time"}})],1),a("el-form-item",{attrs:{label:"用户名"}},[a("el-input",{model:{value:e.user,callback:function(t){e.user=t},expression:"user"}})],1),a("el-form-item",{attrs:{label:"系统选择"}},[a("el-select",{staticStyle:{width:"140px"},model:{value:e.webType,callback:function(t){e.webType=t},expression:"webType"}},[a("el-option",{attrs:{label:"全部",value:"all"}}),a("el-option",{attrs:{label:"实验平台",value:"faraday"}}),a("el-option",{attrs:{label:"精益洞察",value:"insights"}})],1)],1),a("el-form-item",[a("el-button",{attrs:{id:"export",type:"primary"},on:{click:e.clickToSearch}},[e._v("查询")])],1)],1),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.list,border:"",stripe:""}},[a("el-table-column",{attrs:{prop:"username",label:"用户名"}}),a("el-table-column",{attrs:{prop:"page_name",label:"页面"}}),a("el-table-column",{attrs:{prop:"page_params",label:"参数"}}),a("el-table-column",{attrs:{prop:"create_time",label:"访问时间"}})],1)],1),a("loading",{attrs:{state:e.loadState}})],1),a("el-pagination",{staticStyle:{"text-align":"center","margin-top":"20px"},attrs:{"current-page":e.pageIndex,layout:"total, prev, pager, next","page-count":e.pageTotal},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.pageIndex=t},"update:current-page":function(t){e.pageIndex=t}}})],1)},Fi=[],Vi=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.total>1?a("ul",{staticClass:"pagination"},[1==e.page?[e._m(0)]:[a("li",[a("a",{attrs:{href:"javascript:;",rel:"prev"},on:{click:function(t){return e.switchPage(e.page-1)}}},[e._v("«")])])],e._l(e.elementList,(function(t){return["···"==t?[a("li",{staticClass:"disabled"},[a("span",[e._v("···")])])]:t==e.page?[a("li",{staticClass:"active"},[a("span",[e._v(e._s(e.page))])])]:[a("li",[a("a",{attrs:{href:"javascript:;"},on:{click:function(a){return e.switchPage(t)}}},[e._v(e._s(t))])])]]})),e.page<e.total?[a("li",[a("a",{attrs:{href:"javascript:;",rel:"next"},on:{click:function(t){return e.switchPage(e.page+1)}}},[e._v("»")])])]:[e._m(1)]],2):e._e()},Gi=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("li",{staticClass:"disabled"},[a("span",[e._v("«")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("li",{staticClass:"disabled"},[a("span",[e._v("»")])])}],Wi={props:["page","total"],data:function(){return{elementList:[]}},watch:{page:function(){this.genElementList()},total:function(){this.genElementList()}},mounted:function(){this.genElementList()},methods:{switchPage:function(e){this.$emit("swicthPage",e)},genElementList:function(){if(this.elementList=[],this.total<=10)for(var e=1;e<=this.total;e++)this.elementList.push(e);else{if(this.page-1<6){for(e=1;e<=8;e++)this.elementList.push(e);return this.elementList.push("···"),this.elementList.push(this.total-1),void this.elementList.push(this.total)}if(this.total-this.page<6){for(e=0;e<=7;e++)this.elementList.unshift(this.total-e);return this.elementList.unshift("···"),this.elementList.unshift(2),void this.elementList.unshift(1)}if(this.page-1>=6&&this.total-this.page>=6){this.elementList.push(1),this.elementList.push(2),this.elementList.push("···");for(e=-3;e<=3;e++)this.elementList.push(this.page+e);return this.elementList.push("···"),this.elementList.push(this.total-1),void this.elementList.push(this.total)}}}}},Zi=Wi,Ki=Object(h["a"])(Zi,Vi,Gi,!1,null,null,null),Yi=Ki.exports,Ji={data:function(){return{loadState:"",list:[],statData:{},fromTime:"",toTime:"",user:"",webType:"all",time:[_()(new Date).add(-3,"days"),_()().format("YYYY-MM-DD")],pageIndex:1,pageTotal:0,pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]}}},mounted:function(){this.getRecordList()},components:{Paginate:Yi},methods:{handleCurrentChange:function(e){this.getRecordList()},swicthPage:function(){this.getRecordList()},clickToSearch:function(){this.pageIndex=1,this.getRecordList()},getRecordList:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.loadState="loading",this.list=[],t=this.buildQuery(),e.next=5,this.$api.user.getPageViewListByGo(t);case 5:a=e.sent,this.pageTotal=a.data.total_page,this.loadState="",a.body,this.list=a.data.list;case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),buildQuery:function(){var e={from:_()(this.time[0]).format("YYYY-MM-DD 00:00:00"),to:_()(this.time[1]).format("YYYY-MM-DD 23:59:59"),username:this.user,web_type:this.webType,page:this.pageIndex};return e},getStat:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.user.getPageViewStat();case 2:t=e.sent,this.statData=t.data;case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}},Xi=Ji,eo=(a("bc6a"),Object(h["a"])(Xi,Hi,Fi,!1,null,"2a92daf1",null)),to=eo.exports,ao=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-tabs",{attrs:{type:"border-card"},model:{value:e.tabType,callback:function(t){e.tabType=t},expression:"tabType"}},[a("el-tab-pane",{attrs:{label:"权限管理",name:"AccessQuery"}}),a("el-tab-pane",{attrs:{label:"访问查询",name:"PageViewList"}}),a("el-tab-pane",{attrs:{label:"系统修改",name:"SystemManage"}}),a("el-tab-pane",{attrs:{label:"数据修改",name:"DatabaseManage"}}),a(e.tabType,{tag:"component"})],1)],1)},ro=[],so=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",{attrs:{gutter:20}},[a("el-col",{staticStyle:{height:"400px"},attrs:{span:12}},[a("el-card",{staticClass:"box-card",staticStyle:{overflow:"visible",height:"100%"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("禁用系统")])]),""==e.banTime.start||""==e.banTime.end?a("el-row",[a("el-date-picker",{staticStyle:{padding:"3px",width:"100%"},attrs:{format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",type:"datetimerange","picker-options":e.pickerOptions,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"right"},model:{value:e.time,callback:function(t){e.time=t},expression:"time"}}),a("div",{staticStyle:{"margin-top":"10px","margin-bottom":"10px"}},[a("el-button",{attrs:{type:"danger"},on:{click:e.banOperate}},[e._v("禁用")])],1)],1):e._e(),""!=e.banTime.start&&""!=e.banTime.end?a("el-row",[a("el-form",{ref:"form",attrs:{"label-width":"180px"}},[a("el-form-item",{attrs:{label:"当前禁用系统时间段："}},[a("el-tag",[e._v(e._s(e.banTime.start))]),e._v("~ "),a("el-tag",[e._v(e._s(e.banTime.end))])],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.openOperate}},[e._v("解除禁用")])],1),a("el-form-item",{attrs:{label:"白名单用户："}},[a("el-input",{attrs:{type:"textarea"},model:{value:e.banWhiteUser,callback:function(t){e.banWhiteUser=t},expression:"banWhiteUser"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.saveBanWhiteUsers}},[e._v("修改")])],1)],1)],1):e._e()],1)],1),a("el-col",{staticStyle:{"margin-bottom":"40px",height:"210px"},attrs:{span:8}},[a("el-card",{staticClass:"box-card",staticStyle:{overflow:"visible",height:"100%"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("切换登陆身份")])]),a("div",{staticClass:"text item"},[a("div",{staticStyle:{"margin-bottom":"10px"}},[a("div",{staticClass:"form-inline"},[a("div",{staticClass:"form-group"},[a("el-select",{attrs:{"collapse-tags":"",filterable:"",placeholder:"请选择"},model:{value:e.user,callback:function(t){e.user=t},expression:"user"}},e._l(e.user_list,(function(e){return a("el-option",{key:e.user_name,attrs:{value:e.user_name}})})),1)],1),e._v(" "),a("el-button",{attrs:{plain:"",type:"warning"},on:{click:e.switchID}},[e._v("确认切换")])],1)])])])],1)],1)},no=[],io={data:function(){return{time:[],banTime:{start:"",end:""},banWhiteUser:"",user:"none",user_list:[],pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近一个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-2592e6),e.$emit("pick",[a,t])}},{text:"最近三个月",onClick:function(e){var t=new Date,a=new Date;a.setTime(a.getTime()-7776e6),e.$emit("pick",[a,t])}}]},value1:[new Date(2e3,10,10,10,10),new Date(2e3,10,11,10,10)],value:[]}},components:{PageViewList:to},mounted:function(){this.getBanTime(),this.getUsers()},methods:{getUsers:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.user.queryUserByGo();case 2:t=e.sent,this.user_list=t.data;case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),saveBanWhiteUsers:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.user.saveBanWhiteUser(this.banWhiteUser);case 2:e.sent,this.$message("修改成功");case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getBanTime:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.user.getSysBanTime();case 2:t=e.sent,this.banTime=t.data,this.banWhiteUser=this.banTime.user;case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),banOperate:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.user.setSysBanTime(this.time[0],this.time[1]);case 2:t=e.sent,0==t.errcode?(this.$message({showClose:!0,message:"禁止更改操作成功",type:"success"}),this.getBanTime()):this.$message({showClose:!0,message:"禁止更改操作失败，请稍后再试",type:"error"});case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),openOperate:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.user.cancelSysBan();case 2:t=e.sent,0==t.errcode?(this.$message({showClose:!0,message:"解除禁止成功",type:"success"}),this.getBanTime()):this.$message({showClose:!0,message:"解除禁止失败，请稍后再试",type:"error"});case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),switchID:function(){var e=this;"none"!=this.user?this.$confirm("确认切换到用户身份，一旦切换身份，将不能再切换回来","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.doSwitchId(e.user)})).catch((function(){e.$message({type:"info",message:"已取消操作"})})):this.$message({showClose:!0,message:"请选择用户",type:"info"})},doSwitchId:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.user.switchUser(t);case 2:a=e.sent,a||alert(111),0==a.errcode?window.location.href="/experiment":this.$message({type:"info",message:a.errmsg});case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}},oo=io,lo=Object(h["a"])(oo,so,no,!1,null,null,null),co=lo.exports,uo=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",{attrs:{gutter:20}},[a("el-col",{staticStyle:{"margin-bottom":"10px",height:"210px"},attrs:{span:8}},[a("el-card",{staticClass:"box-card",staticStyle:{height:"100%"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("重新生成实验快照")])]),a("div",{staticClass:"text item"},[a("div",{staticStyle:{"margin-bottom":"10px"}},[a("el-button-group",[a("el-button",{on:{click:function(t){return e.confirmGen("traffic","流量侧实验快照")}}},[e._v("流量侧")]),a("el-button",{on:{click:function(t){return e.confirmGen("customer","广告主侧实验快照")}}},[e._v("广告主侧")]),a("el-button",{on:{click:function(t){return e.confirmGen("global","全局实验快照")}}},[e._v("全局快照")])],1)],1),a("el-tag",{attrs:{type:"danger"}},[a("i",{staticClass:"el-icon-warning",staticStyle:{"padding-right":"10px"}}),e._v("主动生成线上快照 ")])],1)])],1),a("el-col",{staticStyle:{"margin-bottom":"10px",height:"210px"},attrs:{span:8}},[a("el-card",{staticClass:"box-card",staticStyle:{height:"100%"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v(" 删除最后一条实验快照 "),a("router-link",{attrs:{to:{path:"/snapshot/list"}}},[e._v("快照查看")])],1)]),a("div",{staticClass:"text item"},[a("div",{staticStyle:{"margin-bottom":"10px"}},[a("el-button-group",[a("el-button",{on:{click:function(t){return e.confirmDel("traffic","流量侧实验快照")}}},[e._v("流量侧")]),a("el-button",{on:{click:function(t){return e.confirmDel("customer","广告主侧实验快照")}}},[e._v("广告主侧")]),a("el-button",{on:{click:function(t){return e.confirmDel("global","全局实验快照")}}},[e._v("全局快照")])],1)],1),a("el-tag",{attrs:{type:"danger"}},[a("i",{staticClass:"el-icon-warning",staticStyle:{"padding-right":"10px"}}),e._v("线上快照数据有问题时使用 ")])],1)])],1)],1)},po=[],_o={methods:{confirmDel:function(e,t){var a=this;this.$confirm("确认删除最后一条"+t,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.delSnapshot(e)})).catch((function(){a.$message({type:"info",message:"取消操作"})}))},delSnapshot:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.user.deleteLastSnapshotByGo(t);case 2:a=e.sent,0==a.errcode?this.$message({showClose:!0,message:"删除成功",type:"success"}):this.$message({showClose:!0,message:a.errmsg,type:"error"});case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),confirmGen:function(e,t){var a=this;this.$confirm("确认新生成一条"+t,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){a.genSnapshot(e)})).catch((function(){a.$message({type:"info",message:"取消操作"})}))},genSnapshot:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(t){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.user.genSnapshotByGo(t);case 2:a=e.sent,0==a.errcode?this.$message({showClose:!0,message:"生成成功",type:"success"}):this.$message({showClose:!0,message:a.msg,type:"error"});case 4:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()}},fo=_o,ho=Object(h["a"])(fo,uo,po,!1,null,null,null),mo=ho.exports,yo={data:function(){return{tabType:"AccessQuery"}},mounted:function(){"access"==this.$route.query.tab&&(this.tabType="AccessQuery"),"pv"==this.$route.query.tab&&(this.tabType="PageViewList")},components:{AccessQuery:zi,PageViewList:to,SystemManage:co,DatabaseManage:mo}},go=yo,bo=Object(h["a"])(go,ao,ro,!1,null,null,null),xo=bo.exports,vo=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-row",[a("el-col",{attrs:{span:20,offset:2}},[a("el-card",[a("el-form",{ref:"form",attrs:{"label-width":"80px"}},[a("el-form-item",{attrs:{label:"权限类型:"}},[a("el-radio-group",{model:{value:e.user_type,callback:function(t){e.user_type=t},expression:"user_type"}},[a("el-radio",{attrs:{label:"普通用户"}}),a("el-radio",{attrs:{label:"审核员"}}),a("el-radio",{attrs:{label:"实验员"}})],1)],1),a("el-form-item",{attrs:{label:"实验区:"}},e._l(e.areaList,(function(t,r){return a("el-button",{key:r,staticStyle:{margin:"5px",cursor:"pointer"},attrs:{type:"default",type:e.selectedList.indexOf(t)>-1?"primary":""},on:{click:function(a){return e.selectArea(t)}}},[e._v(e._s(t))])})),1),a("el-form-item",{attrs:{label:"抄送:"}},[a("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"输入直属learder邮箱前缀"},model:{value:e.userTo,callback:function(t){e.userTo=t},expression:"userTo"}})],1),a("el-form-item",[a("el-button",{attrs:{type:"warning"},on:{click:e.confirmDredge}},[e._v("申请")])],1)],1)],1)],1)],1)},wo=[],ko=(a("a434"),{data:function(){return{user_name:"",userTo:"",user_type:"普通用户",areaList:[],selectedList:[],allSelect:!1}},mounted:function(){this.user_name=localStorage.getItem("userName"),this.getArea()},watch:{allSelect:function(e,t){this.selectedList=1==e?this.areaList:[]}},methods:{getArea:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.user.getAllExpZones();case 2:for(a in t=e.sent,t.data)r=t.data[a].product_chinese_name+"-"+t.data[a].exp_zone_chinese_name,this.areaList.push(r);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),selectArea:function(e){if(-1==this.selectedList.indexOf(e))this.selectedList.push(e);else{var t=this.selectedList.indexOf(e);this.selectedList.splice(t,1)}},confirmDredge:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(0!=this.selectedList.length){e.next=3;break}return this.$message("请选择实验区"),e.abrupt("return");case 3:if(""!=this.userTo){e.next=6;break}return this.$message("请选择抄送leader"),e.abrupt("return");case 6:if(t=this.selectedList.join("、"),a=confirm("确认是否申请？"),a){e.next=10;break}return e.abrupt("return");case 10:return e.next=12,this.$api.user.applyUserAccessByGo(this.user_name,this.user_type,t,this.userTo);case 12:if(r=e.sent,0!=r.errcode){e.next=16;break}return this.$message("申请成功"),e.abrupt("return");case 16:this.$message(r.errmsg);case 17:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}}),So=ko,Io=(a("088c"),Object(h["a"])(So,vo,wo,!1,null,"4e81e62e",null)),Lo=Io.exports;r["default"].use(g["a"]);var $o=new g["a"]({routes:[{path:"/",name:"Home",component:S,meta:{title:[]}},{path:"/test",name:"Test",component:T,meta:{title:[]}},{path:"/user/apply_access",name:"apply_access",component:Lo,meta:{title:["申请权限"]}},{path:"/index/all_record",name:"AllRecord",component:z,meta:{title:["日志","系统事件"],small:"Kunkka和法拉第流程时间线"}},{path:"/index/all_log",name:"AllLog",component:Z,meta:{title:["日志","平台更新日志"],small:"法拉第实验平台功能更新记录"}},{path:"/strategy/index",name:"strategy_index",component:he,meta:{title:["策略","策略池"],small:"管理接入实验平台的全部策略列表"}},{path:"/strategy/audit_list",name:"strategy_audit_list",component:At,meta:{title:["审核","待审核策略列表"]}},{path:"/strategy/create",name:"strategy_create",component:gt,meta:{title:["策略","新增策略"],small:"录入新的策略以支持新的实验"}},{path:"/strategy/edit",name:"strategy_edit",component:Et,meta:{title:["策略","编辑策略"],small:"编辑策略以支持新的实验"}},{path:"/strategy/detail",name:"strategy_detail",component:it,meta:{title:["策略","策略详情"],small:"查看并管理您的策略"}},{path:"/strategy/audit_detail",name:"strategy_audit_detail",component:{extends:it},meta:{title:["审核","待审核策略详情"],small:"查看并管理您的策略"}},{path:"/lab/create_exp_step",name:"create_exp_step",component:Ar,meta:{title:["实验","创建实验"]}},{path:"/lab/edit",name:"lab_edit",component:Wr,meta:{title:["实验","修改实验"],small:"编辑流量侧实验"}},{path:"/lab/pending",name:"lab_pending",component:es,meta:{title:["审核","待审核实验"]}},{path:"/lab/list",name:"lab_list",component:is,meta:{title:["实验","实验列表"],small:"显示全部实验信息"}},{path:"/lab/detail",name:"lab_detail",component:qs,meta:{title:["实验","实验详情"],small:"查看并管理您的实验"}},{path:"/lab/audit_detail",name:"lab_audit_detail",component:{extends:qs},meta:{title:["审核","实验详情"]}},{path:"/monitor/stat_data_check",name:"stat_realtime_data_check",component:Li,meta:{title:["日志","实验数据质量"]}},{path:"/lab/custom_exp_edit",name:"custom_exp_edit",component:Us,meta:{title:["实验","编辑实验"],small:"编辑广告主侧实验"}},{path:"/snapshot/list",name:"snapshot_list",component:Oi,meta:{title:["日志","实验快照"],small:"记录实验平台当前状态的全局策略和全局实验快照信息"}},{path:"/tool/logolist",name:"logolist",component:Mi,meta:{title:"logo列表"}},{path:"/monitor/exp_effect",name:"ExpEffectView",component:Gs,meta:{title:["实验","实验检验"],small:"快速查看您的实验数据报表情况",keepAlive:!0}},{path:"/monitor/exp_data_stat",name:"ExpDataStat",component:Pn,meta:{title:["实验","实验数据检验"],small:"快速查看您的实验数据报表情况"}},{path:"/monitor/cust_exp_data_stat",name:"CustExpDataStat",component:oi,meta:{title:["实验","实验数据检验"],small:"快速查看您的实验数据报表情况"}},{path:"/quota/list",name:"QuotaList",component:_a,meta:{title:["日志","实验指标池"],small:"管理所有指标"}},{path:"/user/page_view_list",name:["管理员中心","page_view_list"],component:to},{path:"/user/super_tool",name:"super_tool",component:xo,meta:{title:["管理员中心","超级管理员"]}}]});$o.beforeEach((function(e,t,a){e.meta.title.length>0?document.title=e.meta.title.join("-"):document.title="法拉第实验平台",a()})),$o.afterEach((function(e,t,a){window.scrollTo(0,0)}));var Do=$o,Co=a("376b"),Eo=a.n(Co),To=a("3de1"),Oo=a("365c"),jo=a("4eb5"),Ro=a.n(jo),qo=a("5c96"),Ao=a.n(qo),Mo=(a("0fae"),a("0267")),Bo=a("7adc"),Po=a("91b7"),Qo=a("32d0"),Uo=a("4360");r["default"].use(Ao.a),a("2440"),Ro.a.config.autoSetContainer=!0,r["default"].use(Ro.a),r["default"].component("loading",Mo["a"]),r["default"].component("ShowJson",Bo["a"]),r["default"].component("popover",Po["a"]),r["default"].component("paginate",Yi),r["default"].component("drawchart",Qo["a"]),r["default"].config.productionTip=!1,r["default"].prototype.$lodash=ve.a,r["default"].prototype.Export2Excel=Eo.a,r["default"].prototype.$tool=To["a"],r["default"].prototype.$api=Oo["a"],r["default"].prototype.$errorMsg="暂时无法获取数据，请刷新页面重试，如果还无法解决，请联系liuhu3@staff.weibo.com，q767856178";new r["default"]({el:"#app",router:Do,components:{App:y},template:"<App/>",store:Uo["a"]})},"604c":function(e,t,a){},"63ea":function(e,t,a){"use strict";var r=a("29a2"),s=a.n(r);s.a},"651f":function(e,t,a){},"657b":function(e,t,a){"use strict";var r=a("0ac6"),s=a.n(r);s.a},"69a1":function(e,t,a){},"6c13":function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.listData,height:"500",id:"layerList"}},[a("el-table-column",{attrs:{prop:"origin_exp_layer.exp_layer_id",label:"ID",width:"70"}}),a("el-table-column",{attrs:{label:"实验",width:"350"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("router-link",{attrs:{to:{path:"/lab/detail",query:{exp_layer_id:t.row.origin_exp_layer.exp_layer_id}}}},[e._v(e._s(t.row.origin_exp_layer.exp_layer_name))])]}}])}),a("el-table-column",{attrs:{label:"应用策略",width:"200"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("router-link",{attrs:{to:{path:"/strategy/detail",query:{strategy_set_id:e.row.origin_exp_layer.strategy_set_id}}}},[a("popover",{attrs:{showStr:e.row.strategy_set_name||"无",length:35}})],1)]}}])}),a("el-table-column",{attrs:{label:"运行状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",{attrs:{type:t.row.status_cls}},[e._v(e._s(t.row.status_text))])]}}])}),a("el-table-column",{attrs:{prop:"product_chinese_name",label:"所属产品"}}),a("el-table-column",{attrs:{label:"实验类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(1==t.row.origin_exp_layer.exp_layer_type?"广告主侧":"流量侧")+" ["+e._s(0==t.row.origin_exp_layer.is_same_type?"非同质":"同质")+"]")]}}])}),a("el-table-column",{attrs:{label:"实验检验"},scopedSlots:e._u([{key:"default",fn:function(t){return[3==t.row.origin_exp_layer.exp_layer_status_code||4==t.row.origin_exp_layer.exp_layer_status_code||6==t.row.origin_exp_layer.exp_layer_status_code?[a("router-link",{attrs:{to:{path:"/monitor/exp_data_stat",query:{exp_layer_id:t.row.origin_exp_layer.exp_layer_id}}}},[e._v("检验评测")])]:[e._v("无")]]}}])}),a("el-table-column",{attrs:{prop:"origin_exp_layer.creator",label:"创建者"}}),a("el-table-column",{attrs:{label:"更新时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.origin_exp_layer.update_time.substr(5,11)))]}}])})],1)},s=[],n=(a("2f62"),{props:["listData"]}),i=n,o=a("2877"),l=Object(o["a"])(i,r,s,!1,null,null,null);t["a"]=l.exports},"6c9e":function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es_array_filter__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("4de4"),core_js_modules_es_array_filter__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_filter__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es_array_join__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("a15b"),core_js_modules_es_array_join__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es_array_join__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es_parse_int__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("e25e"),core_js_modules_es_parse_int__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es_parse_int__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es_regexp_exec__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("ac1f"),core_js_modules_es_regexp_exec__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es_regexp_exec__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es_string_split__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("1276"),core_js_modules_es_string_split__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es_string_split__WEBPACK_IMPORTED_MODULE_4__),regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("96cf"),regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_5__),_Users_liuhu3_www_hello_world_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("1da1");__webpack_exports__["a"]={props:["listData","hubbleQuotas","theModalId","EditId","thehubbleId","linkId"],data:function(){return{clickQuota:{},clickThirdQuota:{},keyword:"",hubbleId:0,product:[],newListData:[],quotaDetail:!1,editDrawer:!1,hubbleDrawer:!1,linkDrawer:!1}},watch:{listData:{handler:function(e,t){this.newListData=e},immediate:!0,deep:!0}},computed:{showHubbleQuotas:function showHubbleQuotas(){var result=this.hubbleQuotas.filter((function(data){var reg=eval("/(?="+this.keyword+")/"),retData=reg.test(data.id)||reg.test(data.indicator_name)||reg.test(data.indicator_meaning)||reg.test(data.theme);return retData}),this);return result}},methods:{showQuotaDetail:function(e){this.clickQuota=e,this.quotaDetail=!0},showThirdPartyDetail:function(e){this.clickThirdQuota=e,this.hubbleDrawer=!0},editQuota:function(e){this.product=e.quota.product.split(","),this.clickQuota=e,this.editDrawer=!0},linkHubbleQuota:function(e){this.clickQuota=e,this.linkDrawer=!0,this.hubbleId=this.clickQuota.third_party_id},confirmLinkHubbleQuota:function(){this.updateQuotaThirdId(this.clickQuota.quota.quota_id,this.hubbleId)},updateQuotaThirdId:function(){var e=Object(_Users_liuhu3_www_hello_world_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_6__["a"])(regeneratorRuntime.mark((function e(t,a){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.quota.updateByGo({quota_id:parseInt(t),third_party_id:parseInt(a)});case 2:if(r=e.sent,0==r.errcode){e.next=6;break}return this.$message.error(r.errmsg||"更新失败"),e.abrupt("return");case 6:this.$message({message:"更新成功",type:"success"}),this.$emit("updateData");case 8:case"end":return e.stop()}}),e,this)})));function t(t,a){return e.apply(this,arguments)}return t}(),delQuota:function(){var e=Object(_Users_liuhu3_www_hello_world_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_6__["a"])(regeneratorRuntime.mark((function e(t){var a=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.$confirm("确认删除该指标？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(_Users_liuhu3_www_hello_world_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_6__["a"])(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,a.$api.quota.deleteByGo(t.quota.quota_id);case 2:if(r=e.sent,0==r.errcode){e.next=6;break}return a.$message.error(r.errmsg||"删除失败"),e.abrupt("return");case 6:a.$message({type:"success",message:"删除成功!"}),a.$emit("updateData");case 8:case"end":return e.stop()}}),e)})))).catch((function(){a.$message({type:"info",message:"删除失败"})}));case 1:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),updateQuota:function(){var e=Object(_Users_liuhu3_www_hello_world_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_6__["a"])(regeneratorRuntime.mark((function e(){var t,a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=this.clickQuota.quota,t.support_product=this.clickQuota.support_product,a=this.$lodash.pick(t,["quota_id","quota_text","quota_en_text","quota_comment","quota_weight"]),a.quota_id=parseInt(a.quota_id),a.quota_weight=parseInt(a.quota_weight),a.product=this.product.join(","),console.log(a),e.next=9,this.$api.quota.updateByGo(a);case 9:if(r=e.sent,0==r.errcode){e.next=13;break}return this.$message.error(r.errmsg||"更新失败"),e.abrupt("return");case 13:this.$message({message:"更新成功",type:"success"}),this.$emit("updateData");case 15:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}}},"6e68":function(e,t,a){},"7a4b":function(e,t,a){e.exports=a.p+"img/6.c1459a94.png"},"7e63":function(e,t,a){},"7ed8":function(e,t,a){"use strict";var r=a("6e68"),s=a.n(r);s.a},"82c5":function(e,t,a){},"87ad":function(e,t,a){e.exports=a.p+"img/ele_audit.9b2179a3.png"},"8db4":function(e,t,a){},"948a":function(e,t,a){"use strict";var r=a("38ac"),s=a.n(r);s.a},9559:function(e,t,a){e.exports=a.p+"img/exp_volume_audit_flow.017b0741.png"},"9f63":function(e,t,a){"use strict";var r=a("69a1"),s=a.n(r);s.a},a035:function(e,t,a){"use strict";var r=a("3991"),s=a.n(r);s.a},a3c8:function(e,t,a){},a4de:function(e,t){var a={mainfeed:"主feed流",groupfeed:"分组feed流",friendfeed:"好友圈feed流",hot_tweets_feed:"热门微博流",profile:"Profile微博流",single_page:"正文页",account_feed:"账号流",hot_topic:"热门话题",hot_tweets_category:"热门微博分类页",hot_channel_feed:"热门频道流",videofeed:"视频后推荐流",queryfeed:"搜索流",weico_mainfeed:"weico主feed流",finding_friends:"找人页",finding_second:"找人页二级页",relation_center:"他人态关系中心",my_following:"主人态关注列表",my_follower:"主人态粉丝列表",follower_second:"粉丝列表二级页",pc_right_account:"首页右侧-感兴趣的人",weather_feed:"天气通-同城流",international_mainfeed:"微博国际版-主feed",general_queryfeed:"普搜流",article:"文章页",comments_list:"评论流",video_tab:"视频流",discover_video:"发现页-视频流",vertical_video:"竖版视频流",story_video:"故事流",photo_feed:"图集流",nearby_feed:"附近流",qa_feed:"问答流",freshnews_feed:"新鲜事流"};e.exports=a},bc6a:function(e,t,a){"use strict";var r=a("3bc5"),s=a.n(r);s.a},bee8:function(e,t,a){"use strict";var r=a("a3c8"),s=a.n(r);s.a},c0c5:function(e,t,a){e.exports=a.p+"img/ele_exp.7728266b.png"},c3c1:function(e,t,a){"use strict";var r=a("d500"),s=a.n(r);s.a},c545:function(e,t,a){},c552:function(e,t,a){"use strict";var r=a("604c"),s=a.n(r);s.a},c601:function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es_array_filter__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("4de4"),core_js_modules_es_array_filter__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_filter__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es_string_trim__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("498a"),core_js_modules_es_string_trim__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es_string_trim__WEBPACK_IMPORTED_MODULE_1__),regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("96cf"),regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_2__),_Users_liuhu3_www_hello_world_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("1da1"),_ExpTable_vue__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("6c13");__webpack_exports__["a"]={data:function(){return{listType:"mine",listData:[],page:1,total:0,keyword:"",timer:null}},components:{ExpTable:_ExpTable_vue__WEBPACK_IMPORTED_MODULE_4__["a"]},computed:{showDatas:function showDatas(){var _this=this;return this.listData.filter((function(data){var reg=eval("/(?="+_this.keyword+")/");return reg.test(data.origin_exp_layer.exp_layer_name)||reg.test(data.strategy_set_name)||reg.test(data.product_chinese_name)||reg.test(data.origin_exp_layer.creator)||reg.test(data.origin_exp_layer.exp_layer_id)}))}},watch:{listType:function(){this.changeListType()}},mounted:function(){var e=localStorage.getItem("expType");e&&(this.listType=e),this.getListData()},methods:{changeListType:function(){this.keyword="",localStorage.setItem("expType",this.listType),this.getListData()},getListData:function(){var e=Object(_Users_liuhu3_www_hello_world_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3__["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("all"!=this.listType&&"finish"!=this.listType){e.next=2;break}return e.abrupt("return",this.getAllListData());case 2:return e.next=4,this.$api.exp.getLayerListByGo(this.listType);case 4:t=e.sent,this.$set(this,"listData",t.data);case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getAllListData:function(){var e=Object(_Users_liuhu3_www_hello_world_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3__["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.exp.getAllLayerList(this.page,this.listType);case 2:t=e.sent,this.$set(this,"listData",t.data.list),this.total=t.data.total;case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),exportLayerList:function(){this.Export2Excel.export_table_to_excel("layerList",this.listType+"列表")},searchLayerList:function(){var e=this;if("mine"==this.listType||"volume"==this.listType)return!1;""!=this.keyword.trim()?(null!=this.timer&&clearTimeout(this.timer),this.timer=setTimeout((function(){e.doSearch()}),1e3)):this.getAllListData()},doSearch:function(){var e=Object(_Users_liuhu3_www_hello_world_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_3__["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.exp.searchLayerListByGo(this.keyword);case 2:t=e.sent,this.$set(this,"listData",t.data);case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}}},d081:function(e,t,a){},d280:function(e,t,a){e.exports=a.p+"img/ele_log.e36223f5.png"},d500:function(e,t,a){},d8ab:function(e,t,a){"use strict";var r=a("c545"),s=a.n(r);s.a},da17:function(e,t,a){"use strict";var r=a("651f"),s=a.n(r);s.a},e15c:function(e,t,a){"use strict";var r=a("8db4"),s=a.n(r);s.a},e184:function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es_array_for_each__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("4160"),core_js_modules_es_array_for_each__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_for_each__WEBPACK_IMPORTED_MODULE_0__),core_js_modules_es_array_join__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("a15b"),core_js_modules_es_array_join__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es_array_join__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es_parse_int__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("e25e"),core_js_modules_es_parse_int__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es_parse_int__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_web_dom_collections_for_each__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("159b"),core_js_modules_web_dom_collections_for_each__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_web_dom_collections_for_each__WEBPACK_IMPORTED_MODULE_3__),regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("96cf"),regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_4__),_Users_liuhu3_www_hello_world_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("1da1"),lodash__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__("2ef0"),lodash__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_6__);__webpack_exports__["a"]={props:{quotaRange:{type:String,default:"none"}},watch:{quotaRange:{handler:function(e,t){this.defaultQuotaRange=e}}},data:function(){return{constVal:0,Quota:{quota_text:"",quota_en_text:"",quota_name:"",quota_comment:"",quota_range:"0",expression:[],formate:{percent:!1},fmt_precision:4,creator:"nobody",quota_type:"1",product:[]},originQuotaList:[],defaultQuotaRange:"none",userType:0,showIf:!0}},mounted:function(){this.getOriginQuotas(),this.userType=localStorage.getItem("userType")},methods:{inputExpression:function(e){this.Quota.expression.push(e)},addConstVal:function(){this.Quota.expression.push(this.constVal)},delLast:function(){this.Quota.expression.pop()},getOriginQuotas:function(){var e=Object(_Users_liuhu3_www_hello_world_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_5__["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.quota.getListByGo("origin");case 2:t=e.sent,this.originQuotaList=t.data;case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),checkExpression:function checkExpression(){var list=[];this.Quota.expression.forEach((function(e,t){"+"==e||"-"==e||"*"==e||"/"==e||"("==e||")"==e?list.push(e):list.push(5)}));try{return eval(list.join(" ")),!0}catch(exception){return this.$message.error("计算公式有误，"+exception),!1}},toCreateQuota:function(){var e=Object(_Users_liuhu3_www_hello_world_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_5__["a"])(regeneratorRuntime.mark((function e(){var t,a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=this.Quota,1!=this.Quota.quota_type||this.checkExpression()){e.next=3;break}return e.abrupt("return",!1);case 3:return a=this.$lodash.pick(t,["quota_text","quota_en_text","quota_name","quota_range","fmt_precision","quota_type","quota_comment"]),a.expression=t.expression.join(","),a.quota_type=parseInt(a.quota_type),t.formate.percent&&(a.formate="percent"),a.fmt_precision=parseInt(a.fmt_precision),a.product=t.product.join(","),a.quota_range=parseInt(a.quota_range),e.next=12,this.$api.quota.createByGo(a);case 12:r=e.sent,0==r.errcode?(this.$message({message:"创建成功",type:"success"}),this.$tool.reload()):this.$message(r.errmsg);case 14:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}}},e47c:function(e,t,a){},e514:function(e,t,a){"use strict";var r=a("1a7e"),s=a.n(r);s.a},e94f:function(e,t,a){"use strict";var r=a("0cb7"),s=a.n(r);s.a},f492:function(e,t,a){"use strict";var r=a("3e13"),s=a.n(r);s.a},f613:function(e,t,a){"use strict";var r=a("3dfa"),s=a.n(r);s.a},f6aa:function(e,t,a){"use strict";var r=a("82c5"),s=a.n(r);s.a},f709:function(module,__webpack_exports__,__webpack_require__){"use strict";var core_js_modules_es_array_filter__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("4de4"),core_js_modules_es_array_filter__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(core_js_modules_es_array_filter__WEBPACK_IMPORTED_MODULE_0__),regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("96cf"),regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(regenerator_runtime_runtime__WEBPACK_IMPORTED_MODULE_1__),_Users_liuhu3_www_hello_world_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("1da1"),_StrategyListTable_vue__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("34dd");__webpack_exports__["a"]={name:"StrategyMyList",data:function(){return{datas:[],strategySetTabId:"StrategySetMyList",keyword:""}},computed:{showDatas:function showDatas(){var result=this.datas.filter((function(data){var reg=eval("/(?="+this.keyword+")/"),retData=reg.test(data.origin_strategy_set.strategy_set_name)||reg.test(data.origin_strategy_set.strategy_set_comment)||reg.test(data.origin_strategy_set.creator)||reg.test(data.origin_strategy_set.strategy_name_list)||reg.test(data.origin_strategy_set.strategy_set_id);return retData}),this);return result}},components:{StrategyListTable:_StrategyListTable_vue__WEBPACK_IMPORTED_MODULE_3__["a"]},mounted:function(){this.getList()},methods:{getList:function(){var e=Object(_Users_liuhu3_www_hello_world_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_2__["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t={},e.next=3,this.$api.strategy.getMyListByGo();case 3:if(t=e.sent,0==t.errcode){e.next=7;break}return this.$set(this,"datas",[]),e.abrupt("return");case 7:null!=t.data&&this.$set(this,"datas",t.data);case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),doit:function(){this.Export2Excel.export_table_to_excel("myStrategy","我的策略")}}}},f8fe:function(e,t,a){"use strict";var r=a("156f"),s=a.n(r);s.a}});
//# sourceMappingURL=exp.a3ff01fa.js.map